var Kiwi;!function(t){var e=function(){function e(e,i,n,o){"undefined"==typeof e&&(e=""),"undefined"==typeof i&&(i="KiwiGame"),"undefined"==typeof n&&(n=null),"undefined"==typeof o&&(o={});var r=this;if(this._startup=null,this.audio=null,this.fileStore=null,this.input=null,this.cameras=null,this.pluginManager=null,this.loader=null,this.raf=null,this.stage=null,this.states=null,this.time=null,this.tweens=null,this.rnd=null,this._frameRate=60,this._interval=1e3/60,this._delta=0,console.log("Kiwi.Game: "+i+" is booting, using Kiwi.js version "+t.VERSION),null===t.DEVICE&&(t.DEVICE=new t.System.Device),"undefined"!==o.debug&&"number"==typeof o.debug)switch(o.debug){case t.DEBUG_ON:this._debugOption=o.debug,console.log("  Kiwi.Game: Debugging turned ON.");break;case t.DEBUG_OFF:this._debugOption=o.debug,console.log("  Kiwi.Game: Debugging turned OFF.");break;default:this._debugOption=t.DEBUG_ON,console.error("  Kiwi.Game: Debug option passed, but is not a valid option. Turned ON by default.")}else this._debugOption=t.DEBUG_ON,console.log("  Kiwi.Game: Debug option not specified. Turned ON by default.");if("undefined"!==o.bootCallback&&(this.bootCallbackOption=o.bootCallback),"undefined"!==o.deviceTarget&&"number"==typeof o.deviceTarget)switch(o.deviceTarget){case t.TARGET_BROWSER:this._deviceTargetOption=o.deviceTarget,console.log("  Kiwi.Game: Targeting BROWSERS.");break;case t.TARGET_COCOON:this._deviceTargetOption=o.deviceTarget,console.log("  Kiwi.Game: Targeting COCOONJS.");break;default:this._deviceTargetOption=t.TARGET_BROWSER,console.error("  Kiwi.Game: Target device specified, but is not a valid option. Defaulting to BROWSER.")}else this._deviceTargetOption=t.TARGET_BROWSER,console.log("  Kiwi.Game: Targeted device not specified. Defaulting to BROWSER");if("undefined"!==o.renderer&&"number"==typeof o.renderer)switch(o.renderer){case t.RENDERER_CANVAS:this._renderOption=o.renderer,console.log("  Kiwi.Game: Rendering using CANVAS.");break;case t.RENDERER_WEBGL:t.DEVICE.webGL?(this._renderOption=o.renderer,console.log("  Kiwi.Game: Rendering using WEBGL.")):(this._renderOption=t.RENDERER_CANVAS,console.log("  Kiwi.Game: WEBGL renderer requested but device does not support WEBGL. Rendering using CANVAS."));break;default:this._renderOption=t.RENDERER_CANVAS,console.log("  Kiwi.Game: Renderer specified, but is not a valid option. Defaulting to CANVAS.")}else this._renderOption=t.RENDERER_CANVAS,console.log("  Kiwi.Game: Renderer not specified. Defaulting to CANVAS");this.id=t.GameManager.register(this),this._startup=new t.System.Bootstrap,this.audio=new t.Sound.AudioManager(this),this.fileStore=new t.Files.FileStore(this),this.input=new t.Input.InputManager(this);var s=t.Stage.DEFAULT_WIDTH,a=t.Stage.DEFAULT_HEIGHT;if("undefined"!==o.width&&"number"==typeof o.width&&(s=o.width),"undefined"!==o.height&&"number"==typeof o.height&&(a=o.height),console.log("  Kiwi.Game: Stage Dimensions: "+s+"x"+a),"undefined"!==o.scaleType)switch(o.scaleType){case t.Stage.SCALE_FIT:console.log("  Kiwi.Game: Stage scaling set to FIT.");break;case t.Stage.SCALE_STRETCH:console.log("  Kiwi.Game: Stage scaling set to STRETCH.");break;case t.Stage.SCALE_NONE:console.log("  Kiwi.Game: Stage scaling set to NONE.");break;default:console.log("  Kiwi.Game: Stage specified, but is not a valid option. Set to NONE."),o.scaleType=0}else o.scaleType=0;this.stage=new t.Stage(this,i,s,a,o.scaleType),this.renderer=this._renderOption===t.RENDERER_CANVAS?new t.Renderers.CanvasRenderer(this):new t.Renderers.GLRenderManager(this),this.cameras=new t.CameraManager(this),this._deviceTargetOption!==t.TARGET_COCOON&&(this.huds=new t.HUD.HUDManager(this)),this.loader=new t.Files.Loader(this),this.states=new t.StateManager(this),this.rnd=new t.Utils.RandomDataGenerator([Date.now.toString()]),this.time=new t.Time.ClockManager(this),this.tweens=new t.Animations.Tweens.TweenManager(this),null!==n?this.states.addState(n,!0):console.log("  Kiwi.Game: Default State not passed."),this.pluginManager=new t.PluginManager(this,o.plugins),this.deviceTargetOption===t.TARGET_BROWSER?(console.log(""!==e?document.getElementById(e)?"  Kiwi.Game: Game being created inside "+e+".":'  Kiwi.Game: The element "'+e+'" could not be found. Appending the game to the body.':"  Kiwi.Game: No DOM parent specified. Appending the game to the body."),this._startup.boot(e,function(){return r._start()})):(""!==e&&console.log("  Kiwi.Game: Not Targetting a BROWSER. DOM Parent parameter ignored."),this._start())}return Object.defineProperty(e.prototype,"renderOption",{get:function(){return this._renderOption},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deviceTargetOption",{get:function(){return this._deviceTargetOption},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debugOption",{get:function(){return this._debugOption},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debugOption===t.DEBUG_ON},enumerable:!0,configurable:!0}),e.prototype.objType=function(){return"Game"},Object.defineProperty(e.prototype,"frameRate",{get:function(){return this._frameRate},set:function(t){t>60&&(t=60),t>=0&&(this._frameRate=t,this._interval=1e3/this._frameRate)},enumerable:!0,configurable:!0}),e.prototype._start=function(){var e=this;this.stage.boot(this._startup),this.renderer.boot(),this.cameras.boot(),this._deviceTargetOption!==t.TARGET_COCOON&&this.huds.boot(),this.time.boot(),this.input.boot(),this.audio.boot(),this.fileStore.boot(),this.loader.boot(),this.states.boot(),this.pluginManager.boot(),this._lastTime=Date.now(),this.raf=new t.Utils.RequestAnimationFrame(function(){return e._loop()}),this.raf.start(),this.bootCallbackOption&&(console.log("  Kiwi.Game: invoked boot callback"),this.bootCallbackOption())},e.prototype._loop=function(){this._delta=this.raf.currentTime-this._lastTime,this._delta>this._interval&&(this.time.update(),this.audio.update(),this.input.update(),this.tweens.update(),this.cameras.update(),this._deviceTargetOption!==t.TARGET_COCOON&&this.huds.update(),this.states.update(),this.pluginManager.update(),null!==this.states.current&&(this.cameras.render(),this.states.postRender()),this._lastTime=this.raf.currentTime-this._delta%this._interval)},e}();t.Game=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function e(e,i,n,o,r){this._scaleType=t.Stage.SCALE_NONE,this.offset=new t.Geom.Point,this.container=null,this._game=e,this.name=i,this.domReady=!1,this._alpha=1,this._x=0,this._y=0,this._width=n,this._height=o,this.color="ffffff",this._scale=new t.Geom.Point(1,1),this._scaleType=r,this.onResize=new t.Signal,this.onWindowResize=new t.Signal}return e.prototype.objType=function(){return"Stage"},Object.defineProperty(e.prototype,"scaleType",{get:function(){return this._scaleType},set:function(t){this._scaleType=t,this._scaleContainer()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._game.deviceTargetOption===t.TARGET_BROWSER&&(this.container.style.opacity=String(t.Utils.GameMath.clamp(e,1,0))),this._alpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._game.deviceTargetOption===t.TARGET_BROWSER?this.container.style.left=String(e+"px"):this._game.deviceTargetOption===t.TARGET_COCOON&&(this.canvas.style.left=String(e+"px")),this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._game.deviceTargetOption===t.TARGET_BROWSER?this.container.style.top=String(e+"px"):this._game.deviceTargetOption===t.TARGET_COCOON&&(this.canvas.style.top=String(e+"px")),this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scale.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scale.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t;var e=parseInt(t,16),i=e>>16&255,n=e>>8&255,o=255&e;this._normalizedColor={r:i/255,g:n/255,b:o/255,a:1}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rgbColor",{get:function(){return{r:255*this._normalizedColor.r,g:255*this._normalizedColor.g,b:255*this._normalizedColor.b}},set:function(t){this.color=this.componentToHex(t.r)+this.componentToHex(t.g)+this.componentToHex(t.b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalizedColor",{get:function(){return this._normalizedColor},enumerable:!0,configurable:!0}),e.prototype.boot=function(e){var i=this;this.domReady=!0,this.container=e.container,this._game.deviceTargetOption===t.TARGET_BROWSER&&(this.offset=this.getOffsetPoint(this.container),this._x=this.offset.x,this._y=this.offset.y,window.addEventListener("resize",function(t){return i._windowResized(t)},!0)),this._createCompositeCanvas(),this._game.deviceTargetOption===t.TARGET_COCOON?this._scaleContainer():this._calculateContainerScale()},e.prototype.getOffsetPoint=function(e,i){"undefined"==typeof i&&(i=new t.Geom.Point);var n=e.getBoundingClientRect(),o=e.clientTop||document.body.clientTop||0,r=e.clientLeft||document.body.clientLeft||0,s=window.pageYOffset||e.scrollTop||document.body.scrollTop,a=window.pageXOffset||e.scrollLeft||document.body.scrollLeft;return i.setTo(n.left+a-r,n.top+s-o)},e.prototype._windowResized=function(){this._calculateContainerScale(),this.onWindowResize.dispatch()},e.prototype._calculateContainerScale=function(){this.offset=this.getOffsetPoint(this.container),this._scaleContainer(),this._scale.x=this._width/this.container.clientWidth,this._scale.y=this._height/this.container.clientHeight},e.prototype._createCompositeCanvas=function(){this._game.deviceTargetOption==t.TARGET_COCOON?this.canvas=document.createElement(navigator.isCocoonJS?"screencanvas":"canvas"):(this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%"),this.canvas.id=this._game.id+"compositeCanvas",this.canvas.style.position="absolute",this.canvas.width=this.width,this.canvas.height=this.height,this._game.renderOption===t.RENDERER_CANVAS?(this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#fff",this.gl=null):this._game.renderOption===t.RENDERER_WEBGL&&(this.gl=this.canvas.getContext("webgl"),this.gl||(this.gl=this.canvas.getContext("experimental-webgl"),this.gl?console.warn("Kiwi.Stage: 'webgl' context is not available. Using 'experimental-webgl'"):console.error("Kiwi.Stage: WebGL rendering is not available despite the device apparently supporting it.")),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.ctx=null),this._game.deviceTargetOption===t.TARGET_BROWSER?this.container.appendChild(this.canvas):document.body.appendChild(this.canvas)},e.prototype.resize=function(e,i){this.canvas.height=i,this.canvas.width=e,this._height=i,this._width=e,this._game.deviceTargetOption===t.TARGET_BROWSER&&this._calculateContainerScale(),this.onResize.dispatch(this._width,this._height)},e.prototype.setRGBColor=function(t,e,i){return this.rgbColor={r:t,g:e,b:i},this.rgbColor},e.prototype.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},e.prototype.createDebugCanvas=function(){0!=t.Utils.Common.isUndefined(this.debugCanvas)&&(this._game.deviceTargetOption===t.TARGET_COCOON&&console.log("Debug canvas not supported in cocoon, creating canvas and context anyway"),this.debugCanvas=document.createElement("canvas"),this.debugCanvas.id=this._game.id+"debugCanvas",this.debugCanvas.style.position="absolute",this.debugCanvas.width=this.width,this.debugCanvas.height=this.height,this.debugCanvas.style.width="100%",this.debugCanvas.style.height="100%",this.dctx=this.debugCanvas.getContext("2d"),this.clearDebugCanvas(),this._game.deviceTargetOption===t.TARGET_BROWSER&&this.container.appendChild(this.debugCanvas))},e.prototype.clearDebugCanvas=function(t){this.dctx.fillStyle=t||"rgba(255,0,0,.2)",this.dctx.clearRect(0,0,this.width,this.height),this.dctx.fillRect(0,0,this.width,this.height)},e.prototype.toggleDebugCanvas=function(){this.debugCanvas.style.display="none"===this.debugCanvas.style.display?"block":"none"},e.prototype._scaleContainer=function(){if(this._game.deviceTargetOption==t.TARGET_BROWSER&&(this.container.style.width=String(this._width+"px"),this.container.style.height=String(this._height+"px"),this._scaleType==t.Stage.SCALE_NONE&&(this.container.style.maxWidth="",this.container.style.minWidth=""),(this._scaleType==t.Stage.SCALE_STRETCH||this._scaleType==t.Stage.SCALE_FIT)&&(this.container.style.minWidth="100%",this.container.style.maxWidth="100%"),this._scaleType==t.Stage.SCALE_STRETCH?(this.container.style.minHeight="100%",this.container.style.maxHeight="100%"):(this.container.style.minHeight="",this.container.style.maxHeight=""),this._scaleType==t.Stage.SCALE_FIT&&(this.container.style.height=String(this.container.clientWidth/this._width*this._height)+"px")),this._game.deviceTargetOption==t.TARGET_COCOON)switch(this._scaleType){case t.Stage.SCALE_FIT:this.canvas.style.cssText="idtkscale:ScaleAspectFit";break;case t.Stage.SCALE_STRETCH:this.canvas.style.cssText="idtkscale:ScaleToFill";break;case t.Stage.SCALE_NONE:this.canvas.style.cssText=""}},e.DEFAULT_WIDTH=800,e.DEFAULT_HEIGHT=600,e.SCALE_NONE=0,e.SCALE_FIT=1,e.SCALE_STRETCH=2,e}();t.Stage=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function t(t,e){this._components={},this._type=t,this._owner=e}return t.prototype.objType=function(){return"ComponentManager"},t.prototype.hasComponent=function(t){return this._components[t]?!0:!1},t.prototype.hasActiveComponent=function(t){return this._components[t]&&this._components[t].active===!0?!0:!1},t.prototype.getComponent=function(t){return this._components[t]?this._components[t]:null},t.prototype.add=function(t){return this._components[t.name]=t,t},t.prototype.addBatch=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];for(var i=0;i<t.length;i++)this.add(t[i])},t.prototype.removeComponent=function(t,e){"undefined"==typeof e&&(e=!0);var i=t.name;return this._components[i]?(e&&this._components[i].destroy(),delete this._components[i],!0):!1},t.prototype.removeComponentByName=function(t,e){return"undefined"==typeof e&&(e=!0),this._components[t]?(e&&this._components[t].destroy(),delete this._components[t],!0):!1},t.prototype.removeAll=function(t){"undefined"==typeof t&&(t=!0);for(var e in this._components)this.removeComponent(this._components[e],t)},t.prototype.preUpdate=function(){for(var t in this._components)this._components[t].active&&this._components[t].preUpdate()},t.prototype.update=function(){for(var t in this._components)this._components[t].active&&this._components[t].update()},t.prototype.postUpdate=function(){for(var t in this._components)this._components[t].active&&this._components[t].postUpdate()},t.prototype.preRender=function(){for(var t in this._components)this._components[t].active&&this._components[t].preRender()},t.prototype.render=function(){for(var t in this._components)this._components[t].active&&this._components[t].render()},t.prototype.postRender=function(){for(var t in this._components)this._components[t].active&&this._components[t].postRender()},t}();t.ComponentManager=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function e(t,e){this._game=t,this._plugins=e||new Array,this._bootObjects=new Array,this.validatePlugins(),this._createPlugins()}return Object.defineProperty(e,"availablePlugins",{get:function(){for(var t=[],i=0;i<e._availablePlugins.length;i++)t.push({name:e._availablePlugins[i].name,version:e._availablePlugins[i].version});return t},enumerable:!0,configurable:!0}),e.register=function(t){if(console.log("Kiwi.PluginManager: Attempting to register plugin :"+t.name),-1==this._availablePlugins.indexOf(t)){for(var e=!0,i=0;i<this._availablePlugins.length;i++)t.name===this._availablePlugins[i].name&&(e=!1);e?(this._availablePlugins.push(t),console.log("  Kiwi.PluginManager: Registered plugin "+t.name+": version "+t.version)):console.log("  Kiwi.PluginManager: A plugin with the same name has already been registered. Ignoring this plugin.")}else console.log("  Kiwi.PluginManager: This plugin has already been registered. Ignoring second registration.")},Object.defineProperty(e.prototype,"objType",{get:function(){return"PluginManager"},enumerable:!0,configurable:!0}),e.prototype.validatePlugins=function(){var e=new Array;console.log("Kiwi.PluginManager: Validating Plugins");for(var i=0;i<this._plugins.length;i++){var n=this._plugins[i];if("string"==typeof n||n instanceof String)if(t.Plugins.hasOwnProperty(n)&&this.pluginIsRegistered(n))if(e.push(n),console.log("  Kiwi.PluginManager: Plugin '"+n+"' appears to be valid."),console.log("  Kiwi.PluginManager: Name:"+t.Plugins[n].name),console.log("  Kiwi.PluginManager: Version:"+t.Plugins[n].version),"undefined"!=typeof t.Plugins[n].minimumKiwiVersion){console.log("  Kiwi.PluginManager: "+n+" requires minimum Kiwi version "+t.Plugins[n].minimumKiwiVersion);var o=t.Utils.Version.parseVersion(t.VERSION),r=t.Utils.Version.parseVersion(t.Plugins[n].minimumKiwiVersion);o.majorVersion>r.majorVersion?console.warn("  Kiwi.PluginManager: This major version of Kiwi is greater than that required by '"+n+"'. It is unknown whether this plugin will work with this version of Kiwi"):t.Utils.Version.greaterOrEqual(t.VERSION,t.Plugins[n].minimumKiwiVersion)?console.log("  Kiwi.PluginManager: Kiwi version meets minimum version requirements for '"+n+"'."):console.warn("  Kiwi.PluginManager: Kiwi version ("+t.VERSION+") does not meet minimum version requirements for the plugin ("+t.Plugins[n].minimumKiwiVersion+").")}else console.warn("  Kiwi.PluginManager: '"+n+"' is missing the minimumKiwiVersion property. It is unknown whether '"+n+"' will work with this version of Kiwi");else console.log("  Kiwi.PluginManager: Plugin '"+n+"' appears to be invalid. No property with that name exists on the Kiwi.Plugins object or the Plugin is not registered. Check that the js file containing the plugin has been included. This plugin will be ignored");else console.log("  Kiwi.PluginManager: The supplied plugin name at index "+i+"is not a string and will be ignored")}this._plugins=e;for(var i=0;i<this._plugins.length;i++){var s=this._plugins[i],n=t.Plugins[s];if("undefined"!=typeof n.pluginDependencies)if(0===n.pluginDependencies.length)console.log("  Kiwi.PluginManager: '"+s+"' does not depend on any other plugins.");else{console.log("  Kiwi.PluginManager: '"+s+"' depends on the following plugins:");for(var a=0;a<n.pluginDependencies.length;a++)console.log(n.pluginDependencies[a].name,n.pluginDependencies[a].minimumVersion),this.validMinimumPluginVersionExists(n.pluginDependencies[a].name,n.pluginDependencies[a].minimumVersion)||console.warn("  Kiwi.PluginManager: '"+n.pluginDependencies[a].name+" hasn't been added to this game via the config, doesn't exist, or does not meet minimum version requirement ( "+n.pluginDependencies[a].minimumVersion+").")}else console.log("  Kiwi.PluginManager: '"+s+"' does not depend on any other plugins.")}},e.prototype.validMinimumPluginVersionExists=function(e,i){var n=!1,o=!1;return-1!==this._plugins.indexOf(e)&&(n=!0,t.Utils.Version.greaterOrEqual(i,t.Plugins[e].version)&&(o=!0)),n&&o},e.prototype.pluginIsRegistered=function(e){for(var i=!1,n=0;n<t.PluginManager._availablePlugins.length;n++)t.PluginManager._availablePlugins[n].name===e&&(i=!0);return i},e.prototype._createPlugins=function(){for(var e=0;e<this._plugins.length;e++){var i=this._plugins[e];if(t.Plugins[i].hasOwnProperty("create")){var n=t.Plugins[i].create(this._game);n&&this._bootObjects.push(n)}}},e.prototype.boot=function(){for(var t=0;t<this._bootObjects.length;t++)"boot"in this._bootObjects[t]?this._bootObjects[t].boot.call(this._bootObjects[t]):console.warn("Kiwi.PluginManager: Warning! No boot function found on boot object")},e.prototype.update=function(){for(var t=0;t<this._bootObjects.length;t++)"update"in this._bootObjects[t]&&this._bootObjects[t].update.call(this._bootObjects[t])},e._availablePlugins=new Array,e}();t.PluginManager=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function e(t){this._game=t,this._cameras=[],this._nextCameraID=0}return e.prototype.objType=function(){return"CameraManager"},e.prototype.boot=function(){this.create("defaultCamera",0,0,this._game.stage.width,this._game.stage.height),this.defaultCamera=this._cameras[0]},e.prototype.create=function(e,i,n,o,r){var s=new t.Camera(this._game,this._nextCameraID++,e,i,n,o,r);return this._cameras.push(s),s},e.prototype.remove=function(t){var e=this._cameras.indexOf(t);return-1!==e?(this._cameras.splice(e,1),!0):!1},e.prototype.update=function(){if(0===this._cameras.length)return!1;for(var t=0;t<this._cameras.length;t++)this._cameras[t].update()},e.prototype.render=function(){if(0===this._cameras.length)return!1;for(var t=0;t<this._cameras.length;t++)this._cameras[t].render()},e.prototype.removeAll=function(){this._cameras=[]},e}();t.CameraManager=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function t(t,e){this.name="",this.isPersistent=!1,this.isCreated=!1,this.isInitialised=!1,this.isReady=!1,this.hasPreloader=!1,this.runCount=0,this.type=0,this._state=t,this.name=e,"function"==typeof this._state.preload&&(this.hasPreloader=!0)}return t.prototype.objType=function(){return"StateConfig"},t.prototype.reset=function(){this.isReady=!1,this.isCreated=!1,this.createParams=[],this.initParams=[]},t}();t.StateConfig=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function e(t){this.current=null,this._newStateKey=null,this._game=t,this._states=[]}return e.prototype.objType=function(){return"StateManager"},e.prototype.checkKeyExists=function(t){for(var e=0;e<this._states.length;e++)if(this._states[e].config.name===t)return!0;return!1},e.prototype.checkValidState=function(t){return t.game&&t.config?!0:!1},e.prototype.addState=function(t,e){"undefined"==typeof e&&(e=!1),console.log("Kiwi.StateManager: Adding state");var i;return i="function"==typeof t?new t:"string"==typeof t?window[t]:t,i.config.name&&this.checkKeyExists(i.config.name)===!0?(this._game.debug&&console.error("  Kiwi.StateManager: Could not add "+i.config.name+" as a State with that name already exists."),!1):(i.game=this._game,this.checkValidState(i)===!1?(this._game.debug&&console.error("  Kiwi.StateManager: "+i.config.name+" isn't a valid state. Make sure you are using the Kiwi.State class!"),!1):(this._states.push(i),this._game.debug&&console.log("  Kiwi.StateManager: "+i.config.name+" was successfully added."),e===!0&&this.setCurrentState(i.config.name),!0))},e.prototype.boot=function(){},e.prototype.setCurrentState=function(t){return null!==this.current&&this.current.config.name===t||this.checkKeyExists(t)===!1?!1:(this._game.debug&&console.log('Kiwi.StateManager: Switching to "'+t+'" State.'),this._newStateKey=t,!0)},e.prototype.bootNewState=function(){null!==this.current&&(this.current.shutDown(),this._game.input.reset(),this.current.destroy(!0),this._game.fileStore.removeStateFiles(this.current),this.current.config.reset()),this.current=this.getState(this._newStateKey),this._newStateKey=null,this.checkInit(),this.checkPreload()},e.prototype.switchState=function(t,e,i,n){if("undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),null!==this.current&&this.current.config.isReady===!1)return this._game.debug&&console.error("Kiwi.StateManager: Cannot change to a new state till the current state has finished loading!"),!1;if(this.checkKeyExists(t)===!1&&null!==e&&this.addState(e,!1)===!1)return!1;if(null!==i||null!==n){var o=this.getState(t);o.config.initParams=[],o.config.createParams=[];for(var r in i)o.config.initParams.push(i[r]);for(var s in n)o.config.createParams.push(n[s])}return this.setCurrentState(t)},e.prototype.getState=function(t){for(var e=0;e<this._states.length;e++)if(this._states[e].config.name===t)return this._states[e];return null},e.prototype.checkPreload=function(){var t=this;this.rebuildLibraries(),this.current.config.hasPreloader===!0?(this._game.loader.init(function(e,i,n){return t.onLoadProgress(e,i,n)},function(){return t.onLoadComplete()}),this.current.preload(),this._game.loader.startLoad()):(this.current.config.isReady=!0,this.callCreate())},e.prototype.callCreate=function(){this._game.debug&&console.log("Kiwi.StateManager: Calling "+this.current.name+":Create"),this.current.config.createParams?this.current.create.apply(this.current,this.current.config.createParams):this.current.create.call(this.current),this.current.config.runCount++,this.current.config.isCreated=!0},e.prototype.checkInit=function(){this.current.config.isInitialised===!1&&(this.current.boot(),this.current.config.initParams?this.current.init.apply(this.current,this.current.config.initParams):this.current.init.call(this.current),this.current.config.isInitialised=!0)},e.prototype.onLoadProgress=function(t,e,i){this.current.loadProgress(t,e,i)},e.prototype.onLoadComplete=function(){this.current.loadComplete(),this.rebuildLibraries(),this.current.config.isReady=!0,this.callCreate()},e.prototype.rebuildLibraries=function(){this.current.audioLibrary.rebuild(this._game.fileStore,this.current),this.current.dataLibrary.rebuild(this._game.fileStore,this.current),this.current.textureLibrary.rebuild(this._game.fileStore,this.current),this._game.renderOption==t.RENDERER_WEBGL&&this._game.renderer.initState(this.current)},e.prototype.update=function(){null!==this.current&&(this.current.config.isReady===!0?(this.current.preUpdate(),this.current.update(),this.current.postUpdate()):this.current.loadUpdate()),null!==this._newStateKey&&this.bootNewState()},e.prototype.postRender=function(){null!==this.current&&this.current.config.isReady===!0&&this.current.postRender()},e}();t.StateManager=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function e(e,i,n){this._parent=null,this._alpha=1,this._visible=!0,this.width=0,this.height=0,this.atlas=null,this._cellIndex=0,this.name="",this._clock=null,this.state=e,this.game=e.game,this.id=this.game.rnd.uuid(),this.state.addToTrackingList(this),this._clock=this.game.time.clock,this._exists=!0,this._active=!0,this._willRender=!0,this.components=new t.ComponentManager(t.ENTITY,this),this.transform=new t.Geom.Transform,this.transform.x=i,this.transform.y=n}return Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(t){this.transform.parent=null!==t?t.transform:null,this._parent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.transform.x},set:function(t){this.transform.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.transform.y},set:function(t){this.transform.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this.transform.scaleX},set:function(t){this.transform.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this.transform.scaleY},set:function(t){this.transform.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotPointX",{get:function(){return this.transform.rotPointX},set:function(t){this.transform.rotPointX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotPointY",{get:function(){return this.transform.rotPointY},set:function(t){this.transform.rotPointY=t},enumerable:!0,configurable:!0}),e.prototype.childType=function(){return t.ENTITY},Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){0>=t&&(t=0),t>1&&(t=1),this._alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellIndex",{get:function(){return this._cellIndex},set:function(t){if(null!==this.atlas){var e=this.atlas.cells[t];void 0!==e?(this._cellIndex=t,this.width=e.w,this.height=e.h):this.game.debug&&console.error("Could not the set the cellIndex of a Entity, to cell that does not exist on its TextureAtlas.")}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._exists},set:function(t){this._exists=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"willRender",{get:function(){return this._willRender},set:function(t){this._willRender=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputEnabled",{get:function(){return this._inputEnabled},set:function(t){this._inputEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty},set:function(t){this._dirty=t},enumerable:!0,configurable:!0}),e.prototype.objType=function(){return"Entity"},e.prototype.update=function(){},e.prototype.render=function(){},e.prototype.renderGL=function(t,e,i){"undefined"==typeof i&&(i=null)},e.prototype.destroy=function(t){"undefined"==typeof t&&(t=!1),this._exists=!1,this._active=!1,this._visible=!1,t===!0&&(null!==this.parent&&"undefined"!=typeof this.parent&&this.parent.removeChild(this),this.state&&this.state.removeFromTrackingList(this),delete this._parent,delete this.transform,delete this._clock,delete this.state,delete this.game,delete this.atlas,this.components&&this.components.removeAll(!0),delete this.components)},e}();t.Entity=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function t(t,e){this.active=!0,this.dirty=!1,this.owner=t,this.game=this.owner.game,this.name=e,this.active=!0}return t.prototype.objType=function(){return"Component"},t.prototype.preUpdate=function(){},t.prototype.update=function(){},t.prototype.postUpdate=function(){},t.prototype.destroy=function(){this.active=!1,delete this.game,delete this.owner,this.name=""},t}();t.Component=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function e(e,i){"undefined"==typeof i&&(i=""),this.name="",this._parent=null,this.game=null,this.state=null,this._dirty=!0,this._tempRemoveChildren=null,null!==e&&(this.state=e,this.game=this.state.game,this.id=this.game.rnd.uuid(),this.state.addToTrackingList(this)),this.name=i,this.components=new t.ComponentManager(t.GROUP,this),this._exists=!0,this._active=!0,this._willRender=!0,this._visible=!0,this.transform=new t.Geom.Transform,this.members=[]}return e.prototype.objType=function(){return"Group"},e.prototype.childType=function(){return t.GROUP},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(t){this.transform.parent=null!==t?t.transform:null,this._parent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.transform.x},set:function(t){this.transform.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.transform.y},set:function(t){this.transform.y=t
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this.transform.scaleX},set:function(t){this.transform.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this.transform.scaleY},set:function(t){this.transform.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this.members.length},Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty},set:function(t){if(void 0!==t){this._dirty=t;for(var e=0;e<this.members.length;e++)this.members[e].dirty=t}},enumerable:!0,configurable:!0}),e.prototype.contains=function(t){return-1===this.members.indexOf(t)?!1:!0},e.prototype.containsDescendant=function(e){for(var i=0;i<this.members.length;i++){console.log(i);var n=this.members[i];if(n.id==e.id||n.childType()==t.Group&&n.containsDesendant(e))return!0}return!1},e.prototype.containsAncestor=function(t,e){return null===t.parent||void 0===t.parent?!1:t.parent==e?!0:t.parent.containsAncestor(t.parent,e)},e.prototype.addChild=function(e){return e.childType()!==t.STATE&&e!=this?(null!==e.parent&&e.parent.removeChild(e),this.members.push(e),e.parent=this,e):void 0},e.prototype.addChildAt=function(e,i){return e.childType()!==t.STATE&&e!=this?(null!==e.parent&&e.parent.removeChild(e),this.members.splice(i,0,e),e.parent=this,e):void 0},e.prototype.addChildBefore=function(t,e){if(t.transform.parent!==this.transform&&e.transform.parent===this.transform){var i=this.getChildIndex(e);this.members.splice(i,0,t),t.parent=this}return t},e.prototype.addChildAfter=function(t,e){if(t.transform.parent!==this.transform&&e.transform.parent===this.transform){var i=this.getChildIndex(e)+1;this.members.splice(i,0,t),t.parent=this}return t},e.prototype.getChildAt=function(t){return this.members[t]?this.members[t]:null},e.prototype.getChildByName=function(t){for(var e=0;e<this.members.length;e++)if(this.members[e].name===t)return this.members[e];return null},e.prototype.getChildByID=function(t){for(var e=0;e<this.members.length;e++)if(this.members[e].id===t)return this.members[e];return null},e.prototype.getChildIndex=function(t){return this.members.indexOf(t)},e.prototype.removeChild=function(t,e){if("undefined"==typeof e&&(e=!1),t.parent===this){var i=this.getChildIndex(t);i>-1&&(this.members.splice(i,1),t.parent=null,e&&t.destroy())}return t},e.prototype.removeChildAt=function(t){if(this.members[t]){var e=this.members[t];return this.removeChild(e)}return null},e.prototype.removeChildren=function(t,e,i){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=2147483647),"undefined"==typeof i&&(i=!1),e-=t;for(var n=this.members.splice(t,e),o=0;o<n.length;o++)n[o].parent=null,i&&n[o].destroy();return n.length},e.prototype.setChildIndex=function(t,e){return t.parent!==this||this.getChildIndex(t)===e?!1:(this.removeChild(t),this.addChildAt(t,e),!0)},e.prototype.swapChildren=function(t,e){if(t.parent!==this||e.parent!==this)return!1;var i=this.getChildIndex(t),n=this.getChildIndex(e);return-1!==i&&-1!==n&&i!==n?(this.members[i]=e,this.members[n]=t,!0):!1},e.prototype.swapChildrenAt=function(t,e){var i=this.getChildAt(t),n=this.getChildAt(e);return null!==i&&null!==n?i==n||i.parent!==this||n.parent!==this?!1:(this.members[t]=n,this.members[e]=i,!0):!1},e.prototype.replaceChild=function(t,e){if(t===e)return!1;var i=this.getChildIndex(t);return i>-1?(e.parent&&e.parent.removeChild(e),this.removeChildAt(i),this.addChildAt(e,i),e.parent=null,!0):!1},e.prototype.forEach=function(t,e){for(var i=[],n=0;n<arguments.length-2;n++)i[n]=arguments[n+2];this.members.length>0&&this.members.forEach(function(n){return e.apply(t,[n].concat(i))})},e.prototype.forEachAlive=function(t,e){for(var i=[],n=0;n<arguments.length-2;n++)i[n]=arguments[n+2];this.members.length>0&&this.members.forEach(function(n){n.exists&&e.apply(t,[n].concat(i))})},e.prototype.setAll=function(t,e,i){if(null===t)for(var n=0;n<this.members.length;n++)this.members[n][e]=i;else for(var n=0;n<this.members.length;n++)this.members[n][t][e]=i},e.prototype.callAll=function(t,e,i){if(null===t)for(var n=0;n<this.members.length;n++)this.members[n][e].apply(this.members[n],i);else for(var n=0;n<this.members.length;n++)this.members[n][t][e].apply(this.members[n][t],i)},e.prototype.update=function(){if(this.components.preUpdate(),this.components.update(),this.members.length>0)for(var t=0;t<this.members.length;t++)this.members[t].active===!0&&this.members[t].update(),this.members[t].exists===!1&&this.members[t].destroy(!0);this.components.postUpdate()},Object.defineProperty(e.prototype,"exists",{get:function(){return this._exists},set:function(t){this._exists=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t},enumerable:!0,configurable:!0}),e.prototype.render=function(){},e.prototype.removeFirstAlive=function(t){return"undefined"==typeof t&&(t=!1),this.removeChild(this.getFirstAlive(),t)},e.prototype.getFirstAlive=function(){for(var t=0;t<this.members.length;t++)if(this.members[t].exists===!0)return this.members[t];return null},e.prototype.getFirstDead=function(){for(var t=0;t<this.members.length;t++)if(this.members[t].exists===!1)return this.members[t];return null},e.prototype.countLiving=function(){for(var t=0,e=0;e<this.members.length;e++)this.members[e].exists===!0&&t++;return t},e.prototype.countDead=function(){for(var t=0,e=0;e<this.members.length;e++)this.members[e].exists===!1&&t++;return t},e.prototype.getRandom=function(t,e){if("undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),0===this.members.length)return null;0===e&&(e=this.members.length),(0>t||t>e)&&(t=0);var i=t+Math.random()*(t+e);return i>this.members.length?this.members[this.members.length-1]:this.members[i]},e.prototype.clear=function(){this.members.length=0},Object.defineProperty(e.prototype,"willRender",{get:function(){return this._willRender},set:function(t){this._willRender=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible=t},enumerable:!0,configurable:!0}),e.prototype.destroy=function(t,e){if("undefined"==typeof t&&(t=!1),"undefined"==typeof e&&(e=!0),this._exists=!1,this._active=!1,this._visible=!1,t===!0){if(null!==this._tempRemoveChildren&&(e=this._tempRemoveChildren),1==e)for(var i=0;i<this.members.length;i++)this.members[i].destroy(!0);else this.removeChildren();null!==this.parent&&this.parent.removeChild(this),this.state&&this.state.removeFromTrackingList(this),delete this.transform,this.components&&this.components.removeAll(),delete this.components,delete this.name,delete this.members,delete this.game,delete this.state,delete this._tempRemoveChildren}else this._tempRemoveChildren=e},e}();t.Group=e}(Kiwi||(Kiwi={}));var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},Kiwi;!function(t){var e=function(e){function i(i){e.call(this,null,i),this.game=null,this.config=new t.StateConfig(this,i),this.components=new t.ComponentManager(t.STATE,this),this.transform.parent=null,this._trackingList=[]}return __extends(i,e),i.prototype.objType=function(){return"State"},i.prototype.childType=function(){return t.GROUP},i.prototype.boot=function(){this.textureLibrary=new t.Textures.TextureLibrary(this.game),this.textures=this.textureLibrary.textures,this.audioLibrary=new t.Sound.AudioLibrary(this.game),this.audio=this.audioLibrary.audio,this.dataLibrary=new t.Files.DataLibrary(this.game),this.data=this.dataLibrary.data},i.prototype.setType=function(t){this.config.isInitialised===!1&&(this.config.type=t)},i.prototype.init=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0]},i.prototype.preload=function(){},i.prototype.loadProgress=function(){},i.prototype.loadComplete=function(){},i.prototype.loadUpdate=function(){for(var t=0;t<this.members.length;t++)this.members[t].active===!0&&this.members[t].update()},i.prototype.create=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0]},i.prototype.preUpdate=function(){this.components.preUpdate()},i.prototype.update=function(){this.components.update();for(var t=0;t<this.members.length;t++)this.members[t].active===!0&&this.members[t].update(),this.members[t].exists===!1&&this.members[t].destroy(!0)},i.prototype.postUpdate=function(){this.components.postUpdate()},i.prototype.postRender=function(){},i.prototype.shutDown=function(){},i.prototype.addImage=function(t,e,i,n,o,r,s){"undefined"==typeof i&&(i=!0),this.game.loader.addImage(t,e,n,o,r,s,i)},i.prototype.addSpriteSheet=function(t,e,i,n,o,r,s,a,h,u,c,l){"undefined"==typeof o&&(o=!0),this.game.loader.addSpriteSheet(t,e,i,n,r,s,a,h,u,c,l,o)},i.prototype.addTextureAtlas=function(t,e,i,n,o){"undefined"==typeof o&&(o=!0),this.game.loader.addTextureAtlas(t,e,i,n,o)},i.prototype.addJSON=function(t,e,i){"undefined"==typeof i&&(i=!0),this.game.loader.addJSON(t,e,i)},i.prototype.addAudio=function(t,e,i){"undefined"==typeof i&&(i=!0),this.game.loader.addAudio(t,e,i)},i.prototype.addToTrackingList=function(t){-1===this._trackingList.indexOf(t)&&this._trackingList.push(t)},i.prototype.removeFromTrackingList=function(t){var e=this._trackingList.indexOf(t);e>-1&&this._trackingList.splice(e,1)},i.prototype.destroyUnused=function(){for(var t=0,e=0;e<this._trackingList.length;e++)this.containsAncestor(this._trackingList[e],this)===!1&&(this._trackingList[e].destroy(),this._trackingList.splice(e,1),e--,t++);return t},i.prototype.destroy=function(t){if("undefined"==typeof t&&(t=!0),1==t){for(var e=0;e<this._trackingList.length;e++)this._trackingList[e].destroy(!0,!1);this._trackingList=[];for(var e=0;e<this.members.length;e++)this._destroyChildren(this.members[e]),delete this.members[e];this.members=[]}},i.prototype._destroyChildren=function(e){if(e.childType()==t.GROUP)for(var i=0;i<e.members.length;i++)this._destroyChildren(e.members[i]);e.destroy(!0)},i}(t.Group);t.State=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function e(e,i,n,o,r,s,a){this.fitToStage=!0,this._game=e,this.id=i,this.name=n,this.width=s,this.height=a,this.transform=new t.Geom.Transform(o,r),this.transform.rotPointX=o+s/2,this.transform.rotPointY=r+a/2,this._game.stage.onResize.add(this._updatedStageSize,this)}return e.prototype.objType=function(){return"Camera"},e.prototype._updatedStageSize=function(t,e){this.width=t,this.height=e},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty},set:function(t){this._dirty=t},enumerable:!0,configurable:!0}),e.prototype.transformPoint=function(t){var e=t.clone(),i=this.transform.getConcatenatedMatrix();return i.append(1,0,0,1,-this.transform.rotPointX,-this.transform.rotPointY),i.invert(),i.transformPoint(e)},e.prototype.update=function(){},e.prototype.render=function(){this._game.renderer.render(this)},e}();t.Camera=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function e(){this._bindings=[],this._prevParams=null,this.memorize=!1,this._shouldPropagate=!0,this.active=!0}return e.prototype.objType=function(){return"Signal"},e.prototype.validateListener=function(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},e.prototype._registerListener=function(e,i,n,o){var r,s=this._indexOfListener(e,n);if(-1!==s){if(r=this._bindings[s],r.isOnce()!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else r=new t.SignalBinding(this,e,i,n,o),this._addBinding(r);return this.memorize&&this._prevParams&&r.execute(this._prevParams),r},e.prototype._addBinding=function(t){var e=this._bindings.length;do--e;while(this._bindings[e]&&t.priority<=this._bindings[e].priority);this._bindings.splice(e+1,0,t)},e.prototype._indexOfListener=function(t,e){for(var i,n=this._bindings.length;n--;)if(i=this._bindings[n],i.getListener()===t&&i.context===e)return n;return-1},e.prototype.has=function(t,e){return"undefined"==typeof e&&(e=null),-1!==this._indexOfListener(t,e)},e.prototype.add=function(t,e,i){return"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),this.validateListener(t,"add"),this._registerListener(t,!1,e,i)},e.prototype.addOnce=function(t,e,i){return"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),this.validateListener(t,"addOnce"),this._registerListener(t,!0,e,i)},e.prototype.remove=function(t,e){"undefined"==typeof e&&(e=null),this.validateListener(t,"remove");var i=this._indexOfListener(t,e);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),t},e.prototype.removeAll=function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},e.prototype.getNumListeners=function(){return this._bindings.length},e.prototype.halt=function(){this._shouldPropagate=!1},e.prototype.dispatch=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];if(this.active){var i,n=this._bindings.length;if(this.memorize&&(this._prevParams=t),n){i=this._bindings.slice(0),this._shouldPropagate=!0;do n--;while(i[n]&&this._shouldPropagate&&i[n].execute(t)!==!1)}}},e.prototype.forget=function(){this._prevParams=null},e.prototype.dispose=function(){this.removeAll(),delete this._bindings,delete this._prevParams},e.VERSION="1.0.0",e}();t.Signal=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){var e=function(){function t(t,e,i,n,o){"undefined"==typeof o&&(o=0),this.active=!0,this.params=null,this._listener=e,this._isOnce=i,this.context=n,this._signal=t,this.priority=o||0}return t.prototype.objType=function(){return"SignalBinding"},t.prototype.execute=function(t){var e,i;return this.active&&this._listener&&(i=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,i),this._isOnce&&this.detach()),e},t.prototype.detach=function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},t.prototype.isBound=function(){return!!this._signal&&!!this._listener},t.prototype.isOnce=function(){return this._isOnce},t.prototype.getListener=function(){return this._listener},t.prototype.getSignal=function(){return this._signal},t.prototype._destroy=function(){delete this._signal,delete this._listener,delete this.context},t}();t.SignalBinding=e}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(e){function i(i,n,o,r,s){return"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=!1),e.call(this,i,o,r),"undefined"==typeof n?(console.error("A Texture Atlas was not passed when instantiating a new Sprite."),this.visible=!1,void(this.active=!1)):(this.game.renderOption===t.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")),this.atlas=n,this.name=this.atlas.name,this.cellIndex=this.atlas.cellIndex,this.width=n.cells[this.cellIndex].w,this.height=n.cells[this.cellIndex].h,this.transform.rotPointX=this.width/2,this.transform.rotPointY=this.height/2,this.box=this.components.add(new t.Components.Box(this,o,r,this.width,this.height)),this.input=this.components.add(new t.Components.Input(this,this.box,s)),void(this.atlas.type===t.Textures.TextureAtlas.SINGLE_IMAGE?(this.animation=null,this._isAnimated=!1):(this.animation=this.components.add(new t.Components.AnimationManager(this)),this._isAnimated=!0)))}return __extends(i,e),i.prototype.objType=function(){return"Sprite"},i.prototype.update=function(){e.prototype.update.call(this),this._isAnimated&&(this.animation.update(),this.width=this.atlas.cells[this.cellIndex].w,this.height=this.atlas.cells[this.cellIndex].h),this.input.update()},i.prototype.render=function(t){if(e.prototype.render.call(this,t),this.alpha>0){var i=this.game.stage.ctx;i.save(),this.alpha>0&&this.alpha<=1&&(i.globalAlpha=this.alpha);var n=this.transform,o=n.getConcatenatedMatrix();i.transform(o.a,o.b,o.c,o.d,o.tx,o.ty);var r=this.atlas.cells[this.cellIndex];i.drawImage(this.atlas.image,r.x,r.y,r.w,r.h,-n.rotPointX,-n.rotPointY,r.w,r.h),i.restore()}},i.prototype.renderGL=function(t,e,i){"undefined"==typeof i&&(i=null),this.glRenderer.addToBatch(t,this,e)},i}(t.Entity);e.Sprite=i}(t.GameObjects||(t.GameObjects={})),t.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(e){function i(i,n,o,r){return"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),e.call(this,i,o,r),this.game.renderOption===t.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")),"undefined"==typeof n?(console.error("A Texture Atlas was not passed when instantiating a new Static Image."),this.visible=!1,void(this.active=!1)):(this.atlas=n,this.cellIndex=this.atlas.cellIndex,this.width=n.cells[this.cellIndex].w,this.height=n.cells[this.cellIndex].h,this.transform.rotPointX=this.width/2,this.transform.rotPointY=this.height/2,void(this.box=this.components.add(new t.Components.Box(this,o,r,this.width,this.height))))}return __extends(i,e),i.prototype.objType=function(){return"Sprite"},i.prototype.render=function(t){if(e.prototype.render.call(this,t),this.alpha>0){var i=this.game.stage.ctx;i.save(),this.alpha>0&&this.alpha<=1&&(i.globalAlpha=this.alpha);var n=this.transform,o=n.getConcatenatedMatrix();i.transform(o.a,o.b,o.c,o.d,o.tx,o.ty);var r=this.atlas.cells[this.cellIndex];i.drawImage(this.atlas.image,r.x,r.y,r.w,r.h,-n.rotPointX,-n.rotPointY,r.w,r.h),i.restore()}},i.prototype.renderGL=function(t,e,i){"undefined"==typeof i&&(i=null),this.glRenderer.addToBatch(t,this,e)},i}(t.Entity);e.StaticImage=i}(t.GameObjects||(t.GameObjects={})),t.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(e){function i(i,n,o,r,s,a,h,u){"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s="#000000"),"undefined"==typeof a&&(a=32),"undefined"==typeof h&&(h="normal"),"undefined"==typeof u&&(u="sans-serif"),e.call(this,i,o,r),this._tempDirty=!0,this.game.renderOption===t.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")),this._text=n,this._fontWeight=h,this._fontSize=a,this._fontColor=s,this._fontFamily=u,this._textAlign="left",this._baseline="top",this._tempDirty=!0,this._canvas=document.createElement("canvas"),this._canvas.width=2,this._canvas.height=2,this._ctx=this._canvas.getContext("2d"),this.atlas=new t.Textures.SingleImage(this.game.rnd.uuid(),this._canvas),this.state.textureLibrary.add(this.atlas),this.atlas.dirty=!0,this._renderText()}return __extends(i,e),i.prototype.objType=function(){return"Textfield"},Object.defineProperty(i.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._fontColor},set:function(t){this._fontColor=t,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight=t,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this._fontFamily=t,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textAlign",{get:function(){return this._textAlign},set:function(t){this._textAlign=t,this._tempDirty=!0},enumerable:!0,configurable:!0}),i.prototype._renderText=function(){this._ctx.font=this._fontWeight+" "+this._fontSize+"px "+this._fontFamily;var e=this._ctx.measureText(this._text),i=e.width,n=1.3*this._fontSize;if(-1==t.Utils.Common.base2Sizes.indexOf(i)){for(var o=0;i>t.Utils.Common.base2Sizes[o];)o++;i=t.Utils.Common.base2Sizes[o]}if(-1==t.Utils.Common.base2Sizes.indexOf(n)){for(var o=0;n>t.Utils.Common.base2Sizes[o];)o++;n=t.Utils.Common.base2Sizes[o]}this._canvas.width=i,this._canvas.height=n,this._ctx.font=this._fontWeight+" "+this._fontSize+"px "+this._fontFamily,this._ctx.fillStyle=this._fontColor,this._ctx.textBaseline=this._baseline,this._ctx.fillText(this._text,0,0),this.atlas.cells[0]={x:0,y:0,w:this._canvas.width,h:this._canvas.height},this._tempDirty=!1,this.atlas.dirty=!0},i.prototype.render=function(){if(this.alpha>0&&this.visible){var e=this.game.stage.ctx;e.save();var i=this.transform;this.alpha>0&&this.alpha<=1&&(e.globalAlpha=this.alpha),this._tempDirty&&this._renderText();var n=0;switch(this._textAlign){case t.GameObjects.Textfield.TEXT_ALIGN_LEFT:n=0;break;case t.GameObjects.Textfield.TEXT_ALIGN_CENTER:n=.5*this._canvas.width;break;case t.GameObjects.Textfield.TEXT_ALIGN_RIGHT:n=this._canvas.width}var o=i.getConcatenatedMatrix();e.transform(o.a,o.b,o.c,o.d,o.tx-n,o.ty),e.drawImage(this._canvas,0,0,this._canvas.width,this._canvas.height,-i.rotPointX,-i.rotPointY,this._canvas.width,this._canvas.height),e.restore()}},i.prototype.renderGL=function(e,i,n){"undefined"==typeof n&&(n=null),this._tempDirty&&this._renderText();var o=[],r=this.transform,s=r.getConcatenatedMatrix(),a=0;switch(this._textAlign){case t.GameObjects.Textfield.TEXT_ALIGN_LEFT:a=0;break;case t.GameObjects.Textfield.TEXT_ALIGN_CENTER:a=-(.5*this._canvas.width);break;case t.GameObjects.Textfield.TEXT_ALIGN_RIGHT:a=-this._canvas.width}var h=new t.Geom.Point(a-r.rotPointX,0-r.rotPointY),u=new t.Geom.Point(this._canvas.width+a-r.rotPointX,0-r.rotPointY),c=new t.Geom.Point(this._canvas.width+a-r.rotPointX,this._canvas.height-r.rotPointY),l=new t.Geom.Point(a-r.rotPointX,this._canvas.height-r.rotPointY);h=s.transformPoint(h),u=s.transformPoint(u),c=s.transformPoint(c),l=s.transformPoint(l),o.push(h.x,h.y,0,0,this.alpha,u.x,u.y,this._canvas.width,0,this.alpha,c.x,c.y,this._canvas.width,this._canvas.height,this.alpha,l.x,l.y,0,this._canvas.height,this.alpha),this.glRenderer.concatBatch(o)},i.TEXT_ALIGN_CENTER="center",i.TEXT_ALIGN_RIGHT="right",i.TEXT_ALIGN_LEFT="left",i}(t.Entity);e.Textfield=i}(t.GameObjects||(t.GameObjects={})),t.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(){function e(e,i,n){"undefined"==typeof n&&(n=-1),this.allowCollisions=t.Components.ArcadePhysics.NONE,this.properties={},this.tilemap=e,this.index=i,this.cellIndex=n,this.offset=new t.Geom.Point(0,0)}return e.prototype.objType=function(){return"TileType"},e}();e.TileType=i}(e.Tilemap||(e.Tilemap={})),e.Tilemap}(t.GameObjects||(t.GameObjects={})),t.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(){function i(t,e,i,n){"undefined"==typeof n&&(n=0),this.tileWidth=0,this.tileHeight=0,this.width=0,this.height=0,this.properties={},this.tileTypes=[],this.createTileType(-1),this.layers=[],this.state=t,this.game=t.game,void 0!==e&&void 0!==i?this.createFromFileStore(e,i,n):(void 0!==e||void 0!==i)&&console.log("You must pass BOTH the TileMapDataKey and TextureAtlas inorder to create a TileMap from the File Store.")}return Object.defineProperty(i.prototype,"widthInPixels",{get:function(){return this.width*this.tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"heightInPixels",{get:function(){return this.height*this.tileHeight},enumerable:!0,configurable:!0}),i.prototype.createFromFileStore=function(t,i,n){"undefined"==typeof n&&(n=0);var o=null;switch(typeof t){case"string":if(0==this.game.fileStore.exists(t))return console.error("The JSON file you have told to use for a TileMap does not exist."),!1;o=JSON.parse(this.game.fileStore.getFile(t).data);break;case"object":o=t;break;default:console.error("The type of TileMapData passed could not be idenified. Please either pass a name of JSON file to use OR an object to be used.")}this.orientation=void 0==o.orientation?e.ORTHOGONAL:o.orientation,this.tileWidth=void 0==o.tilewidth?32:o.tilewidth,this.tileHeight=void 0==o.tileheight?32:o.tileheight,this.width=o.width,this.height=o.height;for(var r in o.properties)this.properties[r]=o.properties[r];"undefined"!==o.tilesets&&-1!==n&&this._generateTypesFromTileset(o.tilesets,i,n);for(var s=0;s<o.layers.length;s++){var a=o.layers[s];switch(o.layers[s].type){case"tilelayer":var h=void 0!==a.width?a.width:this.width,u=void 0!==a.height?a.height:this.height,c=this.createNewLayer(a.name,i,a.data,h,u,a.x*this.tileWidth,a.y*this.tileHeight);c.orientation=this.orientation,c.visible=void 0==a.visible?!0:a.visible,c.alpha=void 0==a.opacity?1:a.opacity,void 0!==a.properties&&(c.properties=a.properties);break;case"objectgroup":this.createNewObjectLayer();break;case"imagelayer":this.createNewImageLayer()}}},i.prototype._generateTypesFromTileset=function(t,e,i){for(var n=0;n<t.length;n++){for(var o=t[n],r=o.margin,s=(o.spacing,o.tilewidth),a=o.tileheight,h=o.imagewidth-r,u=o.imageheight-r,c=void 0==o.tileoffset?{x:0,y:0}:o.tileoffset,l=r;u>l;l+=a)for(var p=r;h>p;p+=s){var d=void 0==e.cells[i]?-1:i,f=this.createTileType(d);f.offset.x=c.x,f.offset.y=c.y,i++}for(var m in o.tileproperties){var f=this.tileTypes[parseInt(o.firstgid)+parseInt(m)];f.properties=o.tileproperties[m]}}},i.prototype.setTo=function(t,e,i,n){this.tileWidth=t,this.tileHeight=e,this.width=i,this.height=n},i.prototype.createTileType=function(t){"undefined"==typeof t&&(t=-1);var i=new e.TileType(this,this.tileTypes.length,t);return this.tileTypes.push(i),i},i.prototype.createTileTypes=function(t){for(var e=[],i=0;i<t.length;i++)e.push(this.createTileType(t[i]));return e},i.prototype.createTileTypesByRange=function(t,e){for(var i=[],n=t;t+e>=n;n++)i.push(this.createTileType(n));return i},i.prototype.setCell=function(t,e){this.tileTypes[t].cellIndex=e},i.prototype.setCellsByRange=function(t,e,i){for(var n=t;t+i>n;n++)this.tileTypes[n].cellIndex=e,e++},i.prototype.createNewLayer=function(e,i,n,o,r,s,a,h,u){if("undefined"==typeof n&&(n=[]),"undefined"==typeof o&&(o=this.width),"undefined"==typeof r&&(r=this.height),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=0),"undefined"==typeof h&&(h=this.tileWidth),"undefined"==typeof u&&(u=this.tileHeight),n.length<o*r)for(var c=n.length-1;++c<o*r;)n.push(0);var l=new t.GameObjects.Tilemap.TileMapLayer(this,e,i,n,h,u,s,a,o,r);return this.layers.push(l),l},i.prototype.createNewObjectLayer=function(){console.log("OBJECT GROUP layers are currently not supported.")},i.prototype.createNewImageLayer=function(){console.log("IMAGE layers are currently not supported.")},i.prototype.getLayerByName=function(t){for(var e=0;e<this.layers.length;e++)if(this.layers[e].name==t)return this.layers[e];return null},i.prototype.getLayer=function(t){return void 0!==this.layers[t]?this.layers[t]:null},i.prototype.objType=function(){return"TileMap"},i}();e.TileMap=i,e.ISOMETRIC="isometric",e.ORTHOGONAL="orthogonal"}(e.Tilemap||(e.Tilemap={})),e.Tilemap}(t.GameObjects||(t.GameObjects={})),t.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(i){function n(n,o,r,s,a,h,u,c,l,p){"undefined"==typeof u&&(u=0),"undefined"==typeof c&&(c=0),"undefined"==typeof l&&(l=0),"undefined"==typeof p&&(p=0),i.call(this,n.state,u,c),this.properties={},this.orientation=e.ORTHOGONAL,this.game.renderOption===t.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")),this.name=o,this.atlas=r,this.tilemap=n,this._data=s,this.tileWidth=a,this.tileHeight=h,this.width=l,this.height=p,this.physics=this.components.add(new t.Components.ArcadePhysics(this,null)),this.physics.immovable=!0}return __extends(n,i),n.prototype.childType=function(){return t.TILE_LAYER},n.prototype.objType=function(){return"TileMapLayer"},Object.defineProperty(n.prototype,"widthInPixels",{get:function(){return this.width*this.tilemap.tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"heightInPixels",{get:function(){return this.height*this.tilemap.tileHeight},enumerable:!0,configurable:!0}),n.prototype.countTiles=function(t){for(var e=0,i=0;i<this._data.length;i++)void 0==t&&0!==this._data[i]?e++:t===this._data[i]&&e++;return e},Object.defineProperty(n.prototype,"tileData",{get:function(){return this._data},enumerable:!0,configurable:!0}),n.prototype.getIndexFromXY=function(t,e){var i=t+e*this.width;return 0>i||i>=this._data.length?-1:i},n.prototype.getTileFromXY=function(t,e){var i=this.getIndexFromXY(t,e);return-1!==i?this.tilemap.tileTypes[this._data[i]]:null},n.prototype.getIndexFromCoords=function(e,i){if(e>this.transform.worldX+this.widthInPixels||i>this.transform.worldY+this.heightInPixels||e<this.transform.worldX||i<this.transform.worldY)return-1;var n=t.Utils.GameMath.snapToFloor(e-this.transform.worldX,this.tileWidth)/this.tileWidth,o=t.Utils.GameMath.snapToFloor(i-this.transform.worldY,this.tileHeight)/this.tileHeight;return this.getIndexFromXY(n,o)},n.prototype.getTileFromCoords=function(t,e){var i=this.getIndexFromCoords(t,e);return-1!==i?this.tilemap.tileTypes[this._data[i]]:null},n.prototype.getIndexesByType=function(t){for(var e=[],i=0;i<this._data.length;i++)this._data[i]==t&&e.push(i);return e},n.prototype.setTile=function(t,e,i){var t=this.getIndexFromXY(t,e);return-1!==t?(this._data[t]=i,!0):!1},n.prototype.setTileByIndex=function(t,e){this._data[t]=e},n.prototype.randomizeTiles=function(t,e,i,n,o){if("undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=this.width),"undefined"==typeof o&&(o=this.height),void 0==t){t=[];for(var r=0;r++<this.tilemap.tileTypes.length;)t.push(r)}for(var s=i;i+o>s;s++)for(var r=e;e+n>r;r++){var a=this.getIndexFromXY(r,s);-1!==a&&(this._data[a]=this.game.rnd.pick(t))}},n.prototype.fill=function(t,e,i,n,o){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=this.width),"undefined"==typeof o&&(o=this.height);for(var r=i;i+o>r;r++)for(var s=e;e+n>s;s++){var a=this.getIndexFromXY(s,r);-1!==a&&(this._data[a]=t)}},n.prototype.replaceTiles=function(t,e,i,n,o,r){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=this.width),"undefined"==typeof r&&(r=this.height);for(var s=n;n+r>s;s++)for(var a=i;i+o>a;a++){var h=this.getIndexFromXY(a,s);-1!==h&&this._data[h]==t&&(this._data[h]=e)}},n.prototype.swapTiles=function(t,e,i,n,o,r){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=this.width),"undefined"==typeof r&&(r=this.height);for(var s=n;n+r>s;s++)for(var a=i;i+o>a;a++){var h=this.getIndexFromXY(a,s);-1!==h&&(this._data[h]==t?this._data[h]=e:this._data[h]==e&&(this._data[h]=t))}},n.prototype.getOverlappingTiles=function(e,i){if("undefined"==typeof i&&(i=t.Components.ArcadePhysics.ANY),0==e.components.hasComponent("Box"))return[];var n=e.components.getComponent("Box").worldHitbox;if(n.left>this.transform.worldX+this.widthInPixels||n.right<this.transform.worldX||n.bottom<this.transform.worldY||n.top>this.transform.worldY+this.heightInPixels)return[];for(var o=n.x-this.transform.worldX,r=n.y-this.transform.worldY,s=t.Utils.GameMath.snapToFloor(o,this.tileWidth)/this.tileWidth,a=t.Utils.GameMath.snapToFloor(r,this.tileHeight)/this.tileHeight,h=t.Utils.GameMath.snapToCeil(n.width,this.tileWidth)/this.tileWidth,u=t.Utils.GameMath.snapToCeil(n.height,this.tileHeight)/this.tileHeight,c=this.getCollidableTiles(s,a,h+1,u+1,i),l=0;l<c.length;l++){var p=c[l];(p.x>n.right||p.x+this.tileWidth<n.left||p.y>n.bottom||p.y+this.tileHeight<p.top)&&(c.splice(l,1),l--)}return c},n.prototype.getCollidableTiles=function(e,i,n,o,r){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=this.width),"undefined"==typeof o&&(o=this.height),"undefined"==typeof r&&(r=t.Components.ArcadePhysics.ANY);
var s=[];if(!(e>this.width||i>this.height)){0>e&&(e=0),0>i&&(i=0),e+n>this.width&&(n=this.width-e),i+o>this.height&&(o=this.height-i);for(var a=i;i+o>a;a++)for(var h=e;e+n>h;h++){var u=this.getIndexFromXY(h,a);if(-1!==u){var c=this.tileData[u];(this.tilemap.tileTypes[c].allowCollisions&r)!==t.Components.ArcadePhysics.NONE&&s.push({index:u,type:c,x:h*this.tileWidth,y:a*this.tileHeight})}}return s}},n.prototype.update=function(){i.prototype.update.call(this),this.physics.update()},n.prototype._calculateBoundaries=function(t){if(this.orientation==e.ORTHOGONAL){var i=1/this.scaleX,n=1/this.scaleY;return this._maxX=Math.min(Math.ceil(t.width/this.tileWidth)+1,this.width)*i,this._maxY=Math.min(Math.ceil(t.height/this.tileHeight)+1,this.height)*n,this._startX=Math.floor((-t.transform.x-this.transform.worldX)/this.tileWidth*i),this._startY=Math.floor((-t.transform.y-this.transform.worldY)/this.tileHeight*n),this._startX<0&&(this._startX=0),this._startY<0&&(this._startY=0),this._maxX>this.width&&(this._maxX=this.width),this._maxY>this.height&&(this._maxY=this.height),this._startX+this._maxX>this.width&&(this._maxX=this.width-this._startX),void(this._startY+this._maxY>this.height&&(this._maxY=this.height-this._startY))}this.orientation==e.ISOMETRIC&&(this._startX=0,this._startY=0,this._maxX=this.width,this._maxY=this.height)},n.prototype.chartToScreen=function(t,e,i){return{x:t.x*e-t.y*e,y:t.x*i/2+t.y*i/2}},n.prototype.screenToChart=function(t,e,i){var n=Math.floor(t.x/e),o=Math.floor((t.y-n*(i/2))/i);return{x:n+o,y:o}},n.prototype.render=function(t){if(!(this.visible===!1||this.alpha<.1||this.exists===!1)){var i=this.game.stage.ctx;i.save(),this.alpha>0&&this.alpha<=1&&(i.globalAlpha=this.alpha);var n=this.transform,o=n.getConcatenatedMatrix();i.transform(o.a,o.b,o.c,o.d,o.tx,o.ty),this._calculateBoundaries(t,o);for(var r=this._startY;r<this._startY+this._maxY;r++)for(var s=this._startX;s<this._startX+this._maxX;s++)if((this._temptype=this.getTileFromXY(s,r))&&-1!==this._temptype.cellIndex){var a,h,u=this.atlas.cells[this._temptype.cellIndex];if(this.orientation==e.ISOMETRIC){var c=(this._temptype.offset.x,this._temptype.offset.y,this.tileWidth*(2*this.width-1),this.tileHeight*this.height,this.tileWidth/2),l=this.chartToScreen({x:s,y:r},this.tileWidth/2,this.tileHeight);a=l.x+this._temptype.offset.x-c,h=l.y-(u.h-this.tileHeight)+this._temptype.offset.y}else a=s*this.tileWidth+this._temptype.offset.x,h=r*this.tileHeight-(u.h-this.tileHeight)+this._temptype.offset.y;i.drawImage(this.atlas.image,u.x,u.y,u.w,u.h,a,h,u.w,u.h)}return i.restore(),!0}},n.prototype.renderGL=function(i,n,o){"undefined"==typeof o&&(o=null);var r=[],s=new t.Geom.Point,a=new t.Geom.Point,h=new t.Geom.Point,u=new t.Geom.Point,c=this.transform,l=c.getConcatenatedMatrix();this._calculateBoundaries(n,l);for(var p=this._startY;p<this._startY+this._maxY;p++)for(var d=this._startX;d<this._startX+this._maxX;d++)if(this._temptype=this.getTileFromXY(d,p),-1!=this._temptype.cellIndex){var f,m,y=this.atlas.cells[this._temptype.cellIndex];if(this.orientation==e.ISOMETRIC){var g=(this._temptype.offset.x,this._temptype.offset.y,this.tileWidth*(2*this.width-1),this.tileHeight*this.height,this.tileWidth/2),_=this.chartToScreen({x:d,y:p},this.tileWidth/2,this.tileHeight);f=_.x+this._temptype.offset.x-g,m=_.y+this._temptype.offset.y}else f=d*this.tileWidth+this._temptype.offset.x,m=p*this.tileHeight+this._temptype.offset.y;s.setTo(f-c.rotPointX,m-c.rotPointY-(y.h-this.tileHeight)),a.setTo(f+y.w-c.rotPointX,m-c.rotPointY-(y.h-this.tileHeight)),h.setTo(f+y.w-c.rotPointX,m+y.h-c.rotPointY-(y.h-this.tileHeight)),u.setTo(f-c.rotPointX,m+y.h-c.rotPointY-(y.h-this.tileHeight)),s=l.transformPoint(s),a=l.transformPoint(a),h=l.transformPoint(h),u=l.transformPoint(u),r.push(s.x+c.rotPointX,s.y+c.rotPointY,y.x,y.y,this.alpha,a.x+c.rotPointX,a.y+c.rotPointY,y.x+y.w,y.y,this.alpha,h.x+c.rotPointX,h.y+c.rotPointY,y.x+y.w,y.y+y.h,this.alpha,u.x+c.rotPointX,u.y+c.rotPointY,y.x,y.y+y.h,this.alpha)}this.glRenderer.concatBatch(r)},n}(t.Entity);e.TileMapLayer=i}(e.Tilemap||(e.Tilemap={})),e.Tilemap}(t.GameObjects||(t.GameObjects={})),t.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(e){function i(i,n){if("undefined"==typeof n&&(n=!0),e.call(this,i,"Animation"),this.currentAnimation=null,this.entity=i,this._atlas=this.entity.atlas,this._animations={},1==n)for(var o=0;o<this._atlas.sequences.length;o++)this.createFromSequence(this._atlas.sequences[o],!1);if(this._animations["default"])this.currentAnimation=this._animations["default"];else{for(var r=[],o=0;o<this._atlas.cells.length;o++)r.push(o);this.currentAnimation=this.add("default",r,.1,!0,!1)}this.onChange=new t.Signal,this.onPlay=new t.Signal,this.onStop=new t.Signal,this.onUpdate=new t.Signal}return __extends(i,e),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this.currentAnimation.isPlaying},enumerable:!0,configurable:!0}),i.prototype.objType=function(){return"AnimationManager"},i.prototype.add=function(e,i,n,o,r,s){"undefined"==typeof o&&(o=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof s&&(s=!0);var a=new t.Animations.Sequence(e,i,n,o);return 1==s&&this._atlas.sequences.push(a),this.createFromSequence(a,r)},i.prototype.createFromSequence=function(e,i){return"undefined"==typeof i&&(i=!1),this._animations[e.name]=new t.Animations.Animation(e.name,e,this.entity.clock,this),i&&this.play(e.name),this._animations[e.name]},i.prototype.play=function(t,e){return"undefined"==typeof t&&(t=this.currentAnimation.name),"undefined"==typeof e&&(e=!0),0==e&&this.currentAnimation.name===t&&1==this.currentAnimation.isPlaying?this.currentAnimation:this._play(t)},i.prototype.playAt=function(t,e){return"undefined"==typeof e&&(e=this.currentAnimation.name),this._play(e,t)},i.prototype._play=function(t,e){return"undefined"==typeof e&&(e=null),this._setCurrentAnimation(t),null!==e?this.currentAnimation.playAt(e):this.currentAnimation.play(),this.onPlay.dispatch(this.currentAnimation),this.updateCellIndex(),this.currentAnimation},i.prototype.stop=function(){this.isPlaying===!0&&(this.currentAnimation.stop(),this.onStop.dispatch(this.currentAnimation))},i.prototype.pause=function(){this.currentAnimation.pause()},i.prototype.resume=function(){this.currentAnimation.resume()},i.prototype.switchTo=function(t,e){"undefined"==typeof e&&(e=null);var i=!1;switch(typeof t){case"string":this.currentAnimation.name!==t&&(this._setCurrentAnimation(t),i=!0);break;case"number":this.currentAnimation.frameIndex=t,i=!0}(e||null===e&&this.isPlaying&&i)&&this.play(),0==e&&this.isPlaying&&this.stop(),this.updateCellIndex()},i.prototype.nextFrame=function(){this.currentAnimation.nextFrame(),this.updateCellIndex()},i.prototype.prevFrame=function(){this.currentAnimation.prevFrame(),this.updateCellIndex()},i.prototype._setCurrentAnimation=function(t){this.currentAnimation.name!==t&&(null!==this.currentAnimation&&this.currentAnimation.stop(),this._animations[t]&&(this.currentAnimation=this._animations[t],this.onChange.dispatch(t,this.currentAnimation)))},i.prototype.update=function(){this.currentAnimation&&this.currentAnimation.update()},Object.defineProperty(i.prototype,"currentCell",{get:function(){return this.currentAnimation.currentCell},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameIndex",{get:function(){return this.currentAnimation.frameIndex},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){return this.currentAnimation.length},enumerable:!0,configurable:!0}),i.prototype.getAnimation=function(t){return this._animations[t]},i.prototype.updateCellIndex=function(){"undefined"!=typeof this.currentAnimation&&(this.onUpdate.dispatch(this.currentAnimation),this.entity.cellIndex=this.currentAnimation.currentCell)},i.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t in this._animations)this._animations[t].destroy(),delete this._animations[t];delete this._animations,delete this.currentAnimation,delete this._atlas},i}(t.Component);e.AnimationManager=i}(t.Components||(t.Components={})),t.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(e){function i(i,n,o,r,s){"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),e.call(this,i,"Box"),this.autoUpdate=!0,this.entity=i,this.dirty=!0,this._rawBounds=new t.Geom.Rectangle(n,o,r,s),this._rawCenter=new t.Geom.Point(n+r/2,o+s/2),this._rawHitbox=new t.Geom.Rectangle,this._hitboxOffset=new t.Geom.Point,this.hitbox=new t.Geom.Rectangle(0,0,r,s),this.autoUpdate=!0}return __extends(i,e),i.prototype.objType=function(){return"Box"},Object.defineProperty(i.prototype,"hitboxOffset",{get:function(){return this.dirty&&1==this.autoUpdate&&null!==this.entity.atlas&&(this._hitboxOffset.x=this.entity.atlas.cells[this.entity.cellIndex].hitboxes[0].x,this._hitboxOffset.y=this.entity.atlas.cells[this.entity.cellIndex].hitboxes[0].y),this._hitboxOffset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawHitbox",{get:function(){if(this.dirty&&(this._rawHitbox.x=this.rawBounds.x+this.hitboxOffset.x,this._rawHitbox.y=this.rawBounds.y+this.hitboxOffset.y,1==this.autoUpdate)){var t=this.entity.atlas;null!==t&&(this._rawHitbox.width=t.cells[this.entity.cellIndex].hitboxes[0].w,this._rawHitbox.height=t.cells[this.entity.cellIndex].hitboxes[0].h)}return this._rawHitbox},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hitbox",{get:function(){return this.dirty&&(this._transformedHitbox=this._rotateHitbox(this.rawHitbox.clone())),this._transformedHitbox},set:function(t){this._hitboxOffset.x=t.x,this._hitboxOffset.y=t.y,this._rawHitbox=t,this._rawHitbox.x+=this._rawBounds.x,this._rawHitbox.y+=this._rawBounds.y,this.autoUpdate=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"worldHitbox",{get:function(){return this.dirty&&(this._worldHitbox=this._rotateHitbox(this.rawHitbox.clone(),!0)),this._worldHitbox},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawBounds",{get:function(){return this.dirty&&(this._rawBounds.x=this.entity.x,this._rawBounds.y=this.entity.y,this._rawBounds.width=this.entity.width,this._rawBounds.height=this.entity.height),this._rawBounds},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawCenter",{get:function(){return this.dirty&&(this._rawCenter.x=this.rawBounds.x+this.rawBounds.width/2,this._rawCenter.y=this.rawBounds.y+this.rawBounds.height/2),this._rawCenter},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){if(this.dirty){var e=this.entity.transform,i=e.getConcatenatedMatrix();i.setTo(i.a,i.b,i.c,i.d,e.x+e.rotPointX,e.y+e.rotPointY),this._transformedCenter=i.transformPoint(new t.Geom.Point(this.entity.width/2-e.rotPointX,this.entity.height/2-e.rotPointY))}return this._transformedCenter},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bounds",{get:function(){return this.dirty&&(this._transformedBounds=this._rotateRect(this.rawBounds.clone())),this._transformedBounds},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"worldBounds",{get:function(){return this.dirty&&(this._worldBounds=this._rotateRect(this.rawBounds.clone(),!0)),this._worldBounds},enumerable:!0,configurable:!0}),i.prototype._rotateRect=function(e,i){"undefined"==typeof i&&(i=!1);var n=new t.Geom.Rectangle,o=this.entity.transform,r=o.getConcatenatedMatrix();return i||r.setTo(r.a,r.b,r.c,r.d,o.x+o.rotPointX,o.y+o.rotPointY),n=this.extents(r.transformPoint({x:-o.rotPointX,y:-o.rotPointY}),r.transformPoint({x:-o.rotPointX+e.width,y:-o.rotPointY}),r.transformPoint({x:-o.rotPointX+e.width,y:-o.rotPointY+e.height}),r.transformPoint({x:-o.rotPointX,y:-o.rotPointY+e.height}))},i.prototype._rotateHitbox=function(e,i){"undefined"==typeof i&&(i=!1);var n=new t.Geom.Rectangle,o=this.entity.transform,r=o.getConcatenatedMatrix();return i||r.setTo(r.a,r.b,r.c,r.d,o.x+o.rotPointX,o.y+o.rotPointY),n=this.extents(r.transformPoint({x:-o.rotPointX+this._hitboxOffset.x,y:-o.rotPointY+this._hitboxOffset.y}),r.transformPoint({x:-o.rotPointX+e.width+this._hitboxOffset.x,y:-o.rotPointY+this._hitboxOffset.y}),r.transformPoint({x:-o.rotPointX+e.width+this._hitboxOffset.x,y:-o.rotPointY+e.height+this._hitboxOffset.y}),r.transformPoint({x:-o.rotPointX+this._hitboxOffset.x,y:-o.rotPointY+e.height+this._hitboxOffset.y}))},i.prototype.draw=function(t){var e=this.entity.transform;t.strokeStyle="red",t.strokeRect(this.rawBounds.x,this.rawBounds.y,this.rawBounds.width,this.rawBounds.height),t.fillRect(this.rawCenter.x-1,this.rawCenter.y-1,3,3),t.strokeRect(e.x+e.rotPointX-3,e.y+e.rotPointY-3,7,7),t.strokeStyle="blue",t.strokeRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height),t.strokeStyle="green",t.strokeRect(this.hitbox.x,this.hitbox.y,this.hitbox.width,this.hitbox.height),t.strokeStyle="white",t.strokeRect(this.rawHitbox.x,this.rawHitbox.y,this.rawHitbox.width,this.rawHitbox.height),t.strokeStyle="purple",t.strokeRect(this.worldBounds.x,this.worldBounds.y,this.worldBounds.width,this.worldBounds.height),t.strokeStyle="cyan",t.strokeRect(this.worldHitbox.x,this.worldHitbox.y,this.worldHitbox.width,this.worldHitbox.height)},i.prototype.extents=function(e,i,n,o){var r=Math.min(e.x,i.x,n.x,o.x),s=Math.max(e.x,i.x,n.x,o.x),a=Math.min(e.y,i.y,n.y,o.y),h=Math.max(e.y,i.y,n.y,o.y);return new t.Geom.Rectangle(r,a,s-r,h-a)},i.prototype.destroy=function(){e.prototype.destroy.call(this),delete this.entity},i}(t.Component);e.Box=i}(t.Components||(t.Components={})),t.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(e){function i(i,n,o){"undefined"==typeof o&&(o=!1),e.call(this,i,"Input"),this._isDragging=null,this._dragEnabled=!1,this._dragSnapToCenter=!1,this._nowDown=null,this._nowUp=null,this._nowEntered=null,this._nowLeft=null,this._nowDragging=null,this._onEntered=new t.Signal,this._onLeft=new t.Signal,this._onDown=new t.Signal,this._onUp=new t.Signal,this._onDragStarted=new t.Signal,this._onDragStopped=new t.Signal,this._box=n,this._distance=new t.Geom.Point,this._withinBounds=null,this._outsideBounds=!0,this._isUp=!0,this._isDown=null,this._isDragging=null,this._justEntered=!1,this._tempDragDisabled=!1,this._tempPoint=new t.Geom.Point,this._tempCircle=new t.Geom.Circle(0,0,0),this.enabled=o}return __extends(i,e),i.prototype.objType=function(){return"Input"},Object.defineProperty(i.prototype,"onEntered",{get:function(){return 0==this.enabled&&(this.enabled=!0),this._onEntered},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onLeft",{get:function(){return 0==this.enabled&&(this.enabled=!0),this._onLeft},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onDown",{get:function(){return 0==this.enabled&&(this.enabled=!0),this._onDown},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onUp",{get:function(){return 0==this.enabled&&(this.enabled=!0),this._onUp},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onDragStarted",{get:function(){return this._onDragStarted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onDragStopped",{get:function(){return this._onDragStopped},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onRelease",{get:function(){return this.onUp},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onPress",{get:function(){return this.onDown},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDown",{get:function(){return null!==this._isDown},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isUp",{get:function(){return this._isUp},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"withinBounds",{get:function(){return null!==this._withinBounds},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"outsideBounds",{get:function(){return this._outsideBounds},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDragging",{get:function(){return null!==this._isDragging},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dragDistance",{get:function(){return this._dragDistance},set:function(t){this._dragDistance=t},enumerable:!0,configurable:!0}),i.prototype.enableDrag=function(t,e){"undefined"==typeof t&&(t=!1),"undefined"==typeof e&&(e=1),0==this.enabled&&(this.enabled=!0),this._dragEnabled=!0,this._dragSnapToCenter=t,this._dragDistance=e,this._isDragging=null},i.prototype.disableDrag=function(){this._dragEnabled=!1,this._isDragging=null},i.prototype.update=function(){this.enabled!==!1&&this.game&&this.owner.active!==!1&&(this._nowDown=null,this._nowUp=null,this._nowEntered=null,this._nowLeft=null,this._nowDragging=null,t.DEVICE.touch?this._updateTouch():this._updateMouse(),this.isDragging&&(this._tempPoint=this.game.cameras.defaultCamera.transformPoint(this._isDragging.point),this._dragSnapToCenter===!1?(this.owner.transform.x=t.Utils.GameMath.snapTo(this._tempPoint.x-this._box.hitboxOffset.x-this._distance.x,this._dragDistance),this.owner.transform.y=t.Utils.GameMath.snapTo(this._tempPoint.y-this._box.hitboxOffset.y-this._distance.y,this._dragDistance)):(this.owner.transform.x=t.Utils.GameMath.snapTo(this._tempPoint.x-this._box.hitboxOffset.x-this._box.worldHitbox.width/2,this._dragDistance),this.owner.transform.y=t.Utils.GameMath.snapTo(this._tempPoint.y-this._box.hitboxOffset.y-this._box.worldHitbox.height/2,this._dragDistance))))},i.prototype._updateTouch=function(){for(var t=0;t<this.game.input.touch.maximumPointers;t++)this.game.input.touch.fingers[t].active===!0?this._evaluateTouchPointer(this.game.input.touch.fingers[t]):this.isDown===!0&&this._isDown.id===this.game.input.touch.fingers[t].id?this._nowUp=this.game.input.touch.fingers[t]:this.isDown===!1&&null===this._nowUp&&this.withinBounds===!0&&this._withinBounds.id===this.game.input.touch.fingers[t].id&&(this._nowUp=this.game.input.touch.fingers[t]);null!==this._nowEntered&&this.withinBounds===!1&&(this._withinBounds=this._nowEntered,this._outsideBounds=!1,this._onEntered.dispatch(this.owner,this._nowEntered)),null!==this._nowLeft&&this.withinBounds===!0&&(this._withinBounds=null,this._outsideBounds=!0,this._onLeft.dispatch(this.owner,this._nowLeft)),null!==this._nowDown&&this.isDown===!1&&(this._onDown.dispatch(this.owner,this._nowDown),this._isDown=this._nowDown,this._isUp=!1,this._withinBounds=this._nowDown,this._outsideBounds=!1),1==this._dragEnabled&&this.isDragging===!1&&null!==this._nowDragging&&(this._onDragStarted.dispatch(this.owner,this._nowDragging),this._isDragging=this._nowDragging),null!==this._nowUp&&(this._onUp.dispatch(this.owner,this._nowUp),this._isDown=null,this._isUp=!0,this._withinBounds=null,this._outsideBounds=!0,this.isDragging===!0&&this._isDragging.id==this._nowUp.id&&(this._isDragging=null,this._onDragStopped.dispatch(this.owner,this._nowUp)))},i.prototype._evaluateTouchPointer=function(e){(this.isDown===!1||this._isDown.id===e.id)&&(this._tempPoint=this.game.cameras.defaultCamera.transformPoint(e.point),this._tempCircle.setTo(this._tempPoint.x,this._tempPoint.y,e.circle.diameter),t.Geom.Intersect.circleToRectangle(this._tempCircle,this._box.worldHitbox).result?((this.isDown===!0&&this._isDown.id===e.id||this.isDown===!1&&e.duration>1)&&(this._nowEntered=e),this.isDown===!1&&e.frameDuration<2&&(this._nowDown=e),this._dragEnabled&&0==this.isDragging&&1==this.isDown&&(this._distance.x=this._tempPoint.x-this._box.worldHitbox.left,this._distance.y=this._tempPoint.y-this._box.worldHitbox.top,this._nowDragging=e)):this.isDown===!0?this._nowLeft=e:this.withinBounds===!0&&this._withinBounds.id==e.id&&(this._nowLeft=e))},i.prototype._updateMouse=function(){this._evaluateMousePointer(this.game.input.mouse.cursor),null!==this._nowLeft&&this._onLeft.dispatch(this.owner,this._nowLeft),null!==this._nowEntered&&this._onEntered.dispatch(this.owner,this._nowEntered),null!==this._nowDown&&this.isDown===!1&&(this._onDown.dispatch(this.owner,this._nowDown),this._isDown=this._nowDown,this._isUp=!1),1==this._dragEnabled&&this.isDragging===!1&&null!==this._nowDragging&&(this._onDragStarted.dispatch(this.owner,this._nowDragging),this._isDragging=this._nowDragging),this.isDown===!0&&null!==this._nowUp&&this._isDown.id===this._nowUp.id&&(this._onUp.dispatch(this.owner,this._nowUp),this.isDragging===!0&&this._isDragging.id==this._nowUp.id&&(this._isDragging=null,this._onDragStopped.dispatch(this.owner,this._nowUp)),this._isDown=null,this._isUp=!0)},i.prototype._evaluateMousePointer=function(e){this._tempPoint=this.game.cameras.defaultCamera.transformPoint(e.point),t.Geom.Intersect.pointToRectangle(this._tempPoint,this._box.worldHitbox).result?(this._dragEnabled&&this.isDragging===!1&&(this._distance.x=this._tempPoint.x-this._box.worldHitbox.left,this._distance.y=this._tempPoint.y-this._box.worldHitbox.top),this.withinBounds===!1&&(this._nowEntered=e,this._withinBounds=e,this._outsideBounds=!1,this._justEntered=!0)):this.withinBounds===!0&&this.isDragging===!1&&(this._nowLeft=e,this._withinBounds=null,this._outsideBounds=!0),e.isDown===!0?(this._justEntered&&(this._isDown=e,this._isUp=!1,this._tempDragDisabled=!0),this.withinBounds===!0&&this.isDown===!1&&null===this._nowDown&&(this._nowDown=e),this._dragEnabled===!0&&0==this.isDragging&&this._tempDragDisabled===!1&&1==this.isDown&&(this._nowDragging=e)):(this._tempDragDisabled===!0&&(this._tempDragDisabled=!1),this.isDown===!0&&(this._nowUp=e)),this._justEntered&&(this._justEntered=!1)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.enabled=!1,delete this._box,delete this._isDown,delete this._isUp,delete this._isDragging,delete this._dragEnabled,this._onDown&&this._onDown.dispose(),delete this._onDown,this._onDragStarted&&this._onDragStarted.dispose(),delete this._onDragStarted,this._onUp&&this._onUp.dispose(),delete this._onUp,this._onLeft&&this._onLeft.dispose(),delete this._onLeft,this._onEntered&&this._onEntered.dispose(),delete this._onEntered,this._onDragStopped&&this._onDragStopped.dispose(),delete this._onDragStopped,delete this._dragDistance},i}(t.Component);e.Input=i}(t.Components||(t.Components={})),t.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(t){function e(e){t.call(this,e,"Sound"),this._audio=[]}return __extends(e,t),e.prototype.objType=function(){return"Sound"},e.prototype.addSound=function(t,e,i,n){if("undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=!1),1!=this._validate(t)){var o=this.game.audio.add(e,i,n);return this._audio[t]=o,o}},e.prototype.removeSound=function(t){0!=this._validate(t)&&(this._audio[t].stop(),this._audio[t].destroy(),delete this._audio[t])},e.prototype.getSound=function(t){return 0!=this._validate(t)?this._audio[t]:void 0},e.prototype._validate=function(t){return void 0===this._audio[t]?!1:!0},e.prototype.play=function(t){0!=this._validate(t)&&this._audio[t].play()},e.prototype.stop=function(t){0!=this._validate(t)&&this._audio[t].stop()},e.prototype.pause=function(t){0!=this._validate(t)&&this._audio[t].pause()},e.prototype.resume=function(t){0!=this._validate(t)&&this._audio[t].resume()},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e in this._audio)this._audio[e].stop(),this._audio[e].destroy(),delete this._audio[e];delete this._audio},e}(t.Component);e.Sound=i}(t.Components||(t.Components={})),t.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(e){function i(n,o){e.call(this,n,"ArcadePhysics"),this._callbackFunction=null,this._callbackContext=null,this.parent=n,this.box=o,this.transform=this.parent.transform,this.last=new t.Geom.Point(this.transform.worldX,this.transform.worldY),this.mass=1,this.elasticity=0,this.immovable=!1,this.moves=!0,this.touching=i.NONE,this.wasTouching=i.NONE,this.allowCollisions=i.ANY,this.velocity=new t.Geom.Point,this.acceleration=new t.Geom.Point,this.drag=new t.Geom.Point,this.maxVelocity=new t.Geom.Point(1e4,1e4),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e4}return __extends(i,e),i.prototype.isTouching=function(t){return(this.touching&t)==t},i.prototype.solid=function(t){return void 0!==t&&(this.allowCollisions=t?i.ANY:i.NONE),(this.allowCollisions&i.ANY)>i.NONE},i.prototype.setCallback=function(t,e){this._callbackFunction=t,this._callbackContext=e},i.separate=function(t,e){var i=this.separateX(t,e),n=this.separateY(t,e);return i||n},i.separateX=function(e,n){var o=e.components.getComponent("ArcadePhysics"),r=n.components.getComponent("ArcadePhysics");if(o.immovable&&r.immovable)return!1;var s=0,a=o.transform.worldX-o.last.x,h=r.transform.worldX-r.last.x;if(a==h)return!1;var u=a>0?a:-a,c=h>0?h:-h,l=o.box.worldHitbox,p=r.box.worldHitbox,d=new t.Geom.Rectangle(l.x-(a>0?a:0),o.last.y+o.box.hitboxOffset.y,l.width+(a>0?a:-a),l.height),f=new t.Geom.Rectangle(p.x-(h>0?h:0),r.last.y+r.box.hitboxOffset.y,p.width+(h>0?h:-h),p.height);if(d.x+d.width>f.x&&d.x<f.x+f.width&&d.y+d.height>f.y&&d.y<f.y+f.height){var m=u+c+i.OVERLAP_BIAS;a>h?(s=l.x+l.width-p.x,!(s>m)&&o.allowCollisions&i.RIGHT&&r.allowCollisions&i.LEFT?(o.touching|=i.RIGHT,r.touching|=i.LEFT):s=0):(s=l.x-p.width-p.x,!(-s>m)&&o.allowCollisions&i.LEFT&&r.allowCollisions&i.RIGHT?(o.touching|=i.LEFT,r.touching|=i.RIGHT):s=0)}if(0!=s){var y=o.velocity.x,g=r.velocity.x;if(o.immovable||r.immovable)o.immovable?r.immovable||(r.transform.x=r.transform.x+s,r.velocity.x=y-g*r.elasticity):(o.transform.x=o.transform.x-s,o.velocity.x=g-y*o.elasticity);else{s*=.5,o.transform.x=o.transform.x-s,r.transform.x=r.transform.x+s;var _=Math.sqrt(g*g*r.mass/o.mass)*(g>0?1:-1),b=Math.sqrt(y*y*o.mass/r.mass)*(y>0?1:-1),v=.5*(_+b);_-=v,b-=v,o.velocity.x=v+_*o.elasticity,r.velocity.x=v+b*r.elasticity}return!0}return!1},i.separateY=function(e,n){var o=e.components.getComponent("ArcadePhysics"),r=n.components.getComponent("ArcadePhysics");if(o.immovable&&r.immovable)return!1;var s=0,a=o.transform.worldY-o.last.y,h=r.transform.worldY-r.last.y;if(a==h)return!1;var u=a>0?a:-a,c=h>0?h:-h,l=o.box.worldHitbox,p=r.box.worldHitbox,d=new t.Geom.Rectangle(l.x,l.y-(a>0?a:0),l.width,l.height+u),f=new t.Geom.Rectangle(p.x,p.y-(h>0?h:0),p.width,p.height+c);if(d.x+d.width>f.x&&d.x<f.x+f.width&&d.y+d.height>f.y&&d.y<f.y+f.height){var m=u+c+i.OVERLAP_BIAS;if(a>h?(s=l.y+l.height-p.y,!(s>m)&&o.allowCollisions&i.DOWN&&r.allowCollisions&i.UP?(o.touching|=i.DOWN,r.touching|=i.UP):s=0):(s=l.y-p.height-p.y,!(-s>m)&&o.allowCollisions&i.UP&&r.allowCollisions&i.DOWN?(o.touching|=i.UP,r.touching|=i.DOWN):s=0),0!=s){var y=o.velocity.y,g=r.velocity.y;if(o.immovable||r.immovable)o.immovable?r.immovable||(r.transform.y=r.transform.y+s,r.velocity.y=y-g*r.elasticity,e.active&&o.moves&&h>a&&(r.transform.x=r.transform.worldX+e.transform.worldX-o.last.x)):(o.transform.y=o.transform.y-s,o.velocity.y=g-y*o.elasticity,n.active&&r.moves&&a>h&&(o.transform.x=o.transform.worldX+n.transform.worldX-r.last.x));else{s*=.5,o.transform.y=o.transform.y-s,r.transform.y=r.transform.y+s;var _=Math.sqrt(g*g*r.mass/o.mass)*(g>0?1:-1),b=Math.sqrt(y*y*o.mass/r.mass)*(y>0?1:-1),v=.5*(_+b);_-=v,b-=v,o.velocity.y=v+_*o.elasticity,r.velocity.y=v+b*r.elasticity}return!0}}return!1},i.separateTiles=function(t,e,i){if(0==t.components.hasComponent("ArcadePhysics"))return!1;if(t.components.getComponent("ArcadePhysics").immovable)return!1;for(var n=!1,o=!1,r=0;r<i.length;r++){var s=i[r];n||(n=this.separateTilesX(t,e,s)),o||(o=this.separateTilesY(t,e,s))}return n||o},i.separateTilesX=function(e,n,o){var r=e.components.getComponent("ArcadePhysics"),s=n.components.getComponent("ArcadePhysics"),a=r.transform.worldX-r.last.x,h=s.transform.worldX-s.last.x;if(a==h)return!1;var u=a>0?a:-a,c=h>0?h:-h,l=0,p=u+c+i.OVERLAP_BIAS,d=r.box.worldHitbox,f=n.tilemap.tileTypes,m=n.tileData,y=s.transform.worldX+o.x,g=new t.Geom.Rectangle(d.x-(a>0?a:0),r.last.y+r.box.hitboxOffset.y,d.width+(a>0?a:-a),d.height),_=new t.Geom.Rectangle(y-(h>0?h:0),s.last.y+o.y,n.tileWidth+(h>0?h:-h),n.tileHeight);if(g.x+g.width>_.x&&g.x<_.x+_.width&&g.y+g.height>_.y&&g.y<_.y+_.height&&(a>h?(l=d.x+d.width-y,!(l>p)&&r.allowCollisions&i.RIGHT&&f[m[o.index]].allowCollisions&i.LEFT?r.touching|=i.RIGHT:l=0):(l=d.x-n.tileWidth-y,!(-l>p)&&r.allowCollisions&i.LEFT&&f[m[o.index]].allowCollisions&i.RIGHT?r.touching|=i.LEFT:l=0),0!=l)){var b=r.velocity.x,v=s.velocity.x;return r.transform.x=r.transform.x-l,r.velocity.x=v-b*r.elasticity,!0}return!1},i.separateTilesY=function(e,n,o){var r=e.components.getComponent("ArcadePhysics"),s=n.components.getComponent("ArcadePhysics"),a=r.transform.worldY-r.last.y,h=s.transform.worldY-s.last.y;if(a==h)return!1;var u=a>0?a:-a,c=h>0?h:-h,l=0,p=u+c+i.OVERLAP_BIAS,d=r.box.worldHitbox,f=n.tilemap.tileTypes,m=n.tileData,y=n.transform.worldY+o.y,g=new t.Geom.Rectangle(d.x,d.y-(a>0?a:0),d.width,d.height+u),_=new t.Geom.Rectangle(s.transform.worldX+o.x,y-(h>0?h:0),n.tileWidth,n.tileHeight+c);if(g.x+g.width>_.x&&g.x<_.x+_.width&&g.y+g.height>_.y&&g.y<_.y+_.height&&(a>h?(l=d.y+d.height-y,!(l>p)&&r.allowCollisions&i.DOWN&&f[m[o.index]].allowCollisions&i.UP?r.touching|=i.DOWN:l=0):(l=d.y-n.tileHeight-y,!(-l>p)&&r.allowCollisions&i.UP&&f[m[o.index]].allowCollisions&i.DOWN?r.touching|=i.UP:l=0),0!=l)){var b=r.velocity.y,v=s.velocity.y;return r.transform.y=r.transform.y-l,r.velocity.y=v-b*r.elasticity,!0}return!1},i.prototype.overlapsTiles=function(e,n,o){if("undefined"==typeof n&&(n=!1),"undefined"==typeof o&&(o=t.Components.ArcadePhysics.ANY),this.parent.childType()!==t.TILE_LAYER)return!1;var r=this.parent.getOverlappingTiles(e,o);return r.length>0?(n&&i.separateTiles(e,this.parent,r),!0):!1},i.prototype.overlaps=function(t,e){if("undefined"==typeof e&&(e=!1),0!=t.components.hasComponent("Box")){var n=t.components.getComponent("Box"),o=n.worldHitbox.x+n.worldHitbox.width>this.box.worldHitbox.x&&n.worldHitbox.x<this.box.worldHitbox.x+this.box.worldHitbox.width&&n.worldHitbox.y+n.worldHitbox.height>this.box.worldHitbox.y&&n.worldHitbox.y<this.box.worldHitbox.y+this.box.worldHitbox.height;return o&&(e&&i.separate(this.owner,t),null!==this._callbackFunction&&null!==this._callbackContext&&this._callbackFunction.call(this._callbackContext,this.owner,t)),o}},i.prototype.overlapsGroup=function(e,i){"undefined"==typeof i&&(i=!1);for(var n=!1,o=0;o<e.members.length;o++)e.members[o].childType()===t.GROUP?this.overlapsGroup(e.members[o],i):this.overlaps(e.members[o],i)&&(null!==this._callbackContext&&null!==this._callbackFunction&&this._callbackFunction.call(this._callbackContext,this.owner,e.members[o]),n=!0);return n},i.prototype.overlapsArray=function(e,i){"undefined"==typeof i&&(i=!1);for(var n=!1,o=0;o<e.length;o++)"undefined"!=typeof e[o].childType&&(e[o].childType()==t.GROUP?this.overlapsGroup(e[o],i):this.overlaps(e[o],i)&&(null!==this._callbackFunction&&null!==this._callbackContext&&this._callbackFunction.call(this._callbackContext,this.owner,e[o]),n=!0));return n},i.computeVelocity=function(t,e,n,o){return"undefined"==typeof e&&(e=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=1e4),0!=e?t+=e*i.updateInterval:0!=n&&(n*=i.updateInterval,t-n>0?t-=n:0>t+n?t+=n:t=0),0!=t&&1e4!=o&&(t>o?t=o:-o>t&&(t=-o)),t},i.prototype.updateMotion=function(){var t,e;e=(i.computeVelocity(this.angularVelocity,this.angularAcceleration,this.angularDrag,this.maxAngular)-this.angularVelocity)/2,this.angularVelocity+=e,this.transform.rotation+=this.angularVelocity*i.updateInterval,this.angularVelocity+=e,e=(i.computeVelocity(this.velocity.x,this.acceleration.x,this.drag.x,this.maxVelocity.x)-this.velocity.x)/2,this.velocity.x+=e,t=this.velocity.x*i.updateInterval,this.velocity.x+=e,this.transform.x=this.transform.x+t,e=(i.computeVelocity(this.velocity.y,this.acceleration.y,this.drag.y,this.maxVelocity.y)-this.velocity.y)/2,this.velocity.y+=e,t=this.velocity.y*i.updateInterval,this.velocity.y+=e,this.transform.y=this.transform.y+t
},i.prototype.update=function(){this.last.x=this.transform.worldX,this.last.y=this.transform.worldY,this.moves&&this.updateMotion(),this.wasTouching=this.touching,this.touching=i.NONE},i.prototype.destroy=function(){e.prototype.destroy.call(this),delete this.transform,delete this.owner,delete this._callbackContext,delete this._callbackFunction},i.prototype.objType=function(){return"ArcadePhysics"},i.collide=function(t,e,n){return"undefined"==typeof n&&(n=!0),i.overlaps(t,e,n)},i.collideGroup=function(t,e,n){return"undefined"==typeof n&&(n=!0),i.overlapsObjectGroup(t,e,n)},i.collideGroupGroup=function(t,e,n){return"undefined"==typeof n&&(n=!0),i.overlapsGroupGroup(t,e,n)},i.overlaps=function(t,e,i){"undefined"==typeof i&&(i=!0);var n=t.components.getComponent("ArcadePhysics");return n.overlaps(e,i)},i.overlapsObjectGroup=function(t,e,i){"undefined"==typeof i&&(i=!0);var n=t.components.getComponent("ArcadePhysics");return n.overlapsGroup(e,i)},i.overlapsGroupGroup=function(e,n,o){"undefined"==typeof o&&(o=!0);for(var r=!1,s=e.members,a=0;a<e.members.length;)s[a].childType()==t.GROUP?i.overlapsGroupGroup(s[a++],n,o)&&(r=!0):i.overlapsObjectGroup(s[a++],n,o)&&(r=!0);return r},i.overlapsArrayGroup=function(e,n,o){"undefined"==typeof o&&(o=!0);for(var r=!1,s=0;s<e.length;s++)"undefined"!=typeof e[s].childType&&(e[s].childType()===t.GROUP?i.overlapsGroupGroup(e[s],n,o)&&(r=!0):i.overlapsObjectGroup(e[s],n,o)&&(r=!0));return r},i.updateInterval=.1,i.LEFT=1,i.RIGHT=16,i.UP=256,i.DOWN=4096,i.NONE=0,i.CEILING=i.UP,i.FLOOR=i.DOWN,i.WALL=i.LEFT|i.RIGHT,i.ANY=i.LEFT|i.RIGHT|i.UP|i.DOWN,i.OVERLAP_BIAS=4,i}(t.Component);e.ArcadePhysics=i}(t.Components||(t.Components={})),t.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this._calculateBytes=!0,this._fileTotal=0,this._currentFile=0,this._bytesTotal=0,this._bytesLoaded=0,this._bytesCurrent=0,this._fileChunk=0,this._percentLoaded=0,this._complete=!1,this._game=t}return e.prototype.objType=function(){return"Loader"},e.prototype.boot=function(){this._fileList=[],this._loadList=[]},e.prototype.init=function(t,e,i){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=!1),this._fileList.length=0,this._loadList.length=0,this._calculateBytes=i,this._complete=!1,null!==t&&(this._onProgressCallback=t),null!==e&&(this._onCompleteCallback=e)},e.prototype.addImage=function(e,i,n,o,r,s,a){"undefined"==typeof a&&(a=!0);var h=new t.Files.File(this._game,t.Files.File.IMAGE,i,e,!0,a);h.metadata={width:n,height:o,offsetX:r,offsetY:s},this._fileList.push(h)},e.prototype.addSpriteSheet=function(e,i,n,o,r,s,a,h,u,c,l,p){"undefined"==typeof p&&(p=!0);var d=new t.Files.File(this._game,t.Files.File.SPRITE_SHEET,i,e,!0,p);d.metadata={frameWidth:n,frameHeight:o,numCells:r,rows:s,cols:a,sheetOffsetX:h,sheetOffsetY:u,cellOffsetX:c,cellOffsetY:l},this._fileList.push(d)},e.prototype.addTextureAtlas=function(e,i,n,o,r){"undefined"==typeof r&&(r=!0);var s=new t.Files.File(this._game,t.Files.File.TEXTURE_ATLAS,i,e,!0,r),a=new t.Files.File(this._game,t.Files.File.JSON,o,n,!0,r);s.metadata={jsonID:n},a.metadata={imageID:e},this._fileList.push(s,a)},e.prototype.addAudio=function(e,i,n,o){if("undefined"==typeof n&&(n=!0),"undefined"==typeof o&&(o=!0),t.Utils.Common.isString(i))this.attemptToAddAudio(e,i,n,o);else if(t.Utils.Common.isArray(i))for(var r=0;r<i.length&&(0==t.Utils.Common.isString(i[r])||1!=this.attemptToAddAudio(e,i[r],n,o));r++);},e.prototype.attemptToAddAudio=function(e,i,n,o){var r=new t.Files.File(this._game,t.Files.File.AUDIO,i,e,!0,n),s=!1;switch(r.fileExtension){case"mp3":s=t.DEVICE.mp3;break;case"ogg":case"oga":s=t.DEVICE.ogg;break;case"m4a":s=t.DEVICE.m4a;break;case"wav":case"wave":s=t.DEVICE.wav}return 1==s||0==o?(this._fileList.push(r),!0):(this._game.debug&&console.error("Kiwi.Loader: Audio Format not supported on this Device/Browser."),!1)},e.prototype.addJSON=function(e,i,n){"undefined"==typeof n&&(n=!0),this._fileList.push(new t.Files.File(this._game,t.Files.File.JSON,i,e,!0,n))},e.prototype.addXML=function(e,i,n){"undefined"==typeof n&&(n=!0),this._fileList.push(new t.Files.File(this._game,t.Files.File.XML,i,e,!0,n))},e.prototype.addBinaryFile=function(e,i,n){"undefined"==typeof n&&(n=!0),this._fileList.push(new t.Files.File(this._game,t.Files.File.BINARY_DATA,i,e,!0,n))},e.prototype.addTextFile=function(e,i,n){"undefined"==typeof n&&(n=!0),this._fileList.push(new t.Files.File(this._game,t.Files.File.TEXT_DATA,i,e,!0,n))},e.prototype.startLoad=function(){0===this._fileList.length?this._onCompleteCallback():(this._onProgressCallback(0,0,null),this._fileTotal=this._fileList.length,this._bytesLoaded=0,this._bytesTotal=0,this._bytesCurrent=0,this._currentFile=0,this._fileChunk=0,this._percentLoaded=0,this._calculateBytes===!0?this.getNextFileSize():(this._fileChunk=Math.floor(100/this._fileTotal),this._loadList=this._fileList,this.nextFile()))},e.prototype.getNextFileSize=function(){var t=this;if(0===this._fileList.length){var e=this._fileList.shift();e.getFileDetails(function(e){return t.addToBytesTotal(e)})}else this.nextFile()},e.prototype.addToBytesTotal=function(t){this._bytesTotal+=t.fileSize,this._loadList.push(t),this.getNextFileSize()},e.prototype.nextFile=function(){var t=this;this._currentFile++;var e=this._loadList.shift();e.load(function(e){return t.fileLoadComplete(e)},function(e){return t.fileLoadProgress(e)})},e.prototype.fileLoadProgress=function(t){this._calculateBytes===!0&&(this._bytesCurrent=t.bytesLoaded,this._onProgressCallback&&this._onProgressCallback(this.getPercentLoaded(),this.getBytesLoaded(),t))},e.prototype.fileLoadComplete=function(t){this._calculateBytes===!0?(this._bytesLoaded+=t.bytesTotal,this._bytesCurrent=0,this._onProgressCallback&&this._onProgressCallback(this.getPercentLoaded(),this._bytesLoaded,t)):this._onProgressCallback&&this._onProgressCallback(this.getPercentLoaded(),0,t),0===this._loadList.length?(this._complete=!0,this._game.debug&&console.log("All files have loaded"),this._onCompleteCallback&&this._onCompleteCallback()):this.nextFile()},e.prototype.getBytesLoaded=function(){return this._bytesLoaded+this._bytesCurrent},e.prototype.getPercentLoaded=function(){return Math.round(this._calculateBytes===!0?this.getBytesLoaded()/this._bytesTotal*100:this._currentFile/this._fileTotal*100)},e.prototype.calculateBytes=function(t){return t&&(this._calculateBytes=t),this._calculateBytes},e.prototype.complete=function(){return this._complete},e}();e.Loader=i}(t.Files||(t.Files={})),t.Files}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this._game=t,this.data={}}return e.prototype.objType=function(){return"DataLibrary"},e.prototype.clear=function(){for(var t in this.data)delete this.data[t]},e.prototype.add=function(e){switch(e.dataType){case t.Files.File.JSON:case t.Files.File.XML:case t.Files.File.BINARY_DATA:case t.Files.File.TEXT_DATA:this.data[e.key]=e}},e.prototype.rebuild=function(t,e){this.clear(),this._game.debug&&console.log("Kiwi.DataLibrary: Rebuilding Data Library");for(var i=t.keys,n=0;n<i.length;n++){var o=this._game.fileStore.getFile(i[n]);o.isData&&(this._game.debug&&console.log("  Kiwi.DataLibrary: Adding Data: "+o.fileName),e.dataLibrary.add(o))}},e}();e.DataLibrary=i}(t.Files||(t.Files={})),t.Files}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(e,i,n,o,r,s){"undefined"==typeof o&&(o=""),"undefined"==typeof r&&(r=!0),"undefined"==typeof s&&(s=!0),this._xhr=null,this._saveToFileStore=!0,this._useTagLoader=!0,this.fileSize=0,this.ETag="",this.lastModified="",this.timeStarted=0,this.timeFinished=0,this.duration=0,this.hasError=!1,this.success=!1,this.onCompleteCallback=null,this.onProgressCallback=null,this.lastProgress=0,this.percentLoaded=0,this.status=0,this.statusText="",this.bytesLoaded=0,this.bytesTotal=0,this.readyState=0,this.timeOutDelay=4e3,this.hasTimedOut=!1,this.timedOut=0,this.attemptCounter=0,this.maxLoadAttempts=2,this.maxHeadLoadAttempts=1,this._game=e,this.dataType=i,this.fileURL=n,n.lastIndexOf("/")>-1?(this.fileName=n.substr(n.lastIndexOf("/")+1),this.filePath=n.substr(0,n.lastIndexOf("/")+1)):(this.filePath="",this.fileName=n),this.fileExtension=n.substr(n.lastIndexOf(".")+1).toLowerCase(),this._useTagLoader=t.DEVICE.blob?!0:!0,this.dataType===t.Files.File.AUDIO&&(this._useTagLoader=this._game.audio.usingAudioTag===!0?!0:!1),this.dataType===t.Files.File.JSON&&(this._useTagLoader=!1),this._saveToFileStore=r,this._fileStore=this._game.fileStore,this.ownerState=this._game.states.current&&!s?this._game.states.current:null,this.key=""===this.key?this.fileName:o}return e.prototype.objType=function(){return"File"},e.prototype.addTag=function(t){-1==this._tags.indexOf(t)&&this._tags.push(t)},e.prototype.removeTag=function(t){var e=this._tags.indexOf(t);-1!=e&&this._tags.splice(e,1)},e.prototype.hasTag=function(t){return-1==this._tags.indexOf(t)?!1:!0},Object.defineProperty(e.prototype,"isTexture",{get:function(){return this.dataType===e.IMAGE||this.dataType===e.SPRITE_SHEET||this.dataType===e.TEXTURE_ATLAS?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAudio",{get:function(){return this.dataType===e.AUDIO?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isData",{get:function(){return this.dataType===e.XML||this.dataType===e.JSON||this.dataType===e.TEXT_DATA||this.dataType===e.BINARY_DATA?!0:!1},enumerable:!0,configurable:!0}),e.prototype.load=function(t,e,i,n,o){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),this._game.debug&&console.log("Kiwi.File: Attempting to load: "+this.fileName),this.onCompleteCallback=t,this.onProgressCallback=e,void 0!=n&&(this.maxLoadAttempts=n),void 0!=o&&(this.timeOutDelay=o),null!==i&&(this._fileStore=i,this._saveToFileStore=!0),this.start(),this._useTagLoader===!0?this.tagLoader():this.xhrLoader()},e.prototype.start=function(){this.timeStarted=Date.now(),this.lastProgress=Date.now(),this.percentLoaded=0,this.attemptCounter=0},e.prototype.stop=function(){this.percentLoaded=100,this.timeFinished=Date.now(),this.duration=this.timeFinished-this.timeStarted},e.prototype.tagLoader=function(){var e=this;this.dataType===t.Files.File.IMAGE||this.dataType===t.Files.File.SPRITE_SHEET||this.dataType===t.Files.File.TEXTURE_ATLAS?(this.data=new Image,this.data.src=this.fileURL,this.data.onload=function(t){return e.tagLoaderOnLoad(t)},this.data.onerror=function(t){return e.tagLoaderOnError(t)},this.data.onreadystatechange=function(t){return e.tagLoaderOnReadyStateChange(t)}):this.dataType===t.Files.File.AUDIO&&(this.data=document.createElement("audio"),this.data.src=this.fileURL,this.data.preload="auto",this._game.audio.locked?this.tagLoaderAudioLocked():(this.data.addEventListener("canplaythrough",function(){return e.tagLoaderProgressThrough(null)},!1),this._game.deviceTargetOption==t.TARGET_COCOON?this.data.load():(this.data.volume=0,this.data.play())))},e.prototype.tagLoaderOnReadyStateChange=function(){},e.prototype.tagLoaderOnError=function(t){this.hasError=!0,this.error=t,this.onCompleteCallback&&this.onCompleteCallback(this)},e.prototype.tagLoaderProgressThrough=function(){var e=this;100!==this.percentLoaded&&(this.dataType===t.Files.File.AUDIO&&(this.data.removeEventListener("canplaythrough",function(){return e.tagLoaderProgressThrough(null)}),this.data.pause(),this.data.currentTime=0,this.data.volume=1),this.tagLoaderOnLoad(null))},e.prototype.tagLoaderAudioLocked=function(){this.percentLoaded=100,this.tagLoaderOnLoad(null)},e.prototype.tagLoaderOnLoad=function(){this.stop(),this._game.debug&&console.log("Kiwi.File: Successfully Loaded: "+this.fileName),this._saveToFileStore===!0&&this._fileStore.addFile(this.key,this),this.onCompleteCallback&&this.onCompleteCallback(this)},e.prototype.xhrLoader=function(){var t=this;this.attemptCounter++,this._xhr=new XMLHttpRequest,this._xhr.open("GET",this.fileURL,!0),null!==this.timeOutDelay&&(this._xhr.timeout=this.timeOutDelay),this._xhr.responseType="arraybuffer",this._xhr.onloadstart=function(e){return t.xhrOnLoadStart(e)},this._xhr.onprogress=function(e){return t.xhrOnProgress(e)},this._xhr.ontimeout=function(e){return t.xhrOnTimeout(e)},this._xhr.onabort=function(e){return t.xhrOnAbort(e)},this._xhr.onload=function(e){return t.xhrOnLoad(e)},this._xhr.onreadystatechange=function(e){return t.xhrOnReadyStateChange(e)},this._xhr.send()},e.prototype.xhrOnReadyStateChange=function(t){this.readyState=t.target.readyState,4===this.readyState&&this.xhrOnLoad(t)},e.prototype.xhrOnLoadStart=function(t){this.timeStarted=t.timeStamp,this.lastProgress=t.timeStamp},e.prototype.xhrOnAbort=function(t){this._game.debug&&console.log("Kiwi.File: "+this.fileName+" loading was aborted."),this.error=t},e.prototype.xhrOnError=function(t){this._game.debug&&console.log("Kiwi.File: Error during load: "+this.fileName),this.error=t},e.prototype.xhrOnTimeout=function(t){this._game.debug&&console.log("Kiwi.File: Timed out: "+this.fileName),this.hasTimedOut=!0,this.timedOut=Date.now(),this.error=t},e.prototype.xhrOnProgress=function(t){this.bytesLoaded=parseInt(t.loaded),this.bytesTotal=parseInt(t.totalSize),this.percentLoaded=Math.round(this.bytesLoaded/this.bytesTotal*100),this.onProgressCallback&&this.onProgressCallback(this)},e.prototype.xhrOnLoad=function(){this.timeFinished>0||(this.status=this._xhr.status,this.statusText=this._xhr.statusText,200===this._xhr.status?(this.stop(),this.success=!0,this.hasError=!1,this._game.debug&&console.log("Kiwi.File: Successfully Loaded: "+this.fileName),this.fileType=this._xhr.getResponseHeader("Content-Type"),this.bytesTotal=parseInt(this._xhr.getResponseHeader("Content-Length")),this.lastModified=this._xhr.getResponseHeader("Last-Modified"),this.ETag=this._xhr.getResponseHeader("ETag"),this.buffer=this._xhr.response,this.processFile()):this.attemptCounter>=this.maxLoadAttempts?(this.success=!1,this.hasError=!0,this._game.debug&&console.error("Kiwi.File: "+this.fileName+" wasn't loaded."),this.parseComplete()):(this._game.debug&&console.log("Kiwi.File: Retrying to load: "+this.fileName),this.xhrLoader()))},e.prototype.processFile=function(){switch(this.dataType){case t.Files.File.IMAGE:case t.Files.File.SPRITE_SHEET:case t.Files.File.TEXTURE_ATLAS:this.createBlob();break;case t.Files.File.JSON:this.data="";for(var e=new Uint8Array(this.buffer),i=0;i<e.length;i++)this.data+=String.fromCharCode(e[i]);this.parseComplete();break;case t.Files.File.AUDIO:if(this._game.audio.usingWebAudio){this.data={raw:this._xhr.response,decoded:!1,buffer:null};var n=this;this._game.audio.context.decodeAudioData(this.data.raw,function(t){t&&(n.data.buffer=t,n.data.decoded=!0,n.parseComplete())})}break;default:this.parseComplete()}},e.prototype.createBlob=function(){var t=this;this.data=document.createElement("img"),this.data.onload=function(){return t.revoke()};var e="";"jpg"===this.fileExtension||"jpeg"===this.fileExtension?e="image/jpeg":"png"===this.fileExtension?e="image/png":"gif"===this.fileExtension&&(e="image/gif");var i=new window.Blob([this.buffer],{type:e});window.URL?this.data.src=window.URL.createObjectURL(i):window.webkitURL&&(this.data.src=window.webkitURL.createObjectURL(i))},e.prototype.revoke=function(){window.URL?window.URL.revokeObjectURL(this.data.src):window.webkitURL&&window.webkitURL.revokeObjectURL(this.data.src),this.parseComplete()},e.prototype.parseComplete=function(){this._saveToFileStore===!0&&this._fileStore.addFile(this.key,this),this.onCompleteCallback&&this.onCompleteCallback(this)},e.prototype.getFileDetails=function(t,e,i){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=this.timeOutDelay),this.onCompleteCallback=t,void 0!==this.maxHeadLoadAttempts&&(this.maxHeadLoadAttempts=e),this.attemptCounter=0,this.sendXHRHeadRequest(i)},e.prototype.sendXHRHeadRequest=function(t){var e=this;this.attemptCounter++,this._xhr=new XMLHttpRequest,this._xhr.open("HEAD",this.fileURL,!1),this._xhr.onload=function(t){return e.getXHRResponseHeaders(t)},this._xhr.ontimeout=function(t){return e.xhrHeadOnTimeout(t)},this._xhr.onerror=function(t){return e.xhrHeadOnError(t)},null!==this.timeOutDelay&&(this._xhr.timeout=t),this._xhr.send()},e.prototype.xhrHeadOnTimeout=function(t){this.hasTimedOut=!0,this.timedOut=Date.now(),this.error=t},e.prototype.xhrHeadOnError=function(t){this.hasError=!0,this.error=t,this.status=this._xhr.status,this.statusText=this._xhr.statusText},e.prototype.getXHRResponseHeaders=function(){this.status=this._xhr.status,this.statusText=this._xhr.statusText,200===this._xhr.status?(this.fileType=this._xhr.getResponseHeader("Content-Type"),this.fileSize=parseInt(this._xhr.getResponseHeader("Content-Length")),this.lastModified=this._xhr.getResponseHeader("Last-Modified"),this.ETag=this._xhr.getResponseHeader("ETag"),this.completeXHRHeadRequest(!0)):this.completeXHRHeadRequest(!1)},e.prototype.completeXHRHeadRequest=function(t){return 0==t&&this.attemptCounter<this.maxLoadAttempts?void this.sendXHRHeadRequest(this.timeOutDelay):void(this.onCompleteCallback&&(this.attemptCounter=0,this.onCompleteCallback(this)))},e.IMAGE=0,e.SPRITE_SHEET=1,e.TEXTURE_ATLAS=2,e.AUDIO=3,e.JSON=4,e.XML=5,e.BINARY_DATA=6,e.TEXT_DATA=7,e}();e.File=i}(t.Files||(t.Files={})),t.Files}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t){this._size=0,this._game=t,this._files={}}return t.prototype.objType=function(){return"FileStore"},t.prototype.boot=function(){},t.prototype.getFile=function(t){return this._files[t]},t.prototype.getFilesByTag=function(t){var e={};for(var i in this._files)this._files[i].hasTag(t)&&(e[i]=this._files[i]);return e},t.prototype.removeFilesByTag=function(t){var e=0;for(var i in this._files)this._files[i].hasTag(t)&&(this.removeFile(i),e++);return e},Object.defineProperty(t.prototype,"keys",{get:function(){var t=new Array;for(var e in this._files)t.push(e);return t},enumerable:!0,configurable:!0}),t.prototype.size=function(){return this._size},t.prototype.addFile=function(t,e){return this._files[t]?!1:(this._files[t]=e,this._size++,!0)},t.prototype.exists=function(t){return this._files[t]?!0:!1},t.prototype.removeStateFiles=function(t){for(var e in this._files)this._files[e].ownerState===t&&this.removeFile(e)},t.prototype.removeFile=function(t){return this._files[t]?(this._files[t]=null,delete this._files[t],!0):!1},t}();t.FileStore=e}(t.Files||(t.Files={})),t.Files}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(){this.isReady=!1,this.container=null,this.input=null}return e.prototype.objType=function(){return"Bootstrap"},e.prototype.boot=function(t,e,i){var n=this;"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=!0),this._callback=e,this._domParent=t,this._createContainer=i,"complete"===document.readyState||"interactive"===document.readyState?this.ready():(document.addEventListener("DOMContentLoaded",function(){return n.ready()},!1),window.addEventListener("load",function(){return n.ready()},!1))},e.prototype.ready=function(){var t=this;this.isReady!==!0&&(document.body?(this.isReady=!0,this._createContainer===!0&&(""===this._domParent?(this.container=document.createElement("div"),this._setupContainer("KiwiGame"+Date.now().toString()),document.body.appendChild(this.container)):document.getElementById(this._domParent)?(this.container=document.getElementById(this._domParent),this._setupContainer()):(this.container=document.createElement("div"),this._setupContainer(this._domParent),document.body.appendChild(this.container))),null!==this._callback&&this._callback()):window.setTimeout(function(){return t.ready()},13))},e.prototype._setupContainer=function(e){"undefined"==typeof e&&(e=""),e&&(this.container.id=e),this.container.style.width=t.Stage.DEFAULT_WIDTH+"px",this.container.style.height=t.Stage.DEFAULT_HEIGHT+"px",this.container.style.position="relative",this.container.style.overflow="hidden"},e}();e.Bootstrap=i}(t.System||(t.System={})),t.System}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(){this.iOS=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.webGL=!1,this.worker=!1,this.blob=!1,this.touch=!1,this.pointerEnabled=!1,this.arora=!1,this.chrome=!1,this.epiphany=!1,this.firefox=!1,this.ie=!1,this.ieVersion=0,this.ieMobile=!1,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.audioData=!1,this.webaudio=!1,this.ogg=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this._checkAudio(),this._checkBrowser(),this._checkDevice(),this._checkFeatures(),this._checkOS()}return t.prototype.objType=function(){return"Device"},t.prototype._checkOS=function(){var t=navigator.userAgent;/Android/.test(t)?this.android=!0:/CrOS/.test(t)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?this.iOS=!0:/Linux/.test(t)?this.linux=!0:/Mac OS/.test(t)?this.macOS=!0:/Windows Phone/.test(t)?this.windowsPhone=!0:/Windows/.test(t)&&(this.windows=!0)},t.prototype._checkFeatures=function(){"undefined"!=typeof window.Blob&&(this.blob=!0),this.canvas=!!window.CanvasRenderingContext2D;try{this.localStorage=!!localStorage.getItem}catch(t){this.localStorage=!1}this.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),this.fileSystem=!!window.requestFileSystem,this.webGL=!!window.WebGLRenderingContext,this.worker=!!window.Worker,("ontouchstart"in document.documentElement||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0)&&(this.touch=!0),(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&(this.pointerEnabled=!0)},t.prototype._checkBrowser=function(){var t=navigator.userAgent;navigator.appName,/Arora/.test(t)?this.arora=!0:/Chrome/.test(t)?this.chrome=!0:/Epiphany/.test(t)?this.epiphany=!0:/Firefox/.test(t)?this.firefox=!0:/Mobile Safari/.test(t)?this.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(t)?(this.ie=!0,this.ieVersion=parseInt(RegExp.$1),/IEMobile/.test(t)&&(this.ieMobile=!0)):/Trident/.test(t)?(this.ie=!0,/rv:(\d+\.\d+)\)/.test(t),this.ieVersion=parseInt(RegExp.$1)):/Midori/.test(t)?this.midori=!0:/Opera/.test(t)?this.opera=!0:/Safari/.test(t)&&(this.safari=!0),navigator.standalone&&(this.webApp=!0)},t.prototype._checkAudio=function(){this.audioData=!!window.Audio,this.webaudio=!(!window.webkitAudioContext&&!window.AudioContext);var t=document.createElement("audio"),e=!1;try{(e=!!t.canPlayType)&&(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.ogg=!0),t.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.mp3=!0),t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.wav=!0),(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;").replace(/^no$/,""))&&(this.m4a=!0))}catch(i){}},t.prototype._checkDevice=function(){this.pixelRatio=window.devicePixelRatio||1,this.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),this.iPhone4=2==this.pixelRatio&&this.iPhone,this.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad")},t.prototype.getAll=function(){var t="";return t=t.concat("Device\n"),t=t.concat("iPhone : "+this.iPhone+"\n"),t=t.concat("iPhone4 : "+this.iPhone4+"\n"),t=t.concat("iPad : "+this.iPad+"\n"),t=t.concat("\n"),t=t.concat("Operating System\n"),t=t.concat("iOS: "+this.iOS+"\n"),t=t.concat("Android: "+this.android+"\n"),t=t.concat("ChromeOS: "+this.chromeOS+"\n"),t=t.concat("Linux: "+this.linux+"\n"),t=t.concat("MacOS: "+this.macOS+"\n"),t=t.concat("Windows: "+this.windows+"\n"),t=t.concat("\n"),t=t.concat("Browser\n"),t=t.concat("Arora: "+this.arora+"\n"),t=t.concat("Chrome: "+this.chrome+"\n"),t=t.concat("Epiphany: "+this.epiphany+"\n"),t=t.concat("Firefox: "+this.firefox+"\n"),t=t.concat("Internet Explorer: "+this.ie+" ("+this.ieVersion+")\n"),t=t.concat("Mobile Safari: "+this.mobileSafari+"\n"),t=t.concat("Midori: "+this.midori+"\n"),t=t.concat("Opera: "+this.opera+"\n"),t=t.concat("Safari: "+this.safari+"\n"),t=t.concat("\n"),t=t.concat("Features\n"),t=t.concat("Blob: "+this.blob+"\n"),t=t.concat("Canvas: "+this.canvas+"\n"),t=t.concat("File: "+this.file+"\n"),t=t.concat("FileSystem: "+this.fileSystem+"\n"),t=t.concat("LocalStorage: "+this.localStorage+"\n"),t=t.concat("WebGL: "+this.webGL+"\n"),t=t.concat("Worker: "+this.worker+"\n"),t=t.concat("Touch: "+this.touch+"\n"),t=t.concat("\n"),t=t.concat("Audio\n"),t=t.concat("Audio Data: "+this.canvas+"\n"),t=t.concat("Web Audio: "+this.canvas+"\n"),t=t.concat("Can play OGG: "+this.canvas+"\n"),t=t.concat("Can play MP3: "+this.canvas+"\n"),t=t.concat("Can play M4A: "+this.canvas+"\n"),t=t.concat("Can play WAV: "+this.canvas+"\n")},t}();t.Device=e}(t.System||(t.System={})),t.System}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t,e,i,n,o){this.dirty=!1,this.cellIndex=0,this.name=t,this.cells=i||new Array,this.sequences=o||new Array,this.image=n,this._type=e}return e.prototype.objType=function(){return"TextureAtlas"},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),e.prototype.refreshTextureGL=function(t){this.glTextureWrapper&&this.glTextureWrapper.refreshTexture(t),this.dirty=!1},e.prototype.readJSON=function(e){var i=JSON.parse(e);void 0!==i.name&&(this.name=i.name);for(var n=0;n<i.cells.length;n++)this.cells.push(i.cells[n]),void 0===i.cells[n].hitboxes&&(this.cells[n].hitboxes=new Array,this.cells[n].hitboxes.push({x:0,y:0,w:this.cells[n].w,h:this.cells[n].h}));if(i.sequences)for(var n=0;n<i.sequences.length;n++){var o=new t.Animations.Sequence(i.sequences[n].name,i.sequences[n].cells);void 0!==i.sequences[n].speed&&(o.speed=i.sequences[n].speed),void 0!==i.sequences[n].loop&&(o.loop=i.sequences[n].loop),this.sequences.push(o)}},e.SINGLE_IMAGE=0,e.SPRITE_SHEET=1,e.TEXTURE_ATLAS=2,e}();e.TextureAtlas=i}(t.Textures||(t.Textures={})),t.Textures}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this._game=t,this.textures=new Object}return e.prototype.objType=function(){return"TextureLibrary"},e.prototype.clear=function(){for(var t in this.textures)delete this.textures[t]},e.prototype.add=function(e){if(this.textures[e.name]=e,this._game.renderOption===t.RENDERER_WEBGL){(-1==t.Utils.Common.base2Sizes.indexOf(e.image.width)||-1==t.Utils.Common.base2Sizes.indexOf(e.image.height))&&console.log("Kiwi.TextureLibrary: Warning:Image is not of base2 size and may not render correctly.");var i=this._game.renderer;i.addTexture(this._game.stage.gl,e)}},e.prototype.addFromFile=function(e){switch(this._game.renderOption===t.RENDERER_WEBGL&&this._game.deviceTargetOption!=t.TARGET_COCOON&&(e=this._rebuildImage(e)),e.dataType){case t.Files.File.SPRITE_SHEET:this.textures[e.key]=this._buildSpriteSheet(e);break;case t.Files.File.IMAGE:this.textures[e.key]=this._buildImage(e);break;case t.Files.File.TEXTURE_ATLAS:this.textures[e.key]=this._buildTextureAtlas(e)}},e.prototype._rebuildImage=function(e){var i=t.Utils.Common.convertToBase2(e.data);return(e.data.width!==i.width||e.data.height!==i.height)&&(e.dataType===t.Files.File.SPRITE_SHEET?(e.metadata.rows||(e.metadata.rows=e.data.height/e.metadata.frameHeight),e.metadata.cols||(e.metadata.cols=e.data.width/e.metadata.frameWidth)):e.dataType===t.Files.File.IMAGE&&(e.metadata.width||(e.metadata.width=e.data.width),e.metadata.height||(e.metadata.height=e.data.height)),this._game.debug&&console.log("Kiwi.TextureLibrary: "+e.fileName+" has been rebuilt to be base2."),e.data=i),e},e.prototype._buildTextureAtlas=function(e){var i=new t.Textures.TextureAtlas(e.key,t.Textures.TextureAtlas.TEXTURE_ATLAS,null,e.data),n=e.metadata,o=this._game.fileStore.getFile(n.jsonID).data;return o.trim(),i.readJSON(o),i},e.prototype._buildSpriteSheet=function(e){var i=e.metadata,n=new t.Textures.SpriteSheet(e.key,e.data,i.frameWidth,i.frameHeight,i.numCells,i.rows,i.cols,i.sheetOffsetX,i.sheetOffsetY,i.cellOffsetX,i.cellOffsetY);return n},e.prototype._buildImage=function(e){var i=e.metadata;return new t.Textures.SingleImage(e.key,e.data,i.width,i.height,i.offsetX,i.offsetY)},e.prototype.rebuild=function(t,e){this.clear(),this._game.debug&&console.log("Kiwi.TextureLibrary: Rebuilding Texture Library");for(var i=t.keys,n=0;n<i.length;n++){var o=this._game.fileStore.getFile(i[n]);o.isTexture&&(this._game.debug&&console.log("  Kiwi.TextureLibrary: Adding Texture: "+o.fileName),e.textureLibrary.addFromFile(o))}},e}();e.TextureLibrary=i}(t.Textures||(t.Textures={})),t.Textures}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(e){function i(i,n,o,r,s,a,h,u,c,l,p){this.cellWidth=o,this.cellHeight=r,this._cols=h||n.width/o,this._rows=a||n.height/r,this.numCells=s||this.cols*this.rows,this.sheetOffsetX=u||0,this.sheetOffsetY=c||0,this.cellOffsetX=l||0,this.cellOffsetY=p||0,e.call(this,i,t.Textures.TextureAtlas.SPRITE_SHEET,this.generateAtlasCells(),n,this.sequences)}return __extends(i,e),i.prototype.objType=function(){return"SpriteSheet"},Object.defineProperty(i.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cols",{get:function(){return this._cols},enumerable:!0,configurable:!0}),i.prototype.generateAtlasCells=function(){for(var e=new Array,i=new Array,n=this.sheetOffsetX,o=this.sheetOffsetY,r=0,s=0;s<this.rows;s++){for(var a=0;a<this.cols;a++)e.push({x:n,y:o,w:this.cellWidth,h:this.cellHeight,hitboxes:[{x:0,y:0,w:this.cellWidth,h:this.cellHeight}]}),i.push(r++),n+=this.cellOffsetX+this.cellWidth;n=this.sheetOffsetX,o+=this.cellOffsetY+this.cellHeight}return this.sequences=new Array,this.sequences.push(new t.Animations.Sequence("default",i)),e},i}(e.TextureAtlas);e.SpriteSheet=i}(t.Textures||(t.Textures={})),t.Textures}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(e){function i(i,n,o,r,s,a){this.width=o||n.width,this.height=r||n.height,this.offsetX=s||0,this.offsetY=a||0,e.call(this,i,t.Textures.TextureAtlas.SINGLE_IMAGE,this.generateAtlasCells(),n)}return __extends(i,e),i.prototype.objType=function(){return"SingleImage"},i.prototype.generateAtlasCells=function(){return[{x:this.offsetX,y:this.offsetY,w:this.width,h:this.height,hitboxes:[{x:0,y:0,w:this.width,h:this.height}]}]},i}(e.TextureAtlas);e.SingleImage=i}(t.Textures||(t.Textures={})),t.Textures}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Back"},t.In=function(t){var e=1.70158;return t*t*((e+1)*t-e)},t.Out=function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},t.InOut=function(t){var e=2.5949095;return(t*=2)<1?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)},t}();t.Back=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){!function(e){var i=function(){function e(){}return e.prototype.objType=function(){return"Bounce"},e.In=function(e){return 1-t.Animations.Tweens.Easing.Bounce.Out(1-e)},e.Out=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},e.InOut=function(e){return.5>e?.5*t.Animations.Tweens.Easing.Bounce.In(2*e):.5*t.Animations.Tweens.Easing.Bounce.Out(2*e-1)+.5},e}();e.Bounce=i}(e.Easing||(e.Easing={})),e.Easing}(e.Tweens||(e.Tweens={})),e.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Circular"},t.In=function(t){return 1-Math.sqrt(1-t*t)},t.Out=function(t){return Math.sqrt(1- --t*t)},t.InOut=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)
},t}();t.Circular=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Cubic"},t.In=function(t){return t*t*t},t.Out=function(t){return--t*t*t+1},t.InOut=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},t}();t.Cubic=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Elastic"},t.In=function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)))},t.Out=function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/n)+1)},t.InOut=function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n):i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)*.5+1)},t}();t.Elastic=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Exponential"},t.In=function(t){return 0===t?0:Math.pow(1024,t-1)},t.Out=function(t){return 1===t?1:1-Math.pow(2,-10*t)},t.InOut=function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},t}();t.Exponential=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Linear"},t.None=function(t){return t},t}();t.Linear=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Quadratic"},t.In=function(t){return t*t},t.Out=function(t){return t*(2-t)},t.InOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},t}();t.Quadratic=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Quartic"},t.In=function(t){return t*t*t*t},t.Out=function(t){return 1- --t*t*t*t},t.InOut=function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},t}();t.Quartic=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Quintic"},t.In=function(t){return t*t*t*t*t},t.Out=function(t){return--t*t*t*t*t+1},t.InOut=function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},t}();t.Quintic=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Sinusoidal"},t.In=function(t){return 1-Math.cos(t*Math.PI/2)},t.Out=function(t){return Math.sin(t*Math.PI/2)},t.InOut=function(t){return.5*(1-Math.cos(Math.PI*t))},t}();t.Sinusoidal=e}(t.Easing||(t.Easing={})),t.Easing}(t.Tweens||(t.Tweens={})),t.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(){function e(t){this._game=t,this._tweens=[]}return e.prototype.objType=function(){return"TweenManager"},e.prototype.getAll=function(){return this._tweens},e.prototype.removeAll=function(){this._tweens.length=0},e.prototype.create=function(e){return new t.Animations.Tween(e,this._game)},e.prototype.add=function(t){return t.setParent(this._game),this._tweens.push(t),t},e.prototype.remove=function(t){var e=this._tweens.indexOf(t);-1!==e&&this._tweens.splice(e,1)},e.prototype.update=function(){if(0===this._tweens.length)return!1;for(var t=0,e=this._tweens.length;e>t;)this._tweens[t].update(this._game.time.now())?t++:(this._tweens.splice(t,1),e--);return!0},e}();e.TweenManager=i}(e.Tweens||(e.Tweens={})),e.Tweens}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(e,i){"undefined"==typeof i&&(i=null),this._game=null,this._manager=null,this._object=null,this._valuesStart={},this._valuesEnd={},this._duration=1e3,this._delayTime=0,this._startTime=null,this._easingFunction=t.Animations.Tweens.Easing.Linear.None,this._interpolationFunction=t.Utils.GameMath.linearInterpolation,this._chainedTweens=[],this._onStartCallback=null,this._onStartContext=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onUpdateContext=null,this._onCompleteCallback=null,this._onCompleteCalled=!1,this._onCompleteContext=null,this.isRunning=!1,this._object=e,null!==i&&(this._game=i,this._manager=this._game.tweens),this.isRunning=!1}return e.prototype.objType=function(){return"Tween"},e.prototype.to=function(t,e,i,n){return"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=!1),this._duration=e,this._valuesEnd=t,null!==i&&(this._easingFunction=i),n===!0?this.start():this},e.prototype.start=function(){if(null!==this._game&&null!==this._object){this.isRunning=!0,this._manager.add(this),this._onStartCallbackFired=!1,this._onCompleteCalled=!1,this._startTime=this._game.time.now()+this._delayTime;for(var t in this._valuesEnd)if(null!==this._object[t]&&t in this._object){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}this._valuesStart[t]="function"==typeof this._object[t]?this._object[t]():this._object[t]}return this}},e.prototype.stop=function(){return null!==this._manager&&this._manager.remove(this),this.isRunning=!1,this},e.prototype.setParent=function(t){this._game=t,this._manager=this._game.tweens},e.prototype.delay=function(t){return this._delayTime=t,this},e.prototype.easing=function(t){return this._easingFunction=t,this},e.prototype.interpolation=function(t){return this._interpolationFunction=t,this},e.prototype.chain=function(t){return this._chainedTweens.push(t),this},e.prototype.onStart=function(t,e){return this._onStartCallback=t,this._onStartContext=e,this},e.prototype.onUpdate=function(t,e){return this._onUpdateCallback=t,this._onUpdateContext=e,this},e.prototype.onComplete=function(t,e){return this._onCompleteCallback=t,this._onCompleteContext=e,this},e.prototype.update=function(t){if(t<this._startTime)return!0;this._onStartCallbackFired===!1&&(null!==this._onStartCallback&&this._onStartCallback.call(this._onStartContext,this._object),this._onStartCallbackFired=!0);var e=(t-this._startTime)/this._duration;e=e>1?1:e;var i=this._easingFunction(e);for(var n in this._valuesStart){var o=this._valuesStart[n],r=this._valuesEnd[n];r instanceof Array?this._object[n]=this._interpolationFunction(r,i):"function"==typeof this._object[n]?this._object[n](o+(r-o)*i):this._object[n]=o+(r-o)*i}if(null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateContext,this._object,i),1==e){this.isRunning=!1,null!==this._onCompleteCallback&&0==this._onCompleteCalled&&(this._onCompleteCalled=!0,this._onCompleteCallback.call(this._onCompleteContext,this._object));for(var s=0;s<this._chainedTweens.length;s++)this._chainedTweens[s].start();return!1}return!0},e}();e.Tween=i}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this.numDrawCalls=0,this._game=t}return e.prototype.boot=function(){},e.prototype.objType=function(){return"CanvasRenderer"},e.prototype._recurse=function(e){if(e.visible)if(e.childType()===t.GROUP)for(var i=0;i<e.members.length;i++)this._recurse(e.members[i]);else this.numDrawCalls++,e.render(this._currentCamera)},e.prototype.requestRendererInstance=function(t,e){return"undefined"==typeof e&&(e=null),null},e.prototype.requestSharedRenderer=function(t,e){return"undefined"==typeof e&&(e=null),null},e.prototype.initState=function(){},e.prototype.endState=function(){},e.prototype.render=function(t){var e=this._game.states.current.members;if(this._game.stage.ctx.fillStyle="#"+this._game.stage.color,this._game.stage.ctx.fillRect(0,0,this._game.stage.canvas.width,this._game.stage.canvas.height),0==e.length)return void console.log("nothing to render");this.numDrawCalls=0,this._currentCamera=t;var i=t.transform.getConcatenatedMatrix(),n=t.transform;this._game.stage.ctx.save(),this._game.stage.ctx.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this._game.stage.ctx.transform(1,0,0,1,-n.rotPointX,-n.rotPointY);for(var o=0;o<e.length;o++)this._recurse(e[o]);this._game.stage.ctx.restore()},e}();e.CanvasRenderer=i}(t.Renderers||(t.Renderers={})),t.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function i(t){if(this._currentRenderer=null,this._entityCount=0,this.numDrawCalls=0,this._maxItems=1e3,this._currentTextureAtlas=null,this._sharedRenderers={},this._game=t,"undefined"==typeof mat4)throw"ERROR: gl-matrix.js is missing"}return i.prototype.boot=function(){this._textureManager=new e.GLTextureManager,this._shaderManager=new t.Shaders.ShaderManager,this._init()},i.prototype.objType=function(){return"GLRenderManager"},i.prototype.addTexture=function(t,e){this._textureManager.uploadTexture(t,e)},i.prototype.addSharedRenderer=function(e,i){return"undefined"==typeof i&&(i=null),!t.Renderers[e]||e in this._sharedRenderers?!1:(this._sharedRenderers[e]=new t.Renderers[e](this._game.stage.gl,this._shaderManager,i),!0)},i.prototype.requestSharedRenderer=function(t,e){"undefined"==typeof e&&(e=null);var i=this._sharedRenderers[t];return i?i:this.addSharedRenderer(t,e)?this._sharedRenderers[t]:(console.log("no renderer called "+t),null)},i.prototype.requestRendererInstance=function(e,i){if("undefined"==typeof i&&(i=null),e in t.Renderers){var n=new t.Renderers[e](this._game.stage.gl,this._shaderManager,i);return n}return console.log("No renderer with id "+e+" exists"),null},i.prototype._init=function(){console.log("Intialising WebGL");var t=this._game.stage.gl;this._stageResolution=new Float32Array([this._game.stage.width,this._game.stage.height]),t.viewport(0,0,this._game.stage.width,this._game.stage.height),t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE),this._shaderManager.init(t,"TextureAtlasShader"),this.camMatrix=mat3.create(),this._game.stage.onResize.add(function(e,i){this._stageResolution=new Float32Array([e,i]),this.currentRenderer&&this._currentRenderer.updateStageResolution(t,this._stageResolution),t.viewport(0,0,e,i)},this)},i.prototype.initState=function(t){this._textureManager.uploadTextureLibrary(this._game.stage.gl,t.textureLibrary)},i.prototype.endState=function(){this._textureManager.clearTextures(this._game.stage.gl),console.log("ending WebGL on State")},i.prototype.render=function(t){var e=this._game.stage.gl,i=this._game.stage.normalizedColor;if(e.clearColor(i.r,i.g,i.b,i.a),e.clear(e.COLOR_BUFFER_BIT),0==this._game.states.current.members.length)return void console.log("nothing to render");this.numDrawCalls=0,this._textureManager.numTextureWrites=0,this._entityCount=0;var n=t.transform.getConcatenatedMatrix(),o=t.transform,r=vec2.create(),s=vec2.create(),a=vec2.create();vec2.set(s,o.scaleX,o.scaleY),vec2.set(r,-o.rotPointX,-o.rotPointY),vec2.set(a,n.tx,n.ty),mat3.identity(this.camMatrix),mat3.translate(this.camMatrix,this.camMatrix,a),mat3.rotate(this.camMatrix,this.camMatrix,o.rotation),mat3.scale(this.camMatrix,this.camMatrix,s),mat3.translate(this.camMatrix,this.camMatrix,r),this.collateRenderSequence(),this.collateBatches(),this.renderBatches(e,t)},i.prototype.collateRenderSequence=function(){this._sequence=[];var t=this._game.states.current;this.collateChild(t)},i.prototype.collateChild=function(e){if(e.visible)if(e.childType()===t.GROUP)for(var i=0;i<e.members.length;i++)this.collateChild(e.members[i]);else{var n=e;this._sequence.push({entity:n,renderer:n.glRenderer,shader:n.glRenderer.shaderPair,isBatchRenderer:n.glRenderer.isBatchRenderer,texture:n.atlas})}},i.prototype.collateBatches=function(){var t=null,e=null,i=null;this._batches=[];for(var n,o=0;o<this._sequence.length;o++){if(!this._sequence[o].isBatchRenderer||this._sequence[o].renderer!==t||this._sequence[o].shader!==e||this._sequence[o].texture!==i){var n=this._batches.push(new Array)-1;t=this._sequence[o].renderer,e=this._sequence[o].shader,i=this._sequence[o].texture}this._batches[n].push(this._sequence[o])}},i.prototype.renderBatches=function(t,e){for(var i=0;i<this._batches.length;i++){var n=this._batches[i];n[0].isBatchRenderer?this.renderBatch(t,n,e):this.renderEntity(t,n[0].entity,e)}},i.prototype.renderBatch=function(t,e,i){this.setupGLState(t,e[0].entity),this._currentRenderer.clear(t,{camMatrix:this.camMatrix});for(var n=0;n<e.length;n++)e[n].entity.renderGL(t,i);e[0].texture.dirty&&e[0].texture.refreshTextureGL(t),this._currentRenderer.draw(t)},i.prototype.renderEntity=function(t,e,i){this.setupGLState(t,e),this._currentRenderer.clear(t,{camMatrix:this.camMatrix}),e.renderGL(t,i),e.atlas.dirty&&e.atlas.refreshTextureGL(t),this._currentRenderer.draw(t)},i.prototype.setupGLState=function(t,e){e.atlas!==this._currentTextureAtlas&&this._switchTexture(t,e),e.glRenderer!==this._currentRenderer&&this._switchRenderer(t,e)},i.prototype._switchRenderer=function(t,e){this._currentRenderer&&this._currentRenderer.disable(t),this._currentRenderer=e.glRenderer,this._currentRenderer.enable(t,{camMatrix:this.camMatrix,stageResolution:this._stageResolution,textureAtlas:this._currentTextureAtlas})},i.prototype._switchTexture=function(t,e){this._currentTextureAtlas=e.atlas,this._currentRenderer&&this._currentRenderer.updateTextureSize(t,new Float32Array([this._currentTextureAtlas.glTextureWrapper.image.width,this._currentTextureAtlas.glTextureWrapper.image.height])),this._textureManager.useTexture(t,e.atlas.glTextureWrapper)},i}();e.GLRenderManager=i}(t.Renderers||(t.Renderers={})),t.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(){this._shaderPairs={}}return Object.defineProperty(e.prototype,"currentShader",{get:function(){return this._currentShader},enumerable:!0,configurable:!0}),e.prototype.init=function(t,e){this._currentShader=this.requestShader(t,e)},e.prototype.requestShader=function(t,e,i){"undefined"==typeof i&&(i=!0);var n;return e in this._shaderPairs?(n=this._shaderPairs[e],n.loaded||this._loadShader(t,n),i&&this._useShader(t,n),n):this.shaderExists?(n=this._addShader(t,e),this._loadShader(t,n),i&&this._useShader(t,n),n):(console.log("Shader "+e+" does not exist"),null)},e.prototype.shaderExists=function(e,i){return i in t.Shaders},e.prototype._addShader=function(e,i){return this._shaderPairs[i]=new t.Shaders[i],this._shaderPairs[i]},e.prototype._loadShader=function(t,e){e.init(t)},e.prototype._useShader=function(t,e){e!==this._currentShader&&(this._currentShader=e),t.useProgram(e.shaderProgram)},e}();e.ShaderManager=i}(t.Shaders||(t.Shaders={})),t.Shaders}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t,e,i){"undefined"==typeof i&&(i=!1),this._created=!1,this._uploaded=!1,this.textureAtlas=e,this.image=e.image,this._numBytes=this.image.width*this.image.height*4,this.createTexture(t),i&&this.uploadTexture(t)}return Object.defineProperty(t.prototype,"numBytes",{get:function(){return this._numBytes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"created",{get:function(){return this._created},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uploaded",{get:function(){return this._uploaded},enumerable:!0,configurable:!0}),t.prototype.createTexture=function(t){return this.texture=t.createTexture(),this._created=!0,!0},t.prototype.uploadTexture=function(t){var e=!1;return this.created||this.createTexture(t),this.uploaded?console.log("...not uploading:the image is already uploaded"):(t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.image),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),this._uploaded=!0,e=!0),e},t.prototype.refreshTexture=function(t){t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.image)},t.prototype.deleteTexture=function(t){return t.bindTexture(t.TEXTURE_2D,this.texture),t.deleteTexture(this.texture),this._uploaded=!1,this._created=!1,!0},t}();t.GLTextureWrapper=e}(t.Renderers||(t.Renderers={})),t.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function e(){this.numTextureWrites=0,this._numTexturesUsed=0,this._usedTextureMem=0,this.maxTextureMem=1024*e.DEFAULT_MAX_TEX_MEM_MB*1024,this._textureWrapperCache=new Array}return Object.defineProperty(e.prototype,"usedTextureMem",{get:function(){return this._usedTextureMem},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTexturesUsed",{get:function(){return this._numTexturesUsed},enumerable:!0,configurable:!0}),e.prototype._addTextureToCache=function(t){this._textureWrapperCache.push(t)},e.prototype._deleteTexture=function(t,e){this._textureWrapperCache[e].deleteTexture(t),this._usedTextureMem-=this._textureWrapperCache[e].numBytes,this._numTexturesUsed--},e.prototype._uploadTexture=function(t,e){return e.numBytes+this._usedTextureMem<=this.maxTextureMem?(e.uploadTexture(t),this._usedTextureMem+=e.numBytes,this._numTexturesUsed++,!0):!1},e.prototype.uploadTextureLibrary=function(t,e){this._textureWrapperCache=new Array;for(var i in e.textures)this.uploadTexture(t,e.textures[i])},e.prototype.uploadTexture=function(e,i){var n=new t.GLTextureWrapper(e,i);this._addTextureToCache(n),i.glTextureWrapper=n,this._uploadTexture(e,n)||console.log("...skipped uploading texture due to allocated texture memory exceeded")},e.prototype.clearTextures=function(t){for(var e=0;e<this._textureWrapperCache.length;e++)this._textureWrapperCache[e].deleteTexture(t),this._textureWrapperCache[e].textureAtlas.glTextureWrapper=null;this._textureWrapperCache=new Array},e.prototype.useTexture=function(t,e){return e.created&&e.uploaded||(this._uploadTexture(t,e)||(this._freeSpace(t,e.numBytes),this._uploadTexture(t,e)),this.numTextureWrites++),e.created&&e.uploaded?(t.bindTexture(t.TEXTURE_2D,e.texture),!0):!1},e.prototype._freeSpace=function(t,e){for(var i=99999999999,n=-1,o=0;o<this._textureWrapperCache.length;o++){var r=this._textureWrapperCache[o].numBytes;if(r===e&&this._textureWrapperCache[o].uploaded)return this._deleteTexture(t,o),!0;r>e&&i>r&&(i=r,n=o)}return!0},e.DEFAULT_MAX_TEX_MEM_MB=1024,e}();t.GLTextureManager=e}(t.Renderers||(t.Renderers={})),t.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(e,i,n,o){"undefined"==typeof o&&(o=!0),this._created=!1,this._uploaded=!1,this.items=n||t.squareVertices,this.itemSize=i||2,this.numItems=this.items.length/this.itemSize,this.createBuffer(e),o&&this.uploadBuffer(e,this.items)}return Object.defineProperty(t.prototype,"created",{get:function(){return this._created},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uploaded",{get:function(){return this._uploaded},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.items=new Array},t.prototype.createBuffer=function(t){return this.buffer=t.createBuffer(),this._created=!0,!0},t.prototype.uploadBuffer=function(t,e){this.items=e,this.numItems=this.items.length/this.itemSize;var i=new Float32Array(this.items);return t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW),this._uploaded=!0,!0},t.prototype.deleteBuffer=function(t){return t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.deleteBuffer(this.buffer),this.uploaded=!1,this.created=!1,!0},t.squareVertices=[0,0,100,0,100,100,0,100],t.squareUVs=[0,0,.1,0,.1,.1,0,.1],t.squareCols=[1,1,1,1],t}();t.GLArrayBuffer=e}(t.Renderers||(t.Renderers={})),t.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(e,i,n,o){"undefined"==typeof o&&(o=!0),this.indices=n||t.square,this.itemSize=i||1,this.numItems=this.indices.length/this.itemSize,o&&(this.buffer=this.init(e))}return t.prototype.clear=function(){this.indices=new Array},t.prototype.init=function(t){var e=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),e},t.prototype.refresh=function(t){return this.numItems=this.indices.length/this.itemSize,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.buffer},t.square=[0,1,2,0,2,3],t}();t.GLElementArrayBuffer=e}(t.Renderers||(t.Renderers={})),t.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t,e,i){"undefined"==typeof i&&(i=!1),this.loaded=!1,this._isBatchRenderer=!1,this.shaderManager=e,this._isBatchRenderer=i,this.loaded=!0}return t.prototype.enable=function(t,e){"undefined"==typeof e&&(e=null)},t.prototype.disable=function(){},t.prototype.clear=function(){},t.prototype.draw=function(){},t.prototype.updateStageResolution=function(){},t.prototype.updateTextureSize=function(){},Object.defineProperty(t.prototype,"isBatchRenderer",{get:function(){return this._isBatchRenderer},enumerable:!0,configurable:!0}),t.RENDERER_ID="Renderer",t}();t.Renderer=e}(t.Renderers||(t.Renderers={})),t.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(i){function n(t,n,o){"undefined"==typeof o&&(o=null),i.call(this,t,n,!0),this._maxItems=1e3;var r=5;this._vertexBuffer=new e.GLArrayBuffer(t,r);var s=6;this._indexBuffer=new e.GLElementArrayBuffer(t,1,this._generateIndices(this._maxItems*s)),this.shaderPair=this.shaderManager.requestShader(t,"TextureAtlasShader")}return __extends(n,i),n.prototype.enable=function(t,e){"undefined"==typeof e&&(e=null),this.shaderPair=this.shaderManager.requestShader(t,"TextureAtlasShader"),t.uniform1i(this.shaderPair.uniforms.uSampler.location,0),t.uniform2fv(this.shaderPair.uniforms.uResolution.location,e.stageResolution),t.uniformMatrix3fv(this.shaderPair.uniforms.uCamMatrix.location,!1,e.camMatrix),this.updateTextureSize(t,new Float32Array([e.textureAtlas.glTextureWrapper.image.width,e.textureAtlas.glTextureWrapper.image.height]))},n.prototype.disable=function(t){t.disableVertexAttribArray(this.shaderPair.attributes.aXYUV),t.disableVertexAttribArray(this.shaderPair.attributes.aAlpha)},n.prototype.clear=function(t,e){this._vertexBuffer.clear(),t.uniformMatrix3fv(this.shaderPair.uniforms.uCamMatrix.location,!1,e.camMatrix)},n.prototype.draw=function(t){this._vertexBuffer.uploadBuffer(t,this._vertexBuffer.items),t.enableVertexAttribArray(this.shaderPair.attributes.aXYUV),t.vertexAttribPointer(this.shaderPair.attributes.aXYUV,4,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this.shaderPair.attributes.aAlpha),t.vertexAttribPointer(this.shaderPair.attributes.aAlpha,1,t.FLOAT,!1,20,16),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer.buffer),t.drawElements(t.TRIANGLES,this._vertexBuffer.items.length/20*6,t.UNSIGNED_SHORT,0)},n.prototype._generateIndices=function(t){for(var e=new Array,i=0;t>i;i++)e.push(4*i+0,4*i+1,4*i+2,4*i+0,4*i+2,4*i+3);return e},n.prototype.updateStageResolution=function(t,e){t.uniform2fv(this.shaderPair.uniforms.uResolution.location,e)},n.prototype.updateTextureSize=function(t,e){t.uniform2fv(this.shaderPair.uniforms.uTextureSize.location,e)},n.prototype.addToBatch=function(e,i){if(!(i.alpha<=0)){var n=i.transform,o=n.getConcatenatedMatrix(),r=i.atlas.cells[i.cellIndex],s=new t.Geom.Point(0-n.rotPointX,0-n.rotPointY),a=new t.Geom.Point(r.w-n.rotPointX,0-n.rotPointY),h=new t.Geom.Point(r.w-n.rotPointX,r.h-n.rotPointY),u=new t.Geom.Point(0-n.rotPointX,r.h-n.rotPointY);s=o.transformPoint(s),a=o.transformPoint(a),h=o.transformPoint(h),u=o.transformPoint(u),this._vertexBuffer.items.push(s.x,s.y,r.x,r.y,i.alpha,a.x,a.y,r.x+r.w,r.y,i.alpha,h.x,h.y,r.x+r.w,r.y+r.h,i.alpha,u.x,u.y,r.x,r.y+r.h,i.alpha)}},n.prototype.concatBatch=function(t){this._vertexBuffer.items=this._vertexBuffer.items.concat(t)},n.RENDERER_ID="TextureAtlasRenderer",n}(e.Renderer);e.TextureAtlasRenderer=i}(t.Renderers||(t.Renderers={})),t.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(){this.loaded=!1}return t.prototype.init=function(t){this.vertShader=this.compile(t,this.vertSource.join("\n"),t.VERTEX_SHADER),this.fragShader=this.compile(t,this.fragSource.join("\n"),t.FRAGMENT_SHADER),this.shaderProgram=this.attach(t,this.vertShader,this.fragShader),this.loaded=!0},t.prototype.attach=function(t,e,i){var n=t.createProgram();return t.attachShader(n,i),t.attachShader(n,e),t.linkProgram(n),n},t.prototype.compile=function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:null},t.prototype.setParam=function(t,e){this.uniforms[t].value=e,this.uniforms[t].dirty=!0},t.prototype.applyUniforms=function(t){for(var e in this.uniforms)this.applyUniform(t,e)},t.prototype.applyUniform=function(t,e){var i=this.uniforms[e];this.uniforms[e].dirty&&(console.log(e),t["uniform"+i.type](i.location,i.value),this.uniforms[e].dirty=!1)},t.prototype.initUniforms=function(t){for(var e in this.uniforms){var i=this.uniforms[e];i.location=t.getUniformLocation(this.shaderProgram,e),i.dirty=!0,i.value=null}},t.RENDERER_ID="ShaderPair",t}();t.ShaderPair=e}(t.Shaders||(t.Shaders={})),t.Shaders}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(t){function e(){t.call(this),this.attributes={aXYUV:null,aAlpha:null},this.uniforms={uCamMatrix:{type:"mat3"},uResolution:{type:"2fv"},uTextureSize:{type:"2fv"},uSampler:{type:"1i"}},this.fragSource=["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor.a *= vAlpha;","}"],this.vertSource=["attribute vec4 aXYUV;","attribute float aAlpha;","uniform mat3 uCamMatrix;","uniform vec2 uResolution;","uniform vec2 uTextureSize;","varying vec2 vTextureCoord;","varying float vAlpha;","void main(void) {","   vec2 pos = (uCamMatrix * vec3(aXYUV.xy,1)).xy; ","   gl_Position = vec4((pos / uResolution * 2.0 - 1.0) * vec2(1, -1), 0, 1);","   vTextureCoord = aXYUV.zw / uTextureSize;","   vAlpha = aAlpha;","}"]}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e),this.attributes.aXYUV=e.getAttribLocation(this.shaderProgram,"aXYUV"),this.attributes.aAlpha=e.getAttribLocation(this.shaderProgram,"aAlpha"),this.initUniforms(e)},e}(t.ShaderPair);t.TextureAtlasShader=e}(t.Shaders||(t.Shaders={})),t.Shaders}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t,e,i,n){this._frameIndex=0,this._startTime=null,this._reverse=!1,this._isPlaying=!1,this._onStop=null,this._onPlay=null,this._onUpdate=null,this._onLoop=null,this.name=t,this._sequence=e,this._speed=e.speed,this._loop=e.loop,this._clock=i,this._parent=n}return e.prototype.objType=function(){return"Animation"},Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameIndex",{get:function(){return this._frameIndex},set:function(t){this._validateFrame(t)&&(this._frameIndex=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentCell",{get:function(){return this._sequence.cells[this.frameIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reverse",{get:function(){return this._reverse},set:function(t){this._reverse=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onStop",{get:function(){return null==this._onStop&&(this._onStop=new t.Signal),this._onStop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onPlay",{get:function(){return null==this._onPlay&&(this._onPlay=new t.Signal),this._onPlay},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onUpdate",{get:function(){return null==this._onUpdate&&(this._onUpdate=new t.Signal),this._onUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onLoop",{get:function(){return null==this._onLoop&&(this._onLoop=new t.Signal),this._onLoop},enumerable:!0,configurable:!0}),e.prototype._start=function(t){"undefined"==typeof t&&(t=null),null!==t&&(this.frameIndex=t),this._isPlaying=!0,this._startTime=this._clock.elapsed(),this._tick=this._startTime+this._speed,null!==this._onPlay&&this._onPlay.dispatch()},e.prototype.play=function(){this._frameIndex===this.length-1&&(this.frameIndex=0),this.playAt(this._frameIndex)},e.prototype.playAt=function(t){this._start(t)},e.prototype.pause=function(){this.stop()},e.prototype.resume=function(){null!==this._startTime&&(this._isPlaying=!0)},e.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,null!==this._onStop&&this._onStop.dispatch())},e.prototype.nextFrame=function(){this._frameIndex++,this._frameIndex>=this.length&&(this.frameIndex=0)},e.prototype.prevFrame=function(){this._frameIndex--,this._frameIndex<0&&(this.frameIndex=this.length-1)},e.prototype.update=function(){this._isPlaying&&this._clock.elapsed()>=this._tick&&(this._tick=this._clock.elapsed()+this._speed,this._validateFrame(this._frameIndex+(1==this._reverse?-1:1))?(this._frameIndex+=1==this._reverse?-1:1,this._parent.updateCellIndex(),null!==this._onUpdate&&this._onUpdate.dispatch()):this._loop?(this._frameIndex=this._reverse?this.length-1:0,this._parent.updateCellIndex(),null!==this._onLoop&&this._onLoop.dispatch()):this._parent.stop())},e.prototype._validateFrame=function(t){return t<this.length&&t>=0},Object.defineProperty(e.prototype,"length",{get:function(){return this._sequence.cells.length},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._isPlaying=!1,delete this._clock,delete this._sequence,delete this._parent,this._onLoop&&this._onLoop.dispose(),this._onStop&&this._onStop.dispose(),this._onPlay&&this._onPlay.dispose(),this._onUpdate&&this._onUpdate.dispose(),delete this._onLoop,delete this._onStop,delete this._onPlay,delete this._onUpdate,delete this.frameIndex,delete this.loop,delete this._reverse,delete this._tick},e}();e.Animation=i}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t,e,i,n){"undefined"==typeof i&&(i=.1),"undefined"==typeof n&&(n=!0),this.name=t,this.cells=e,this.speed=i,this.loop=n
}return t}();t.Sequence=e}(t.Animations||(t.Animations={})),t.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t,e,i){this.preventDefault=!1,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.timeUp=0,this.repeats=0,this._manager=t,this.game=this._manager.game,this.keyCode=e,i&&this.update(i)}return t.prototype.objType=function(){return"Key"},Object.defineProperty(t.prototype,"duration",{get:function(){return this.isDown&&(this.timeDown=this.game.time.now()),this.timeDown<this.timeUp?0:this.timeDown-this.timeUp},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this.keyCode=t.keyCode,this.preventDefault&&t.preventDefault(),"keydown"===t.type?(this.altKey=t.altKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.isDown===!0?(this.repeats++,this.timeDown=this.game.time.now()):(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now(),this.repeats=0)):"keyup"===t.type&&(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now())},t.prototype.justPressed=function(t){return"undefined"==typeof t&&(t=this._manager.justPressedRate),this.isDown===!0&&this.timeDown+t>this.game.time.now()?!0:!1},t.prototype.justReleased=function(t){return"undefined"==typeof t&&(t=this._manager.justReleasedRate),this.isUp===!0&&this.timeUp+t>this.game.time.now()?!0:!1},t.prototype.reset=function(){this.isDown=!1,this.isUp=!0,this.timeUp=0,this.timeDown=0,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1},t}();t.Key=e}(t.Input||(t.Input={})),t.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this._keys=[],this.justPressedRate=200,this.justReleasedRate=200,this.game=t}return e.prototype.objType=function(){return"Keyboard"},Object.defineProperty(e.prototype,"keys",{get:function(){return this._keys},enumerable:!0,configurable:!0}),e.prototype.boot=function(){this.onKeyUp=new t.Signal,this.onKeyDown=new t.Signal,this.onKeyDownOnce=new t.Signal,this.start()},e.prototype.update=function(){},e.prototype.start=function(){var e=this;this.game.deviceTargetOption===t.TARGET_BROWSER&&(document.body.addEventListener("keydown",function(t){return e._keyPressed(t)},!1),document.body.addEventListener("keyup",function(t){return e._keyReleased(t)},!1))},e.prototype.stop=function(){var e=this;this.game.deviceTargetOption===t.TARGET_BROWSER&&(document.body.removeEventListener("keydown",function(t){return e._keyPressed(t)},!1),document.body.removeEventListener("keyup",function(t){return e._keyReleased(t)},!1))},e.prototype._keyPressed=function(e){this._keys[e.keyCode]?this._keys[e.keyCode].update(e):this._keys[e.keyCode]=new t.Input.Key(this,e.keyCode,e),0==this._keys[e.keyCode].repeats&&this.onKeyDownOnce.dispatch(e.keyCode,this._keys[e.keyCode]),this.onKeyDown.dispatch(e.keyCode,this._keys[e.keyCode])},e.prototype._keyReleased=function(e){this._keys[e.keyCode]?this._keys[e.keyCode].update(e):this._keys[e.keyCode]=new t.Input.Key(this,e.keyCode,e),this.onKeyUp.dispatch(e.keyCode,this._keys[e.keyCode])},e.prototype.addKey=function(e,i){"undefined"==typeof i&&(i=!1);var n=new t.Input.Key(this,e);return n.preventDefault=i,this._keys[e]=n},e.prototype.justPressed=function(t,e){return"undefined"==typeof e&&(e=this.justPressedRate),this._keys[t]?this._keys[t].justPressed(e):!1},e.prototype.justReleased=function(t,e){return"undefined"==typeof e&&(e=this.justReleasedRate),this._keys[t]?this._keys[t].justReleased(e):!1},e.prototype.isDown=function(t){return this._keys[t]?this._keys[t].isDown:!1},e.prototype.isUp=function(t){return this._keys[t]?this._keys[t].isUp:!1},e.prototype.reset=function(){for(var t in this._keys)this._keys[t].reset()},e}();e.Keyboard=i}(t.Input||(t.Input={})),t.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(){}return t.prototype.objType=function(){return"Keycodes"},t.A="A".charCodeAt(0),t.B="B".charCodeAt(0),t.C="C".charCodeAt(0),t.D="D".charCodeAt(0),t.E="E".charCodeAt(0),t.F="F".charCodeAt(0),t.G="G".charCodeAt(0),t.H="H".charCodeAt(0),t.I="I".charCodeAt(0),t.J="J".charCodeAt(0),t.K="K".charCodeAt(0),t.L="L".charCodeAt(0),t.M="M".charCodeAt(0),t.N="N".charCodeAt(0),t.O="O".charCodeAt(0),t.P="P".charCodeAt(0),t.Q="Q".charCodeAt(0),t.R="R".charCodeAt(0),t.S="S".charCodeAt(0),t.T="T".charCodeAt(0),t.U="U".charCodeAt(0),t.V="V".charCodeAt(0),t.W="W".charCodeAt(0),t.X="X".charCodeAt(0),t.Y="Y".charCodeAt(0),t.Z="Z".charCodeAt(0),t.ZERO="0".charCodeAt(0),t.ONE="1".charCodeAt(0),t.TWO="2".charCodeAt(0),t.THREE="3".charCodeAt(0),t.FOUR="4".charCodeAt(0),t.FIVE="5".charCodeAt(0),t.SIX="6".charCodeAt(0),t.SEVEN="7".charCodeAt(0),t.EIGHT="8".charCodeAt(0),t.NINE="9".charCodeAt(0),t.NUMPAD_0=96,t.NUMPAD_1=97,t.NUMPAD_2=98,t.NUMPAD_3=99,t.NUMPAD_4=100,t.NUMPAD_5=101,t.NUMPAD_6=102,t.NUMPAD_7=103,t.NUMPAD_8=104,t.NUMPAD_9=105,t.NUMPAD_MULTIPLY=106,t.NUMPAD_ADD=107,t.NUMPAD_ENTER=108,t.NUMPAD_SUBTRACT=109,t.NUMPAD_DECIMAL=110,t.NUMPAD_DIVIDE=111,t.F1=112,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.F10=121,t.F11=122,t.F12=123,t.F13=124,t.F14=125,t.F15=126,t.COLON=186,t.EQUALS=187,t.UNDERSCORE=189,t.QUESTION_MARK=191,t.TILDE=192,t.OPEN_BRACKET=219,t.BACKWARD_SLASH=220,t.CLOSED_BRACKET=221,t.QUOTES=222,t.BACKSPACE=8,t.TAB=9,t.CLEAR=12,t.ENTER=13,t.SHIFT=16,t.CONTROL=17,t.ALT=18,t.CAPS_LOCK=20,t.ESC=27,t.SPACEBAR=32,t.PAGE_UP=33,t.PAGE_DOWN=34,t.END=35,t.HOME=36,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.INSERT=45,t.DELETE=46,t.HELP=47,t.NUM_LOCK=144,t}();t.Keycodes=e}(t.Input||(t.Input={})),t.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this.game=t}return e.prototype.objType=function(){return"InputManager"},Object.defineProperty(e.prototype,"pointers",{get:function(){return this._pointers},enumerable:!0,configurable:!0}),e.prototype.boot=function(){this._pointers=[],this.mouse=new t.Input.Mouse(this.game),this.mouse.boot(),this.mouse.onDown.add(this._onDownEvent,this),this.mouse.onUp.add(this._onUpEvent,this),this.keyboard=new t.Input.Keyboard(this.game),this.keyboard.boot(),this.touch=new t.Input.Touch(this.game),this.touch.boot(),this.touch.touchDown.add(this._onDownEvent,this),this.touch.touchUp.add(this._onUpEvent,this),this._pointers=this.touch.fingers,this._pointers.push(this.mouse.cursor),this.isDown=!1,this.position=new t.Geom.Point,this.onDown=new t.Signal,this.onUp=new t.Signal},e.prototype._onDownEvent=function(t,e,i,n,o,r){this.onDown.dispatch(t,e,i,n,o,r)},e.prototype._onUpEvent=function(t,e,i,n,o,r){this.onUp.dispatch(t,e,i,n,o,r)},Object.defineProperty(e.prototype,"onPressed",{get:function(){return this.onDown},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onReleased",{get:function(){return this.onUp},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.mouse.update(),this.keyboard.update(),this.touch.update(),this.touch.touchEnabled?this.position.setTo(this.touch.x,this.touch.y):this.position.setTo(this.mouse.x,this.mouse.y),this.isDown=this.mouse.isDown||this.touch.isDown},e.prototype.reset=function(){this.mouse.reset(),this.keyboard.reset(),this.touch.reset()},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},enumerable:!0,configurable:!0}),e}();e.InputManager=i}(t.Input||(t.Input={})),t.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this._domElement=null,this._game=t}return e.prototype.objType=function(){return"Mouse"},Object.defineProperty(e.prototype,"cursor",{get:function(){return this._cursor},enumerable:!0,configurable:!0}),e.prototype.boot=function(){this._domElement=this._game.stage.container,this._cursor=new t.Input.MouseCursor(this._game),this._cursor.active=!0,this._cursor.id=1,this.onDown=new t.Signal,this.onUp=new t.Signal,this.onWheel=new t.Signal,this.start()},Object.defineProperty(e.prototype,"isDown",{get:function(){return this._cursor.isDown},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUp",{get:function(){return this._cursor.isUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._cursor.duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._cursor.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._cursor.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wheelDeltaX",{get:function(){return this._cursor.wheelDeltaX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wheelDeltaY",{get:function(){return this._cursor.wheelDeltaY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ctrlKey",{get:function(){return this._cursor.ctrlKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shiftKey",{get:function(){return this._cursor.shiftKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altKey",{get:function(){return this._cursor.altKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"button",{get:function(){return this._cursor.button},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._cursor.update()},e.prototype.start=function(){var e=this;this._game.deviceTargetOption===t.TARGET_BROWSER?t.DEVICE.ie&&t.DEVICE.ieVersion<9?(this._domElement.attachEvent("onmousedown",function(t){return e.onMouseDown(t)}),this._domElement.attachEvent("onmousemove",function(t){return e.onMouseMove(t)}),this._domElement.attachEvent("onmouseup",function(t){return e.onMouseUp(t)}),this._domElement.attachEvent("onmousewheel",function(t){return e.onMouseWheel(t)})):(this._domElement.addEventListener("mousedown",function(t){return e.onMouseDown(t)},!0),this._domElement.addEventListener("mousemove",function(t){return e.onMouseMove(t)},!0),this._domElement.addEventListener("mouseup",function(t){return e.onMouseUp(t)},!0),this._domElement.addEventListener("mousewheel",function(t){return e.onMouseWheel(t)},!0),this._domElement.addEventListener("DOMMouseScroll",function(t){return e.onMouseWheel(t)},!0)):this._game.deviceTargetOption===t.TARGET_COCOON&&(this._game.stage.canvas.addEventListener("mousedown",function(t){return e.onMouseDown(t)},!0),this._game.stage.canvas.addEventListener("mousemove",function(t){return e.onMouseMove(t)},!0),this._game.stage.canvas.addEventListener("mouseup",function(t){return e.onMouseUp(t)},!0),this._game.stage.canvas.addEventListener("mousewheel",function(t){return e.onMouseWheel(t)},!0),this._game.stage.canvas.addEventListener("DOMMouseScroll",function(t){return e.onMouseWheel(t)},!0))},e.prototype.stop=function(){var e=this;this._game.deviceTargetOption===t.TARGET_BROWSER&&(this._domElement.removeEventListener("mousedown",function(t){return e.onMouseDown(t)},!1),this._domElement.removeEventListener("mousedown",this.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this.onMouseUp,!1),this._domElement.removeEventListener("mousewheel",this.onMouseWheel,!1),this._domElement.removeEventListener("DOMMouseScroll",this.onMouseWheel,!1))},e.prototype.onMouseDown=function(t){this._cursor.start(t),this.onDown.dispatch(this._cursor.x,this._cursor.y,this._cursor.timeDown,this._cursor.timeUp,this.duration,this._cursor)},e.prototype.onMouseMove=function(t){this._cursor.move(t)},e.prototype.onMouseUp=function(t){this._cursor.stop(t),this.onUp.dispatch(this._cursor.x,this._cursor.y,this._cursor.timeDown,this._cursor.timeUp,this.duration,this._cursor)},e.prototype.onMouseWheel=function(t){this._cursor.wheel(t),this.onWheel.dispatch(this._cursor.wheelDeltaX,this._cursor.wheelDeltaY,this._cursor)},e.prototype.justPressed=function(t){return"undefined"==typeof t&&(t=this._cursor.justPressedRate),this._cursor.justPressed(t)},e.prototype.justReleased=function(t){return"undefined"==typeof t&&(t=this._cursor.justReleasedRate),this._cursor.justReleased(t)},e.prototype.reset=function(){this._cursor.reset()},e.LEFT_BUTTON=0,e.MIDDLE_BUTTON=1,e.RIGHT_BUTTON=2,e}();e.Mouse=i}(t.Input||(t.Input={})),t.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this._domElement=null,this.isDown=!1,this.isUp=!0,this._maxPointers=10,this._game=t}return e.prototype.objType=function(){return"TouchManager"},Object.defineProperty(e.prototype,"fingers",{get:function(){return this._fingers},enumerable:!0,configurable:!0}),e.prototype.boot=function(){this._domElement=this._game.stage.container,this.finger1=new t.Input.Finger(this._game),this.finger2=new t.Input.Finger(this._game),this.finger3=new t.Input.Finger(this._game),this.finger4=new t.Input.Finger(this._game),this.finger5=new t.Input.Finger(this._game),this.finger6=new t.Input.Finger(this._game),this.finger7=new t.Input.Finger(this._game),this.finger8=new t.Input.Finger(this._game),this.finger9=new t.Input.Finger(this._game),this.finger10=new t.Input.Finger(this._game),this._fingers=[this.finger1,this.finger2,this.finger3,this.finger4,this.finger5,this.finger6,this.finger7,this.finger8,this.finger9,this.finger10],this.latestFinger=this.finger1,this.touchDown=new t.Signal,this.touchUp=new t.Signal,this.touchCancel=new t.Signal,this.start()},e.prototype.start=function(){var e=this;if(t.DEVICE.touch)if(this.touchEnabled=!0,this._game.deviceTargetOption===t.TARGET_BROWSER)if(t.DEVICE.pointerEnabled){var i="pointerup",n="pointerdown",o="pointerenter",r="pointerleave",s="pointercancel",a="pointermove";if(window.navigator.msPointerEnabled)var i="MSPointerUp",n="MSPointerDown",o="MSPointerEnter",r="MSPointerLeave",s="MSPointerCancel",a="MSPointerMove";this._domElement.addEventListener(i,function(t){return e.onPointerStart(t)},!1),this._domElement.addEventListener(n,function(t){return e.onPointerEnd(t)},!1),this._domElement.addEventListener(o,function(t){return e.onPointerEnter(t)},!1),this._domElement.addEventListener(r,function(t){return e.onPointerLeave(t)},!1),this._domElement.addEventListener(s,function(t){return e.onPointerCancel(t)},!1),this._domElement.addEventListener(a,function(t){return e.onPointerMove(t)},!1)}else this._domElement.addEventListener("touchstart",function(t){return e.onTouchStart(t)},!1),this._domElement.addEventListener("touchmove",function(t){return e.onTouchMove(t)},!1),this._domElement.addEventListener("touchend",function(t){return e.onTouchEnd(t)},!1),this._domElement.addEventListener("touchenter",function(t){return e.onTouchEnter(t)},!1),this._domElement.addEventListener("touchleave",function(t){return e.onTouchLeave(t)},!1),this._domElement.addEventListener("touchcancel",function(t){return e.onTouchCancel(t)},!1),document.addEventListener("touchmove",function(t){return e.consumeTouchMove(t)},!1);else this._game.deviceTargetOption===t.TARGET_COCOON&&(this._game.stage.canvas.addEventListener("touchstart",function(t){return e.onTouchStart(t)},!1),this._game.stage.canvas.addEventListener("touchmove",function(t){return e.onTouchMove(t)},!1),this._game.stage.canvas.addEventListener("touchend",function(t){return e.onTouchEnd(t)},!1),this._game.stage.canvas.addEventListener("touchenter",function(t){return e.onTouchEnter(t)},!1),this._game.stage.canvas.addEventListener("touchleave",function(t){return e.onTouchLeave(t)},!1),this._game.stage.canvas.addEventListener("touchcancel",function(t){return e.onTouchCancel(t)},!1));else this.touchEnabled=!1},e.prototype.consumeTouchMove=function(t){t.preventDefault()},Object.defineProperty(e.prototype,"x",{get:function(){return this.latestFinger.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.latestFinger.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumPointers",{get:function(){return this._maxPointers},set:function(t){0>t&&(t=1),t>this._fingers.length&&(t=this._fingers.length),this._maxPointers=t},enumerable:!0,configurable:!0}),e.prototype._registerFinger=function(t,e){for(var i=0;i<this._maxPointers;i++)if(this._fingers[i].active===!1){this._fingers[i].id=e,this._fingers[i].start(t),this.latestFinger=this._fingers[i],this.touchDown.dispatch(this._fingers[i].x,this._fingers[i].y,this._fingers[i].timeDown,this._fingers[i].timeUp,this._fingers[i].duration,this._fingers[i]),this.isDown=!0,this.isUp=!1;break}},e.prototype._deregisterFinger=function(t,e){for(var i=0;i<this._fingers.length;i++)if(this._fingers[i].active&&this._fingers[i].id===e){this._fingers[i].stop(t),this.latestFinger=this._fingers[i],this.touchUp.dispatch(this._fingers[i].x,this._fingers[i].y,this._fingers[i].timeDown,this._fingers[i].timeUp,this._fingers[i].duration,this._fingers[i]),this.isDown=!1,this.isUp=!0;break}for(var n=0;n<this._fingers.length;n++)this._fingers[n].active&&(this.isDown=!0,this.isUp=!1)},e.prototype._cancelFinger=function(t,e){for(var i=0;i<this._fingers.length;i++)if(this._fingers[i].active&&this._fingers[i].id===e){this._fingers[i].stop(t),this.touchCancel.dispatch(this._fingers[i].x,this._fingers[i].y,this._fingers[i].timeDown,this._fingers[i].timeUp,this._fingers[i].duration,this._fingers[i]);break}for(var n=0;n<this._fingers.length;n++)this._fingers[n].active&&(this.isDown=!0,this.isUp=!1)},e.prototype._enterFinger=function(t,e){for(var i=0;i<this._maxPointers;i++)if(this._fingers[i].active===!1){this._fingers[i].id=e,this._fingers[i].start(t),this.latestFinger=this._fingers[i],this.isDown=!0,this.isUp=!1;break}},e.prototype._leaveFinger=function(t,e){for(var i=0;i<this._fingers.length;i++)if(this._fingers[i].active&&this._fingers[i].id===e){this._fingers[i].leave(t);break}},e.prototype._moveFinger=function(t,e){for(var i=0;i<this._fingers.length;i++)if(this._fingers[i].active&&this._fingers[i].id===e){this._fingers[i].move(t),this.latestFinger=this._fingers[i];break}},e.prototype.onTouchStart=function(t){for(var e=0;e<t.changedTouches.length;e++)this._registerFinger(t.changedTouches[e],t.changedTouches[e].identifier)},e.prototype.onTouchCancel=function(t){for(var e=0;e<t.changedTouches.length;e++)this._cancelFinger(t.changedTouches[e],t.changedTouches[e].identifier)},e.prototype.onTouchEnter=function(t){for(var e=0;e<t.changedTouches.length;e++)this._enterFinger(t.changedTouches[e],t.changedTouches[e].identifier)},e.prototype.onTouchLeave=function(t){for(var e=0;e<t.changedTouches.length;e++)this._leaveFinger(t.changedTouches[e],t.changedTouches[e].identifier)},e.prototype.onTouchMove=function(t){for(var e=0;e<t.changedTouches.length;e++)this._moveFinger(t.changedTouches[e],t.changedTouches[e].identifier)},e.prototype.onTouchEnd=function(t){for(var e=0;e<t.changedTouches.length;e++)this._deregisterFinger(t.changedTouches[e],t.changedTouches[e].identifier)},e.prototype.onPointerStart=function(t){"touch"===t.type&&this._registerFinger(t,t.pointerId)},e.prototype.onPointerCancel=function(t){"touch"===t.type&&this._cancelFinger(t,t.pointerId)},e.prototype.onPointerEnter=function(t){"touch"===t.type&&this._enterFinger(t,t.pointerId)},e.prototype.onPointerLeave=function(t){"touch"===t.type&&this._leaveFinger(t,t.pointerId)},e.prototype.onPointerMove=function(t){"touch"===t.type&&this._moveFinger(t,t.pointerId)},e.prototype.onPointerEnd=function(t){"touch"===t.type&&this._deregisterFinger(t,t.pointerId)},e.prototype.update=function(){if(this.touchEnabled&&this.isDown)for(var t=0;t<this._fingers.length;t++)this._fingers[t].active&&this._fingers[t].update()},e.prototype.stop=function(){var e=this;this.touchEnabled&&(this._game.deviceTargetOption===t.TARGET_BROWSER?(this._domElement.removeEventListener("touchstart",function(t){return e.onTouchStart(t)},!1),this._domElement.removeEventListener("touchmove",function(t){return e.onTouchMove(t)},!1),this._domElement.removeEventListener("touchend",function(t){return e.onTouchEnd(t)},!1),this._domElement.removeEventListener("touchenter",function(t){return e.onTouchEnter(t)},!1),this._domElement.removeEventListener("touchleave",function(t){return e.onTouchLeave(t)},!1),this._domElement.removeEventListener("touchcancel",function(t){return e.onTouchCancel(t)},!1)):this._game.deviceTargetOption===t.TARGET_COCOON&&(this._game.stage.canvas.removeEventListener("touchstart",function(t){return e.onTouchStart(t)},!1),this._game.stage.canvas.removeEventListener("touchmove",function(t){return e.onTouchMove(t)},!1),this._game.stage.canvas.removeEventListener("touchend",function(t){return e.onTouchEnd(t)},!1),this._game.stage.canvas.removeEventListener("touchenter",function(t){return e.onTouchEnter(t)},!1),this._game.stage.canvas.removeEventListener("touchleave",function(t){return e.onTouchLeave(t)},!1),this._game.stage.canvas.removeEventListener("touchcancel",function(t){return e.onTouchCancel(t)},!1)))},e.prototype.reset=function(){for(var t=0;t<this._fingers.length;t++)this._fingers[t].reset()},e}();e.Touch=i}(t.Input||(t.Input={})),t.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(e){this.x=-1,this.y=-1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.isDown=!1,this.isUp=!0,this.withinGame=!1,this.active=!1,this.timeDown=0,this.timeUp=0,this.duration=0,this.frameDuration=0,this.justPressedRate=200,this.justReleasedRate=200,this._game=e,this.point=new t.Geom.Point,this.circle=new t.Geom.Circle(0,0,1),this.startPoint=new t.Geom.Point,this.endPoint=new t.Geom.Point}return e.prototype.objType=function(){return"Pointer"},Object.defineProperty(e.prototype,"game",{get:function(){return this._game},enumerable:!0,configurable:!0}),e.prototype.start=function(t){this.move(t),this.startPoint.setTo(this.x,this.y),this.frameDuration=0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now()},e.prototype.stop=function(){this.withinGame=!1,this.endPoint.setTo(this.x,this.y),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now(),this.duration=this.timeUp-this.timeDown},e.prototype.move=function(t){this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.x=(this.pageX-this.game.stage.offset.x)*this.game.stage.scaleX,this.y=(this.pageY-this.game.stage.offset.y)*this.game.stage.scaleY,this.point.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,this.duration=this.game.time.now()-this.timeDown},e.prototype.justPressed=function(t){return"undefined"==typeof t&&(t=this.justPressedRate),this.isDown===!0&&this.timeDown+t>this._game.time.now()?!0:!1},e.prototype.justReleased=function(t){return"undefined"==typeof t&&(t=this.justReleasedRate),this.isUp===!0&&this.timeUp+t>this._game.time.now()?!0:!1},e.prototype.reset=function(){this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.duration=0,this.frameDuration=0},e.prototype.update=function(){this.isDown===!0&&(this.frameDuration++,this.duration=this._game.time.now()-this.timeDown)},e}();e.Pointer=i}(t.Input||(t.Input={})),t.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(t){function e(){t.apply(this,arguments),this.wheelDeltaX=0,this.wheelDeltaY=0}return __extends(e,t),e.prototype.objType=function(){return"MouseCursor"},e.prototype.start=function(e){this.ctrlKey=e.ctrlKey,this.shiftKey=e.shiftKey,this.altKey=e.altKey,this.button-e.button,t.prototype.start.call(this,e)},e.prototype.stop=function(e){this.move(e),t.prototype.stop.call(this,e)},e.prototype.wheel=function(t){this.wheelDeltaX=t.wheelDeltaX?t.wheelDeltaX:t.deltaX,this.wheelDeltaY=t.wheelDeltaY?t.wheelDeltaY:t.deltaY},e}(t.Pointer);t.MouseCursor=e}(t.Input||(t.Input={})),t.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(t){function e(e){t.call(this,e),this.circle.diameter=44}return __extends(e,t),e.prototype.objType=function(){return"Finger"},e.prototype.start=function(e){this.active=!0,t.prototype.start.call(this,e)},e.prototype.stop=function(e){this.active=!1,t.prototype.stop.call(this,e)},e.prototype.leave=function(t){this.withinGame=!1,this.move(t)},e.prototype.reset=function(){this.active=!1,t.prototype.reset.call(this)},e}(t.Pointer);t.Finger=e}(t.Input||(t.Input={})),t.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function e(t,e,i,n){this.cx=0,this.cy=0,this.halfWidth=0,this.halfHeight=0,this.cx=t||0,this.cy=e||0,this.halfWidth=i/2||0,this.halfHeight=n/2||0}return e.prototype.objType=function(){return"AABB"},Object.defineProperty(e.prototype,"height",{get:function(){return 2*this.halfHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return 2*this.halfWidth},enumerable:!0,configurable:!0}),e.prototype.draw=function(t){return t.beginPath(),t.moveTo(this.cx-this.halfWidth,this.cy),t.lineTo(this.cx+this.halfWidth,this.cy),t.moveTo(this.cx,this.cy-this.halfHeight),t.lineTo(this.cx,this.cy+this.halfHeight),t.stroke(),this},e.prototype.setPosition=function(t,e){return this.cx=t,this.cy=e,this},e.prototype.setPositionPoint=function(t){return this.cx=t.x,this.cy=t.y,this},e.prototype.toRect=function(){return new t.Rectangle(this.cx-this.halfWidth,this.cy-this.halfHeight,2*this.halfWidth,2*this.halfHeight)},e.prototype.fromRect=function(t){return this.halfWidth=t.width/2,this.halfHeight=t.height/2,this.cx=t.x+this.halfWidth,this.cy=t.y+this.halfHeight,this},e}();t.AABB=e}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function e(t,e,i){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),this._diameter=0,this._radius=0,this.x=0,this.y=0,this.setTo(t,e,i)}return e.prototype.objType=function(){return"Circle"},Object.defineProperty(e.prototype,"diameter",{get:function(){return this._diameter},set:function(t){t>0&&(this._diameter=t,this._radius=.5*t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){t>0&&(this._radius=t,this._diameter=2*t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"circumference",{get:function(){return 2*Math.PI*this._radius},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(t){isNaN(t)||(t<this.y?(this._radius=0,this._diameter=0):this.radius=t-this.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x-this._radius},set:function(t){isNaN(t)||(t<this.x?this.radius=this.x-t:(this._radius=0,this._diameter=0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this._radius},set:function(t){t&&!isNaN(t)&&(t>this.x?this.radius=t-this.x:(this._radius=0,this._diameter=0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y-this._radius},set:function(t){t&&!isNaN(t)&&(t>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._diameter<=0?!0:!1},enumerable:!0,configurable:!0}),e.prototype.clone=function(t){return"undefined"==typeof t&&(t=new e),t.setTo(this.x,this.y,this._diameter)},e.prototype.copyFrom=function(t){return this.setTo(t.x,t.y,t.diameter)},e.prototype.copyTo=function(t){return t.copyFrom(this)},e.prototype.distanceTo=function(t,e){"undefined"==typeof e&&(e=!1);var i=this.x-t.x,n=this.y-t.y;return e===!0?Math.round(Math.sqrt(i*i+n*n)):Math.sqrt(i*i+n*n)},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.diameter===t.diameter?!0:!1},e.prototype.intersects=function(t){return this.distanceTo(t,!1)<this._radius+t._radius?!0:!1},e.prototype.circumferencePoint=function(e,i,n){return"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=new t.Point),i===!0&&(e*=Math.PI/180),n.x=this.x+this._radius*Math.cos(e),n.y=this.y+this._radius*Math.sin(e),n},e.prototype.offset=function(t,e){return isNaN(t)||isNaN(e)||(this.x+=t,this.y+=e),this},e.prototype.offsetPoint=function(t){return this.offset(t.x,t.y)},e.prototype.setTo=function(t,e,i){return this.x=t,this.y=e,this._diameter=i,this._radius=.5*i,this},e.prototype.toString=function(){return"[{Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"},e}();t.Circle=e}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t,e,i,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.setTo(t,e,i,n)}return t.prototype.objType=function(){return"Ray"},t.prototype.clone=function(e){return"undefined"==typeof e&&(e=new t),e.setTo(this.x1,this.y1,this.x2,this.y2)},t.prototype.copyFrom=function(t){return this.setTo(t.x1,t.y1,t.x2,t.y2)},t.prototype.copyTo=function(t){return t.copyFrom(this)},t.prototype.setTo=function(t,e,i,n){return"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this.x1=t,this.y1=e,this.x2=i,this.y2=n,this},Object.defineProperty(t.prototype,"angle",{get:function(){return Math.atan2(this.x2-this.x1,this.y2-this.y1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slope",{get:function(){return(this.y2-this.y1)/(this.x2-this.x1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yIntercept",{get:function(){return this.y1-this.slope*this.x1},enumerable:!0,configurable:!0}),t.prototype.isPointOnRay=function(t,e){return(t-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(e-this.y1)&&Math.atan2(e-this.y1,t-this.x1)==Math.atan2(this.y2-this.y1,this.x2-this.x1)?!0:!1},t.prototype.toString=function(){return"[{Ray (x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+")}]"},t}();t.Ray=e}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function e(){}return e.prototype.objType=function(){return"Intersect"},e.distance=function(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))},e.distanceSquared=function(t,e,i,n){return(i-t)*(i-t)+(n-e)*(n-e)},e.lineToLine=function(e,i,n){"undefined"==typeof n&&(n=new t.IntersectResult);var o=(e.x1-e.x2)*(i.y1-i.y2)-(e.y1-e.y2)*(i.x1-i.x2);return 0!==o&&(n.result=!0,n.x=((e.x1*e.y2-e.y1*e.x2)*(i.x1-i.x2)-(e.x1-e.x2)*(i.x1*i.y2-i.y1*i.x2))/o,n.y=((e.x1*e.y2-e.y1*e.x2)*(i.y1-i.y2)-(e.y1-e.y2)*(i.x1*i.y2-i.y1*i.x2))/o),n},e.lineToLineSegment=function(e,i,n){"undefined"==typeof n&&(n=new t.IntersectResult);var o=(e.x1-e.x2)*(i.y1-i.y2)-(e.y1-e.y2)*(i.x1-i.x2);if(0!==o){n.x=((e.x1*e.y2-e.y1*e.x2)*(i.x1-i.x2)-(e.x1-e.x2)*(i.x1*i.y2-i.y1*i.x2))/o,n.y=((e.x1*e.y2-e.y1*e.x2)*(i.y1-i.y2)-(e.y1-e.y2)*(i.x1*i.y2-i.y1*i.x2))/o;var r=Math.max(i.x1,i.x2),s=Math.min(i.x1,i.x2),a=Math.max(i.y1,i.y2),h=Math.min(i.y1,i.y2);(1==(n.x<=r&&n.x>=s)||1==(n.y<=a&&n.y>=h))&&(n.result=!0)}return n},e.lineToRawSegment=function(e,i,n,o,r,s){"undefined"==typeof s&&(s=new t.IntersectResult);var a=(e.x1-e.x2)*(n-r)-(e.y1-e.y2)*(i-o);if(0!==a){s.x=((e.x1*e.y2-e.y1*e.x2)*(i-o)-(e.x1-e.x2)*(i*r-n*o))/a,s.y=((e.x1*e.y2-e.y1*e.x2)*(n-r)-(e.y1-e.y2)*(i*r-n*o))/a;var h=Math.max(i,o),u=Math.min(i,o),c=Math.max(n,r),l=Math.min(n,r);(1==(s.x<=h&&s.x>=u)||1==(s.y<=c&&s.y>=l))&&(s.result=!0)}return s},e.lineToRay=function(e,i,n){"undefined"==typeof n&&(n=new t.IntersectResult);var o=(e.x1-e.x2)*(i.y1-i.y2)-(e.y1-e.y2)*(i.x1-i.x2);return 0!==o&&(n.x=((e.x1*e.y2-e.y1*e.x2)*(i.x1-i.x2)-(e.x1-e.x2)*(i.x1*i.y2-i.y1*i.x2))/o,n.y=((e.x1*e.y2-e.y1*e.x2)*(i.y1-i.y2)-(e.y1-e.y2)*(i.x1*i.y2-i.y1*i.x2))/o,n.result=!0,!(i.x1>=i.x2)&&n.x<i.x1&&(n.result=!1),!(i.y1>=i.y2)&&n.y<i.y1&&(n.result=!1)),n},e.lineToCircle=function(e,i,n){return"undefined"==typeof n&&(n=new t.IntersectResult),e.perp(i.x,i.y).length<=i.radius&&(n.result=!0),n
},e.lineToRectangle=function(i,n,o){return"undefined"==typeof o&&(o=new t.IntersectResult),e.lineToRawSegment(i,n.x,n.y,n.right,n.y,o),o.result===!0?o:(e.lineToRawSegment(i,n.x,n.y,n.x,n.bottom,o),o.result===!0?o:(e.lineToRawSegment(i,n.x,n.bottom,n.right,n.bottom,o),o.result===!0?o:(e.lineToRawSegment(i,n.right,n.y,n.right,n.bottom,o),o)))},e.lineSegmentToLineSegment=function(i,n,o){return"undefined"==typeof o&&(o=new t.IntersectResult),e.lineToLineSegment(i,n,o),o.result===!0&&(o.x>=Math.min(i.x1,i.x2)&&o.x<=Math.max(i.x1,i.x2)&&o.y>=Math.min(i.y1,i.y2)&&o.y<=Math.max(i.y1,i.y2)||(o.result=!1)),o},e.lineSegmentToRay=function(i,n,o){return"undefined"==typeof o&&(o=new t.IntersectResult),e.lineToRay(i,n,o),o.result===!0&&(o.x>=Math.min(i.x1,i.x2)&&o.x<=Math.max(i.x1,i.x2)&&o.y>=Math.min(i.y1,i.y2)&&o.y<=Math.max(i.y1,i.y2)||(o.result=!1)),o},e.lineSegmentToCircle=function(i,n,o){"undefined"==typeof o&&(o=new t.IntersectResult);var r=i.perp(n.x,n.y);if(r.length<=n.radius){var s=Math.max(i.x1,i.x2),a=Math.min(i.x1,i.x2),h=Math.max(i.y1,i.y2),u=Math.min(i.y1,i.y2);r.x2<=s&&r.x2>=a&&r.y2<=h&&r.y2>=u?o.result=!0:(e.circleContainsPoint(n,{x:i.x1,y:i.y1})||e.circleContainsPoint(n,{x:i.x2,y:i.y2}))&&(o.result=!0)}return o},e.lineSegmentToRectangle=function(i,n,o){return"undefined"==typeof o&&(o=new t.IntersectResult),n.contains(i.x1,i.y1)&&n.contains(i.x2,i.y2)?(o.result=!0,o):(e.lineToRawSegment(i,n.x,n.y,n.right,n.bottom,o),o.result===!0?o:(e.lineToRawSegment(i,n.x,n.y,n.x,n.bottom,o),o.result===!0?o:(e.lineToRawSegment(i,n.x,n.bottom,n.right,n.bottom,o),o.result===!0?o:(e.lineToRawSegment(i,n.right,n.y,n.right,n.bottom,o),o))))},e.rayToRectangle=function(i,n,o){return"undefined"==typeof o&&(o=new t.IntersectResult),e.lineToRectangle(i,n,o),o},e.rayToLineSegment=function(e,i,n,o,r,s,a,h,u){"undefined"==typeof u&&(u=new t.IntersectResult);var c,l,p;return(o-i)/(n-e)!=(h-s)/(a-r)&&(p=(n-e)*(h-s)-(o-i)*(a-r),0!=p&&(c=((i-s)*(a-r)-(e-r)*(h-s))/p,l=((i-s)*(n-e)-(e-r)*(o-i))/p,c>=0&&l>=0&&1>=l&&(u.result=!0,u.x=e+c*(n-e),i+c*(o-i)))),u},e.circleToCircle=function(i,n,o){return"undefined"==typeof o&&(o=new t.IntersectResult),o.result=(i.radius+n.radius)*(i.radius+n.radius)>=e.distanceSquared(i.x,i.y,n.x,n.y),o},e.circleToRectangle=function(e,i,n){"undefined"==typeof n&&(n=new t.IntersectResult);var o=i.clone();return o.inflate(e.radius,e.radius),n.result=o.contains(e.x,e.y),n},e.circleContainsPoint=function(i,n,o){return"undefined"==typeof o&&(o=new t.IntersectResult),o.result=i.radius*i.radius>=e.distanceSquared(i.x,i.y,n.x,n.y),o},e.pointToRectangle=function(e,i,n){return"undefined"==typeof n&&(n=new t.IntersectResult),n.setTo(e.x,e.y),n.result=i.containsPoint(e),n},e.rectangleToRectangle=function(e,i,n){"undefined"==typeof n&&(n=new t.IntersectResult);var o=Math.max(e.x,i.x),r=Math.min(e.right,i.right),s=Math.max(e.y,i.y),a=Math.min(e.bottom,i.bottom);n.setTo(o,s,r-o,a-s,r-o,a-s);var h=n.x+.5*n.width,u=n.y+.5*n.height;return h>e.x&&h<e.right&&u>e.y&&u<e.bottom&&(n.result=!0),n},e}();t.Intersect=e}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(){this.result=!1}return t.prototype.objType=function(){return"IntersectResult"},t.prototype.setTo=function(t,e,i,n,o,r){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),this.x=t,this.y=e,this.x1=t,this.y1=e,this.x2=i,this.y2=n,this.width=o,this.height=r},t}();t.IntersectResult=e}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t,e,i,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.setTo(t,e,i,n)}return e.prototype.objType=function(){return"Line"},e.prototype.clone=function(t){return"undefined"==typeof t&&(t=new e),t.setTo(this.x1,this.y1,this.x2,this.y2)},e.prototype.copyFrom=function(t){return this.setTo(t.x1,t.y1,t.x2,t.y2)},e.prototype.copyTo=function(t){return t.copyFrom(this)},e.prototype.setTo=function(t,e,i,n){return"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this.x1=t,this.y1=e,this.x2=i,this.y2=n,this},Object.defineProperty(e.prototype,"length",{get:function(){return Math.sqrt((this.x2-this.x1)*(this.x2-this.x1)+(this.y2-this.y1)*(this.y2-this.y1))},enumerable:!0,configurable:!0}),e.prototype.getY=function(t){return this.x1==this.x2?null:this.slope*t+this.yIntercept},Object.defineProperty(e.prototype,"angle",{get:function(){return Math.atan2(this.x2-this.x1,this.y2-this.y1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slope",{get:function(){return(this.y2-this.y1)/(this.x2-this.x1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perpSlope",{get:function(){return-((this.x2-this.x1)/(this.y2-this.y1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yIntercept",{get:function(){return this.y1-this.slope*this.x1},enumerable:!0,configurable:!0}),e.prototype.isPointOnLine=function(t,e){return(t-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(e-this.y1)?!0:!1},e.prototype.isPointOnLineSegment=function(t,e){var i=Math.min(this.x1,this.x2),n=Math.max(this.x1,this.x2),o=Math.min(this.y1,this.y2),r=Math.max(this.y1,this.y2);return this.isPointOnLine(t,e)&&t>=i&&n>=t&&e>=o&&r>=e?!0:!1},e.prototype.intersectLineLine=function(e){return t.Geom.Intersect.lineToLine(this,e)},e.prototype.perp=function(t,i,n){if(this.y1===this.y2){if(!n)return new e(t,i,t,this.y1);n.setTo(t,i,t,this.y1)}var o=i-this.perpSlope*t,r=this.intersectLineLine({x1:t,y1:i,x2:0,y2:o});return n?void n.setTo(t,i,r.x,r.y):new e(t,i,r.x,r.y)},e.prototype.toString=function(){return"[{Line (x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+")}]"},e}();e.Line=i}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t,e,i,n,o,r){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this.setTo(t,e,i,n,o,r)}return e.prototype.objType=function(){return"Matrix"},e.prototype.setTo=function(t,e,i,n,o,r){return"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=o,this.ty=r,this},e.prototype.setFromTransform=function(t,e,i,n,o){this.identity();var r=Math.cos(o),s=Math.sin(o);return this.append(r*i,s*i,-s*n,r*n,t,e),this},e.prototype.setFromOffsetTransform=function(t,e,i,n,o,r,s){this.identity();var a=Math.cos(o),h=Math.sin(o);return this.append(a*i,h*i,-h*n,a*n,t+r,e+s),this},e.prototype.prepend=function(t,e,i,n,o,r){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0);var s=this.tx,a=this.a,h=this.c;return this.a=a*t+this.b*i,this.b=a*e+this.b*n,this.c=h*t+this.d*i,this.d=h*e+this.d*n,this.tx=s*t+this.ty*i+o,this.ty=s*e+this.ty*n+r,this},e.prototype.prependMatrix=function(t){var e=this.tx,i=this.a,n=this.c;return this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d,this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},e.prototype.append=function(t,e,i,n,o,r){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0);var s=this.a,a=this.b,h=this.c,u=this.d;return this.a=t*s+e*h,this.b=t*a+e*u,this.c=i*s+n*h,this.d=i*a+n*u,this.tx=o*s+r*h+this.tx,this.ty=o*a+r*u+this.ty,this},e.prototype.appendMatrix=function(t){var e=this.a,i=this.b,n=this.c,o=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*o,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*o,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*o+this.ty,this},e.prototype.setPosition=function(t,e){return this.tx=t,this.ty=e,this},e.prototype.setPositionPoint=function(t){return this.tx=t.x,this.ty=t.y,this},e.prototype.getPosition=function(e){return"undefined"==typeof e&&(e=new t.Geom.Point),e.setTo(this.tx,this.ty)},e.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},e.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,o=this.c,r=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=o*e-this.d*i,this.d=o*i+this.d*e,this.tx=r*e-this.ty*i,this.ty=r*i+this.ty*e,this},e.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this},e.prototype.transformPoint=function(t){var e=t.x,i=t.y;return t.x=this.a*e+this.c*i+this.tx,t.y=this.b*e+this.d*i+this.ty,t},e.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,o=this.tx,r=t*n-e*i;return this.a=n/r,this.b=-e/r,this.c=-i/r,this.d=t/r,this.tx=(i*this.ty-n*o)/r,this.ty=-(t*this.ty-e*o)/r,this},e.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},e.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,this},e.prototype.clone=function(){return new t.Geom.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)},Object.defineProperty(e.prototype,"toString",{get:function(){return"[{Matrix (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")}]"},enumerable:!0,configurable:!0}),e}();e.Matrix=i}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this.setTo(t,e)}return t.prototype.objType=function(){return"Point"},t.prototype.polar=function(t,e){return this.x=t*Math.cos(e*Math.PI/180),this.y=t*Math.sin(e*Math.PI/180),this},t.prototype.add=function(e,i){return"undefined"==typeof i&&(i=new t),i.setTo(this.x+e.x,this.y+e.y)},t.prototype.addTo=function(t,e){return"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this.setTo(this.x+t,this.y+e)},t.prototype.subtractFrom=function(t,e){return"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this.setTo(this.x-t,this.y-e)},t.prototype.invert=function(){return this.setTo(this.y,this.x)},t.prototype.clamp=function(t,e){return this.clampX(t,e),this.clampY(t,e),this},t.prototype.clampX=function(t,e){return this.x=Math.max(Math.min(this.x,e),t),this},t.prototype.clampY=function(t,e){return this.x=Math.max(Math.min(this.x,e),t),this.y=Math.max(Math.min(this.y,e),t),this},t.prototype.clone=function(e){return"undefined"==typeof e&&(e=new t),e.setTo(this.x,this.y)},t.prototype.copyFrom=function(t){return this.setTo(t.x,t.y)},t.prototype.copyTo=function(t){return t.setTo(this.x,this.y)},t.prototype.angleTo=function(t){return Math.atan2(t.x-this.x,t.y-this.y)},t.prototype.angleToXY=function(t,e){return Math.atan2(t-this.x,e-this.y)},t.prototype.distanceTo=function(t,e){"undefined"==typeof e&&(e=!1);var i=this.x-t.x,n=this.y-t.y;return e===!0?Math.round(Math.sqrt(i*i+n*n)):Math.sqrt(i*i+n*n)},t.prototype.distanceToXY=function(t,e,i){"undefined"==typeof i&&(i=!1);var n=this.x-t,o=this.y-e;return i===!0?Math.round(Math.sqrt(n*n+o*o)):Math.sqrt(n*n+o*o)},t.distanceBetween=function(t,e,i){"undefined"==typeof i&&(i=!1);var n=t.x-e.x,o=t.y-e.y;return i===!0?Math.round(Math.sqrt(n*n+o*o)):Math.sqrt(n*n+o*o)},t.polar=function(e,i){return new t(e*Math.cos(i*Math.PI/180),e*Math.sin(i*Math.PI/180))},t.prototype.distanceCompare=function(t,e){return this.distanceTo(t)>=e?!0:!1},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y?!0:!1},t.interpolate=function(e,i,n){var o=i.x-e.x,r=i.y-e.y;return new t(i.x-o*n,i.y-r*n)},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.setTo=function(t,e){return this.x=t,this.y=e,this},t.prototype.subtract=function(e,i){return"undefined"==typeof i&&(i=new t),i.setTo(this.x-e.x,this.y-e.y)},t.prototype.getCSS=function(){return this.x+"px "+this.y+"px"},t.prototype.toString=function(){return"[{Point (x="+this.x+" y="+this.y+")}]"},t}();t.Point=e}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function i(t,e,i,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this.x=0,this.y=0,this.width=0,this.height=0,this.setTo(t,e,i,n)}return i.prototype.objType=function(){return"Rectangle"},Object.defineProperty(i.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t&&(this.height=t<this.y?0:t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){var t=new e.Point;return t.setTo(Math.round(this.width/2),Math.round(this.height/2))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottomRight",{get:function(){var t=new e.Point;return t.setTo(this.right,this.bottom)},set:function(t){t&&(this.right=t.x,this.bottom=t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this.x},set:function(t){if(t){var e=this.x-t;this.width+e<0?(this.width=0,this.x=t):(this.width+=e,this.x=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t&&(this.width=t<this.x?0:t-this.x)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){var t=new e.Point;return t.setTo(this.width,this.height)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"volume",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this.y},set:function(t){if(t){var e=this.y-t;this.height+e<0?(this.height=0,this.y=t):(this.height+=e,this.y=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"topLeft",{get:function(){var t=new e.Point;return t.setTo(this.x,this.y)},set:function(t){t&&(this.x=t.x,this.y=t.y)},enumerable:!0,configurable:!0}),i.prototype.clone=function(t){return"undefined"==typeof t&&(t=new i),t.setTo(this.x,this.y,this.width,this.height)},i.prototype.contains=function(t,e){return t>=this.x&&t<=this.right&&e>=this.y&&e<=this.bottom?!0:!1},i.prototype.containsPoint=function(t){return this.contains(t.x,t.y)},i.prototype.containsRect=function(t){return t.volume>this.volume?!1:t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom?!0:!1},i.prototype.copyFrom=function(t){return this.setTo(t.x,t.y,t.width,t.height)},i.prototype.copyTo=function(t){return t.copyFrom(this)},i.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height?!0:!1},i.prototype.inflate=function(t,e){return isNaN(t)||isNaN(e)||(this.x-=t,this.width+=2*t,this.y-=e,this.height+=2*e),this},i.prototype.inflatePoint=function(t){return this.inflate(t.x,t.y)},i.prototype.intersection=function(t,e){return"undefined"==typeof e&&(e=new i),this.intersects(t)===!0&&(e.x=Math.max(t.x,this.x),e.y=Math.max(t.y,this.y),e.width=Math.min(t.right,this.right)-e.x,e.height=Math.min(t.bottom,this.bottom)-e.y),e},i.prototype.intersects=function(t){return t.x>this.right-1?!1:t.right-1<this.x?!1:t.bottom-1<this.y?!1:t.y>this.bottom-1?!1:!0},i.prototype.overlap=function(t){var e={top:!1,bottom:!1,left:!1,right:!1,contains:!1,contained:!1},i=this.intersection(t);return i.isEmpty?e:(this.containsRect(t)&&(e.contains=!0),t.containsRect(this)&&(e.contained=!0),this.top<t.top&&(e.top=!0),this.bottom>t.bottom&&(e.bottom=!0),this.left<t.left&&(e.left=!0),this.right>t.right&&(e.right=!0),e)},i.prototype.isEmpty=function(){return this.width<1||this.height<1?!0:!1},i.prototype.offset=function(t,e){return isNaN(t)||isNaN(e)||(this.x+=t,this.y+=e),this},i.prototype.offsetPoint=function(t){return this.offset(t.x,t.y)},i.prototype.setEmpty=function(){return this.setTo(0,0,0,0)},i.prototype.setTo=function(t,e,i,n){return isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||(this.x=t,this.y=e,i>=0&&(this.width=i),n>=0&&(this.height=n)),this},i.prototype.union=function(t,e){return"undefined"==typeof e&&(e=new i),e.setTo(Math.min(t.x,this.x),Math.min(t.y,this.y),Math.max(t.right,this.right),Math.max(t.bottom,this.bottom))},i.prototype.scale=function(e,i,n){var o=new t.Geom.Transform;o.scaleX=e,o.scaleY=i,o.x=n.x,o.y=n.y;var r=this.topLeft;return o.transformPoint(r),this.topLeft=r,this.width*=e,this.height*=i,this},i.prototype.toString=function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" isEmpty="+this.isEmpty()+")}]"},i}();e.Rectangle=i}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function i(t,i,n,o,r,s,a){"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=1),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=0),this._x=0,this._y=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._rotPointX=0,this._rotPointY=0,this.setTransform(t,i,n,o,r,s,a),this._matrix=new e.Matrix,this._matrix.setFromOffsetTransform(this._x,this._y,this._scaleX,this._scaleY,this._rotation,this._rotPointX,this._rotPointY),this._cachedConcatenatedMatrix=this.getConcatenatedMatrix()}return i.prototype.objType=function(){return"Transform"},Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotPointX",{get:function(){return this._rotPointX},set:function(t){this._rotPointX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotPointY",{get:function(){return this._rotPointY},set:function(t){this._rotPointY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"matrix",{get:function(){return this._matrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"worldX",{get:function(){return this.getConcatenatedMatrix().tx-this._rotPointX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"worldY",{get:function(){return this.getConcatenatedMatrix().ty-this._rotPointY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},set:function(t){this.checkAncestor(t)||(this._parent=t)},enumerable:!0,configurable:!0}),i.prototype.setPosition=function(t,e){return this._x=t,this._y=e,this},i.prototype.setPositionFromPoint=function(t){return this._x=t.x,this._y=t.y,this},i.prototype.translatePositionFromPoint=function(t){return this._x+=t.x,this._y+=t.y,this},i.prototype.getPositionPoint=function(e){return"undefined"==typeof e&&(e=new t.Geom.Point),e.setTo(this._x,this._y)},Object.defineProperty(i.prototype,"scale",{set:function(t){this._scaleX=t,this._scaleY=t},enumerable:!0,configurable:!0}),i.prototype.setTransform=function(t,e,i,n,o,r,s){return"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),this._x=t,this._y=e,this._scaleX=i,this._scaleY=n,this._rotation=o,this._rotPointX=r,this._rotPointY=s,this},i.prototype.getParentMatrix=function(){return this._parent?this._parent.getConcatenatedMatrix():null},i.prototype.getConcatenatedMatrix=function(){this._matrix.setFromOffsetTransform(this._x,this._y,this._scaleX,this._scaleY,this._rotation,this._rotPointX,this._rotPointY);var t=this.getParentMatrix();if(t){var e=this._matrix.clone();return e.prependMatrix(t),this._cachedConcatenatedMatrix.copyFrom(e),e}return this._matrix},i.prototype.transformPoint=function(t){var e=this.getConcatenatedMatrix();return e.transformPoint(t)},i.prototype.copyFrom=function(t){return this.setTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.rotPointX,t.rotPointY),this.parent=t.parent,this._matrix=t.matrix.clone(),this},i.prototype.copyTo=function(t){return t.copyFrom(this),this},i.prototype.clone=function(t){return"undefined"==typeof t&&(t=new i),t.copyFrom(this),t},i.prototype.checkAncestor=function(){return!1},Object.defineProperty(i.prototype,"toString",{get:function(){return"[{Transform (x="+this._x+" y="+this._y+" scaleX="+this._scaleX+" scaleY="+this._scaleY+" rotation="+this._rotation+" regX="+this._rotPointX+" regY="+this.rotPointY+" matrix="+this._matrix+")}]"},enumerable:!0,configurable:!0}),i}();e.Transform=i}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function i(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this.setTo(t,e)}return i.prototype.objType=function(){return"Vector2"},i.fromAngle=function(t){return new i(Math.cos(t),Math.sin(t))},i.randomRadius=function(t){return new i(2*Math.random()-1,2*Math.random()-1).multiplyScalar(t)},i.fromPoint=function(t){return new i(t.x,t.y)},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.addX=function(t){return new i(this.x+t.x,this.y)},i.prototype.addY=function(t){return new i(this.x,this.y+t.y)},i.prototype.subtract=function(e){return new t.Geom.Vector2(this.x-e.x,this.y-e.y)},i.prototype.multiply=function(e){return new t.Geom.Vector2(this.x*e.x,this.y*e.y)},i.prototype.multiplyScalar=function(e){return new t.Geom.Vector2(this.x*e,this.y*e)},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.lenSqr=function(){return this.x*this.x+this.y*this.y},i.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.unit=function(){var t=1/this.len();return this.multiplyScalar(t)},i.prototype.floor=function(){return new i(Math.floor(this.x),Math.floor(this.y))},i.prototype.ceil=function(){return new i(Math.ceil(this.x),Math.ceil(this.y))},i.prototype.round=function(){return new i(Math.round(this.x),Math.round(this.y))},i.prototype.clamp=function(t,e){return new i(Math.max(Math.min(this.x,e.x),t.x),Math.max(Math.min(this.y,e.y),t.y))},i.prototype.perp=function(){return new i(-this.y,this.x)},i.prototype.neg=function(){return new i(-this.x,-this.y)},i.prototype.equal=function(t){return this.x===t.x&&this.y===t.y},i.prototype.point=function(){return new e.Point(this.x,this.y)},i.prototype.clear=function(){return this.x=0,this.y=0,this},i.prototype.clone=function(t){return t?t.setTo(this.x,this.y):new i(this.x,this.y)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t},i.prototype.setTo=function(t,e){return this.x=t,this.y=e,this},i.prototype.toString=function(){return"[{Vector2 (x="+this.x+" y="+this.y+")}]"},i}();e.Vector2=i}(t.Geom||(t.Geom={})),t.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(e,i){if(this._game=e,this.name=i,this._manager=this._game.huds,this._device=this._game.deviceTargetOption,this._manager.supported){switch(this._device){case t.TARGET_BROWSER:this.container=document.createElement("div"),this.container.id="HUD-layer-"+e.rnd.uuid(),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="absolute",this._widgets=new Array}this.class="kiwi-display"}}return e.prototype.objType=function(){return"HUDDisplay"},e.prototype.addWidget=function(e){return this._manager.supported&&(this._widgets.push(e),this._device==t.TARGET_BROWSER)?(this.container.appendChild(e.container),!0):!1},e.prototype.removeWidget=function(t){if(this._manager.supported&&this.removeFromContainer(t)){var e=this._widgets.indexOf(t);if(-1!==e)return this._widgets.splice(e,1),!0}return!1},e.prototype.removeAllWidgets=function(){for(var t=0;t<this._widgets.length;t++)this.removeFromContainer(this._widgets[t]);this._widgets=[]},e.prototype.removeFromContainer=function(e){return this._manager.supported&&this._device==t.TARGET_BROWSER&&this.container.contains(e.container)?(this.container.removeChild(e.container),!0):!1},e.prototype.update=function(){for(var t=0;t<this._widgets.length;t++)this._widgets[t].update()},e.prototype.show=function(){this.container.style.display="block"},e.prototype.hide=function(){this.container.style.display="none"},Object.defineProperty(e.prototype,"class",{get:function(){return this._device==t.TARGET_BROWSER?this.container.className:void 0},set:function(e){this._device==t.TARGET_BROWSER&&(this.container.className=e)},enumerable:!0,configurable:!0}),e}();e.HUDDisplay=i}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this._game=t,this._device=this._game.deviceTargetOption}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!0,configurable:!0}),e.prototype.boot=function(){this._device===t.TARGET_BROWSER?(this._supported=!0,this._hudContainer=document.createElement("div"),this._hudContainer.id="HUDContainer",this._hudContainer.style.position="absolute",this._hudContainer.style.width="100%",this._hudContainer.style.height="100%",this._hudContainer.style.top="0",this._hudContainer.style.left="0",this._game.stage.container.appendChild(this._hudContainer),this._huds=new Array,this._defaultHUD=this.createHUD("defaultHUD"),this._currentHUD=this._defaultHUD,this.setHUD(this._defaultHUD)):this._supported=!1},e.prototype.objType=function(){return"HUDManager"},Object.defineProperty(e.prototype,"defaultHUD",{get:function(){return this._defaultHUD},set:function(t){this._currentHUD===this._defaultHUD&&(this._currentHUD=t,this.setHUD(this._currentHUD)),this._defaultHUD=t},enumerable:!0,configurable:!0}),e.prototype.setHUD=function(t){this.supported&&(this.hideHUD(),this._currentHUD=t,this.showHUD())},e.prototype.showHUD=function(t){"undefined"==typeof t&&(t=this._currentHUD),t.show()},e.prototype.hideHUD=function(t){"undefined"==typeof t&&(t=this._currentHUD),t.hide()},e.prototype.createHUD=function(e,i){if("undefined"==typeof i&&(i=!1),this.supported){var n=new t.HUD.HUDDisplay(this._game,e);return n.hide(),this.addToContainer(n),this._huds.push(n),i===!0&&this.setHUD(n),n}},e.prototype.removeHUD=function(t){if(this.supported){if(t===this._defaultHUD)return!1;this._currentHUD===t&&this.setHUD(this._defaultHUD),this.removeFromContainer(t);var e=this._huds.indexOf(t);return-1!==e&&this._huds.splice(e,1),!0}},e.prototype.addToContainer=function(e){this._device==t.TARGET_BROWSER&&this._hudContainer.appendChild(e.container)},e.prototype.removeFromContainer=function(e){this._device==t.TARGET_BROWSER&&this._hudContainer.contains(e.container)&&this._hudContainer.removeChild(e.container)},e.prototype.update=function(){if(this._supported)for(var t=0;t<this._huds.length;t++)this._huds[t].update()},e}();e.HUDManager=i}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(e,i,n,o){this.name=i,this.game=e,this._manager=this.game.huds,this._device=this.game.deviceTargetOption,this.components=new t.ComponentManager(t.HUD_WIDGET,this),this._manager.supported&&(this._device===t.TARGET_BROWSER&&(this.container=document.createElement("div"),this.container.id="HUD-widget-"+this.game.rnd.uuid(),this.container.className="HUD-widget",this.container.style.position="absolute"),this.onCoordsUpdate=new t.Signal,this.x=n,this.y=o)}return e.prototype.objType=function(){return"HUDWidget"},Object.defineProperty(e.prototype,"style",{get:function(){return this._device===t.TARGET_BROWSER?this.container.style:void 0},set:function(e){this._device===t.TARGET_BROWSER&&(this.container.style=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._manager.supported&&(this._x=e,this._device==t.TARGET_BROWSER&&(this.container.style.left=this.x+"px"),this.onCoordsUpdate.dispatch(this.x,this.y))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._manager.supported&&(this._y=e,this._device==t.TARGET_BROWSER&&(this.container.style.top=this.y+"px"),this.onCoordsUpdate.dispatch(this.x,this.y))},enumerable:!0,configurable:!0}),e.prototype.setTemplate=function(e,i){for(var n=[],o=0;o<arguments.length-2;o++)n[o]=arguments[o+2];if(this._device==t.TARGET_BROWSER){var r=document.getElementById(e);if(void 0===r)return;if(void 0===i)var s=r;else{var s=document.getElementById(i);if(void 0===s||r.contains(s)===!1)return}this.tempElement=s,this._tempContainer=r,this._tempParent=r.parentElement,this._tempParent.removeChild(r),this.container.appendChild(r)}},e.prototype.removeTemplate=function(){this._device==t.TARGET_BROWSER&&void 0!==this.tempElement&&(this.container.removeChild(this._tempContainer),this._tempParent.appendChild(this._tempContainer),this.tempElement=null,this._tempParent=null,this._tempContainer=null)},Object.defineProperty(e.prototype,"class",{get:function(){return this._device==t.TARGET_BROWSER?this.container.className:void 0},set:function(e){this._device==t.TARGET_BROWSER&&(this.container.className=e)},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.components.update()},e.prototype.destroy=function(){delete this.game,delete this._manager,delete this._device,this.onCoordsUpdate&&this.onCoordsUpdate.dispose(),delete this.onCoordsUpdate},e}();e.HUDWidget=i}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(i,n,o,r){e.call(this,i,"textField",o,r),this._prefix="",this._suffix="",this.class="kiwi-textfield-widget kiwi-widget",this._manager.supported&&this._device===t.TARGET_BROWSER&&(this._textField=this.container,this._textField.innerHTML=n)}return __extends(i,e),i.prototype.objType=function(){return"TextFieldWidget"},i.prototype.setTemplate=function(i,n){this._device===t.TARGET_BROWSER&&(this._textField.innerText="",e.prototype.setTemplate.call(this,i,n),void 0!==this.tempElement&&(this._textField=this.tempElement),this._textField.innerHTML=this._text)},i.prototype.removeTemplate=function(){this._device===t.TARGET_BROWSER&&(e.prototype.removeTemplate.call(this),this._device===t.TARGET_BROWSER&&(this._textField=this.container,this._textField.innerHTML=this._text))},Object.defineProperty(i.prototype,"text",{get:function(){return this._text},set:function(e){this._manager.supported&&this._device===t.TARGET_BROWSER&&(""!==this._prefix&&(e=this._prefix+e),""!==this._suffix&&(e+=this._suffix),this._text=e,this._textField.innerHTML=this._text)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"suffix",{get:function(){return this._suffix},set:function(t){this._suffix=t,this._updateText()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"prefix",{get:function(){return this._prefix},set:function(t){this._prefix=t,this._updateText()},enumerable:!0,configurable:!0}),i.prototype._updateText=function(){this.text=this._text},i}(t.HUD.HUDWidget);e.TextField=i}(e.Widget||(e.Widget={})),e.Widget}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(i,n,o,r,s,a,h,u){"undefined"==typeof a&&(a=120),"undefined"==typeof h&&(h=20),"undefined"==typeof u&&(u="#000"),e.call(this,i,"bar",r,s),this._horizontal=!0,this.class="kiwi-bar-widget kiwi-widget",this._manager.supported&&(this._device==t.TARGET_BROWSER&&(this._bar=document.createElement("div"),this._bar.className="kiwi-innerbar-widget",this._bar.style.backgroundColor=u,this.bar=this._bar,this.container.appendChild(this.bar)),this.counter=this.components.add(new t.HUD.HUDComponents.Counter(this,n,o,0)),this.counter.updated.add(this.updateCSS,this),this.width=a,this.height=h,this._bar.style.height="100%",this._bar.style.width="100%",this.updateCSS())
}return __extends(i,e),i.prototype.objType=function(){return"BarWidget"},Object.defineProperty(i.prototype,"width",{get:function(){return this._width},set:function(e){this._device==t.TARGET_BROWSER&&(this.container.style.width=e+"px"),this._width=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(e){this._device==t.TARGET_BROWSER&&(this.container.style.height=e+"px"),this._height=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"horizontal",{get:function(){return this._horizontal},set:function(t){this._horizontal=t,this.updateCSS()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vertical",{get:function(){return!this._horizontal},set:function(t){this._horizontal=!t,this.updateCSS()},enumerable:!0,configurable:!0}),i.prototype.setTemplate=function(i,n){this._device==t.TARGET_BROWSER&&(e.prototype.setTemplate.call(this,i,n),void 0!==this.tempElement&&(this.bar=this.tempElement))},i.prototype.removeTemplate=function(){this._device==t.TARGET_BROWSER&&(e.prototype.removeTemplate.call(this),this.bar=this._bar,this.container.appendChild(this.bar),this.updateCSS())},i.prototype.updateCSS=function(){this.horizontal===!0?(this.bar.style.width=String(this.counter.currentPercent())+"%",this.bar.style.height="100%"):(this.bar.style.height=String(this.counter.currentPercent())+"%",this.bar.style.width="100%")},i}(t.HUD.HUDWidget);e.Bar=i}(e.Widget||(e.Widget={})),e.Widget}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,n,o){e.call(this,t,"Icon",n,o),this._cellIndex=0,this.class="kiwi-icon-widget kiwi-widget",this.atlas=i,this.icon=this.container,this._applyCSS()}return __extends(i,e),Object.defineProperty(i.prototype,"cellIndex",{get:function(){return this._cellIndex},set:function(t){this._cellIndex=t,this.width=this.atlas.cells[this.cellIndex].w,this.height=this.atlas.cells[this.cellIndex].h,this._applyCSS()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this.atlas.cells[this.cellIndex].w},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.atlas.cells[this.cellIndex].h},enumerable:!0,configurable:!0}),i.prototype._removeCSS=function(){this.icon.style.width="",this.icon.style.height="",this.icon.style.backgroundImage="",this.icon.style.backgroundRepeat=""},i.prototype._applyCSS=function(){this.icon.style.width=this.width+"px",this.icon.style.height=this.height+"px",this.icon.style.backgroundPositionX=-this.atlas.cells[this.cellIndex].x+"px",this.icon.style.backgroundPositionY=-this.atlas.cells[this.cellIndex].y+"px",this.icon.style.backgroundRepeat="no-repeat",this.icon.style.backgroundImage=0==t.Utils.Common.isUndefined(this.atlas.image.src)?'url("'+this.atlas.image.src+'")':'url("'+this.atlas.image.toDataURL("image/png")+'")'},i.prototype.setTemplate=function(i,n){this._device==t.TARGET_BROWSER&&(this._removeCSS(),e.prototype.setTemplate.call(this,i,n),void 0!==this.tempElement&&(this.icon=this.tempElement),this._applyCSS())},i.prototype.removeTemplate=function(){this._device==t.TARGET_BROWSER&&(e.prototype.removeTemplate.call(this),this._removeCSS(),this.icon=this.container,this._applyCSS())},i}(t.HUD.HUDWidget);e.Icon=i}(e.Widget||(e.Widget={})),e.Widget}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(i,n,o,r,s,a){e.call(this,i,"IconBar",s,a),this.iconGap=0,this.class="kiwi-iconbar-widget kiwi-widget",this.atlas=n,this.width=this.atlas.cells[0].w,this.height=this.atlas.cells[0].h,this._horizontal=!0,this.counter=this.components.add(new t.HUD.HUDComponents.Counter(this,o,r,0)),this.counter.updated.add(this._amountChanged,this),this._icons=[],this._amountChanged()}return __extends(i,e),i.prototype.objType=function(){return"IconBarWidget"},i.prototype._amountChanged=function(){if(this.counter.max!==this._icons.length)if(this.counter.max>this._icons.length)for(var t=this.counter.max-this._icons.length,e=0;t>e;e++)this._addIcon();else for(var e=this.counter.max;e<this._icons.length;e++)this._removeIcon(this._icons[e]),this._icons[e].destroy(),this._icons.splice(e,1),e--;for(var e=0;e<this._icons.length;e++)this._icons[e].style.display=e>this.counter.current-1?"none":"block"},i.prototype._addIcon=function(){if(this.horizontal)var e=new t.HUD.Widget.Icon(this.game,this.atlas,this.x+(this.width+this.iconGap)*(this._icons.length-1),this.y);else var e=new t.HUD.Widget.Icon(this.game,this.atlas,this.x,(this.height+this.iconGap)*(this._icons.length-1)+this.y);this._icons.push(e),this._device==t.TARGET_BROWSER&&this.container.appendChild(e.container)},i.prototype._removeIcon=function(e){this._device==t.TARGET_BROWSER&&this.container.removeChild(e.container)},Object.defineProperty(i.prototype,"horizontal",{get:function(){return this._horizontal},set:function(t){this._horizontal=t,this._amountChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vertical",{get:function(){return!this._horizontal},set:function(t){this._horizontal=!t,this._amountChanged()},enumerable:!0,configurable:!0}),i}(t.HUD.HUDWidget);e.IconBar=i}(e.Widget||(e.Widget={})),e.Widget}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(i,n,o,r){"undefined"==typeof r&&(r=0),e.call(this,i,"basicScore",n,o),this.name="basicScore",this.class="kiwi-basicscore-widget kiwi-widget",this.counter=this.components.add(new t.HUD.HUDComponents.Counter(this,r)),this.counter.updated.add(this._updateText,this),this._updateText()}return __extends(i,e),i.prototype.objType=function(){return"BasicScoreWidget"},i.prototype._updateText=function(){this.text=String(this.counter.current)},i}(t.HUD.Widget.TextField);e.BasicScore=i}(e.Widget||(e.Widget={})),e.Widget}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(i,n,o,r){e.call(this,i,n,o,r),this.name="button",this.class="kiwi-button-widget kiwi-widget",this.input=this.components.add(new t.HUD.HUDComponents.WidgetInput(this,this.container))}return __extends(i,e),i.prototype.objType=function(){return"ButtonWidget"},i}(t.HUD.Widget.TextField);e.Button=i}(e.Widget||(e.Widget={})),e.Widget}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(i,n,o,r){e.call(this,i,"time",o,r),this.name="time",this.class="kiwi-time-widget kiwi-widget",this.time=this.components.add(new t.HUD.HUDComponents.Time(this,n))}return __extends(i,e),i.prototype.objType=function(){return"TimeWidget"},i.prototype.pause=function(){this.time.pause()},i.prototype.stop=function(){this.time.stop()},i.prototype.start=function(){this.time.start()},i.prototype.resume=function(){this.time.resume()},i.prototype.update=function(){e.prototype.update.call(this),this.time.isRunning&&(this.text=this.time.getTime())},i}(t.HUD.Widget.TextField);e.Time=i}(e.Widget||(e.Widget={})),e.Widget}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(t,i,n){e.call(this,t,"menu",i,n),this._menuItems=[],this._styles=[],this.class="kiwi-menu-widget kiwi-widget"}return __extends(i,e),i.prototype.objType=function(){return"MenuWidget"},i.prototype.setIconStyle=function(t,e){this._styles.push({index:t,value:e});for(var i=0;i<this._menuItems.length;i++)this._menuItems[i].style[t]=e},Object.defineProperty(i.prototype,"menuItems",{get:function(){return this._menuItems},enumerable:!0,configurable:!0}),i.prototype.createMenuItem=function(e,i,n){return this.addMenuItem(new t.HUD.Widget.MenuItem(this.game,e,i,n))},i.prototype.addMenuItem=function(e){this._menuItems.push(e),e.menu=this;for(var i=0;i<this._styles.length;i++)e.style[this._styles[i].index]=this._styles[i].value;return this._device==t.TARGET_BROWSER&&this.container.appendChild(e.container),e},i.prototype.addMenuItems=function(t){for(var e=0;e<t.length;e++)this.addMenuItem(t[e])},i.prototype.getMenuItem=function(t){return this._menuItems[t]},i.prototype.setTemplate=function(){},i.prototype.removeTemplate=function(){},i.prototype.update=function(){for(var t=0;t<this._menuItems.length;t++)this._menuItems[t].update();e.prototype.update.call(this)},i}(t.HUD.HUDWidget);e.Menu=i}(e.Widget||(e.Widget={})),e.Widget}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(t){function e(e,i,n,o){t.call(this,e,i,n,o),this.name="menuItem",this.class="kiwi-menuitem-widget kiwi-widget"}return __extends(e,t),e.prototype.objType=function(){return"MenuItem"},e}(t.HUD.Widget.Button);e.MenuItem=i}(e.Widget||(e.Widget={})),e.Widget}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(i,n,o,r){"undefined"==typeof o&&(o=null),"undefined"==typeof r&&(r=null),e.call(this,i,"counter"),this._current=n,this._max=o,this._min=r,this.updated=new t.Signal}return __extends(i,e),i.prototype.objType=function(){return"CounterComponent"},Object.defineProperty(i.prototype,"max",{get:function(){return this._max},set:function(t){this._max=t,this.updated.dispatch(this._current,this._max,this._min)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"min",{get:function(){return this._min},set:function(t){this._min=t,this.updated.dispatch(this._current,this._max,this._min)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"current",{get:function(){return this._current},set:function(t){this._current=null!==this._max&&t>this._max?this._max:null!==this._min&&t<this._min?this._min:t,this.updated.dispatch(this._current,this._max,this._min)},enumerable:!0,configurable:!0}),i.prototype.decrease=function(t){return"undefined"==typeof t&&(t=1),(null===this._min||this._current>this._min)&&(null!==this._min&&this._current-t<this._min?this._current=this._min:this._current-=t,this.updated.dispatch(this._current,this._max,this._min)),this._current},i.prototype.increase=function(t){return"undefined"==typeof t&&(t=1),(null===this._max||this._current<this._max)&&(null!==this._max&&this._current+t>this._max?this._current=this._max:this._current+=t,this.updated.dispatch(this._current,this._max,this._min)),this._current},i.prototype.currentPercent=function(){return null!==this.max?this.current/this.max*100:void 0},i}(t.Component);e.Counter=i}(e.HUDComponents||(e.HUDComponents={})),e.HUDComponents}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(e){function i(i,n){e.call(this,i,"WidgetInput"),this._active=!1,this._container=n,this.onUp=new t.Signal,this.onDown=new t.Signal,this.onOver=new t.Signal,this.onOut=new t.Signal,this._addEvents()}return __extends(i,e),i.prototype.objType=function(){return"WidgetInputComponent"},i.prototype.setElement=function(t){this._removeEvents(),this._container=t,this._addEvents()},i.prototype._addEvents=function(){if(!this._active){this._binds=[],this._binds.push({event:"mouseup","function":this._up.bind(this)}),this._binds.push({event:"mousedown","function":this._down.bind(this)}),this._binds.push({event:"mouseover","function":this._over.bind(this)}),this._binds.push({event:"mouseout","function":this._out.bind(this)});for(var t=0;t<this._binds.length;t++)this._container.addEventListener(this._binds[t].event,this._binds[t].function,!1);this._active=!0}},i.prototype._removeEvents=function(){if(this._active){for(var t=0;t<this._binds.length;t++)this._container.removeEventListener(this._binds[t].event,this._binds[t].function,!1);this._binds=[],this._active=!1}},i.prototype._up=function(t){this.onUp.dispatch(t)},i.prototype._down=function(t){this.onDown.dispatch(t)},i.prototype._over=function(t){this.onOver.dispatch(t)},i.prototype._out=function(t){this.onOut.dispatch(t)},i}(t.Component);e.WidgetInput=i}(e.HUDComponents||(e.HUDComponents={})),e.HUDComponents}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){!function(e){var i=function(t){function e(e,i){"undefined"==typeof i&&(i=""),t.call(this,e,"time"),this.countDown=!1,this._displayString="",this._currentTime=0,this._timeBefore=0,this.speed=1,this.clock=this.game.time.addClock(name+"-clock",1e3),this.format=i}return __extends(e,t),e.prototype.objType=function(){return"TimeComponent"},Object.defineProperty(e.prototype,"isRunning",{get:function(){return this.clock.isRunning()},enumerable:!0,configurable:!0}),e.prototype.pause=function(){this.clock.pause()},e.prototype.stop=function(){this.clock.stop()},e.prototype.start=function(){this.clock.start(),this._timeBefore=this.clock.elapsed()},e.prototype.resume=function(){this.clock.resume()},Object.defineProperty(e.prototype,"format",{get:function(){return this._format},set:function(t){this._format=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),e.prototype.setTime=function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),this._currentTime=t,0!=e&&(this._currentTime+=1e3*e),0!=i&&(this._currentTime+=60*i*1e3)},e.prototype.addTime=function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),this._currentTime+=t,0!=e&&(this._currentTime+=1e3*e),0!=i&&(this._currentTime+=60*i*1e3)},e.prototype.removeTime=function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),this._currentTime-=t,0!=e&&(this._currentTime-=1e3*e),0!=i&&(this._currentTime-=60*i*1e3)},e.prototype.getTime=function(){if(this.countDown?this._currentTime-=(this.clock.elapsed()-this._timeBefore)*this.speed:this._currentTime+=(this.clock.elapsed()-this._timeBefore)*this.speed,this._timeBefore=this.clock.elapsed(),""!==this._format){if(this._displayString=this._format,-1!==this._displayString.indexOf("ms")){var t=String(Math.floor(1e3*this._currentTime)%1e3);this._displayString=this._displayString.replace("ms",t)}if(-1!=this._displayString.indexOf("ss")){var t=String(Math.floor(this._currentTime)%60);t.length<2&&(t="0"+t),this._displayString=this._displayString.replace("ss",t)}if(-1!==this._displayString.indexOf("mm")){var t=String(Math.floor(this._currentTime/60)%60);t.length<2&&(t="0"+t),this._displayString=this._displayString.replace("mm",t)}if(-1!=this._displayString.indexOf("s")){var t=String(Math.floor(this._currentTime)%60);this._displayString=this._displayString.replace("s",t)}if(-1!==this._displayString.indexOf("m")){var t=String(Math.floor(this._currentTime/60)%60);this._displayString=this._displayString.replace("m",t)}return this._displayString}return String(this._currentTime.toFixed(2))},e}(t.Component);e.Time=i}(e.HUDComponents||(e.HUDComponents={})),e.HUDComponents}(t.HUD||(t.HUD={})),t.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this.noAudio=!1,this.usingWebAudio=!1,this.usingAudioTag=!1,this.context=null,this.masterGain=null,this._unlockedSource=null,this._game=t}return e.prototype.objType=function(){return"AudioManager"},Object.defineProperty(e.prototype,"locked",{get:function(){return this._locked},enumerable:!0,configurable:!0}),e.prototype.boot=function(){this._volume=1,this._muted=!1,this._sounds=[],t.DEVICE.iOS&&0==t.DEVICE.webaudio&&(this.channels=1),t.DEVICE.iOS&&this._game.deviceTargetOption!==t.TARGET_COCOON?(this._locked=!0,this._game.input.onUp.addOnce(this._unlocked,this),console.log("Kiwi.AudioManager: Audio is currently Locked until at touch event.")):this._locked=!1,this.usingWebAudio=!0,this.usingAudioTag=!1,window.AudioContext?this.context=new window.AudioContext:window.webkitAudioContext?this.context=new window.webkitAudioContext:window.Audio?(this.usingWebAudio=!1,this.usingAudioTag=!0):(this.usingWebAudio=!1,this.noAudio=!0),null!==this.context&&(this.masterGain=void 0===this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},e.prototype._unlocked=function(){if(console.log("Kiwi.AudioManager: Audio now Unlocked"),this.usingAudioTag){this._locked=!1;for(var t=0;t<this._sounds.length;t++)this._sounds[t].playable=!0}else{var e=this.context.createBuffer(1,1,22050);this._unlockedSource=this.context.createBufferSource(),this._unlockedSource.buffer=e,this._unlockedSource.connect(this.context.destination),this._unlockedSource.noteOn(0)}},Object.defineProperty(e.prototype,"mute",{get:function(){return this._muted},set:function(t){if(t===!0){if(this._muted)return;if(this._muted=!0,this.usingWebAudio)this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0;else if(this.usingAudioTag)for(var e=0;e<this._sounds.length;e++)this._sounds[e].mute=!0}else{if(0==this._muted)return;if(this._muted=!1,this.usingWebAudio)this.masterGain.gain.value=this._muteVolume;else if(this.usingAudioTag)for(var e=0;e<this._sounds.length;e++)this._sounds[e].mute=!1}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){if(void 0!==e)if(e=t.Utils.GameMath.clamp(e,1,0),this._volume=e,this._muted&&(this._muteVolume=this._volume),this.usingWebAudio)this.masterGain.gain.value=e;else if(this.usingAudioTag)for(var i=0;i<this._sounds.length;i++)this._sounds[i].volume=this._sounds[i].volume},enumerable:!0,configurable:!0}),e.prototype.isRegistered=function(t){return this.noAudio?void 0:-1!==this._sounds.indexOf(t)?!0:!1},e.prototype.registerSound=function(t){return this.isRegistered(t)===!1?(t.id=this._game.rnd.uuid(),this._sounds.push(t),!0):!1},e.prototype.add=function(e,i,n){if("undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=!1),!this.noAudio){var o=new t.Sound.Audio(this._game,e,i,n);return o}},e.prototype.remove=function(t,e){"undefined"==typeof e&&(e=!0);for(var i=0;i<this._sounds.length;i++)if(t.id==this._sounds[i].id)return this.usingWebAudio&&this._sounds[i].gainNode.disconnect(),1==e&&this._sounds[i].destroy(),void this._sounds.splice(i,1,0)},e.prototype.playAll=function(){for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].play()},e.prototype.stopAll=function(){for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].stop()},e.prototype.pauseAll=function(){for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].pause()},e.prototype.resumeAll=function(){for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].resume()},e.prototype.update=function(){if(this._locked&&this.usingWebAudio&&null!==this._unlockedSource&&(this._unlockedSource.playbackState===this._unlockedSource.PLAYING_STATE||this._unlockedSource.playbackState===this._unlockedSource.FINISHED_STATE)){this._locked=!1,this._unlockedSource=null;for(var t=0;t<this._sounds.length;t++)this._sounds[t].playable=!0}if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t].update()},e}();e.AudioManager=i}(t.Sound||(t.Sound={})),t.Sound}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(e,i,n,o){return this._muted=!1,this.totalDuration=0,this._buffer=null,this._decoded=!1,this._markers=[],this._currentMarker="default",this.ready=!1,this._game=e,this._game.audio.registerSound(this),this._usingAudioTag=this._game.audio.usingAudioTag,this._usingWebAudio=this._game.audio.usingWebAudio,this._playable=1==this._game.audio.locked?!1:!0,this.duration=0,this._volume=n,this._muteVolume=n,this._muted=this._game.audio.mute,this._loop=o,this.key=i,this._game.audio.noAudio||this._game.fileStore.exists(this.key)===!1?void(this._game.debugOption&&console.log("Could not play Audio. Either the browser doesn't support audio or the Audio file was not found on the filestore")):(this._usingWebAudio?(this._setAudio(),this.ready&&(this.context=this._game.audio.context,this.masterGainNode=this._game.audio.masterGain,this.gainNode="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this._decode(),this.gainNode.gain.value=this.volume*this._game.audio.volume,this.gainNode.connect(this.masterGainNode))):this._usingAudioTag&&this._playable===!0&&(this._setAudio(),this.ready&&(this.totalDuration=this._sound.duration,this._sound.volume=this.volume*this._game.audio.volume,(isNaN(this.totalDuration)||0==this.totalDuration)&&(this._pending=!0))),this.addMarker("default",0,this.totalDuration,this._loop),this._currentMarker="default",this.onPlay=new t.Signal,this.onStop=new t.Signal,this.onPause=new t.Signal,this.onResume=new t.Signal,this.onLoop=new t.Signal,void(this.onMute=new t.Signal))}return Object.defineProperty(e.prototype,"playable",{get:function(){return this._playable},set:function(t){this._playable!==!0&&1==t&&(this._playable=t,this._setAudio(),this.ready&&this._usingAudioTag&&(this.totalDuration=this._sound.duration,this._sound.volume=this.volume*this._game.audio.volume))},enumerable:!0,configurable:!0}),e.prototype.objType=function(){return"Audio"},e.prototype._setAudio=function(){this._file=this._game.fileStore.getFile(this.key),"undefined"!=typeof this._file.data&&(this._usingAudioTag?(this._sound=this._file.data.cloneNode(!0),this._sound.play(),this._sound.pause()):this._sound=this._file.data,this.ready=!0)},e.prototype._decode=function(){if(0!=this.ready&&!this._usingAudioTag){if(this._file.data.decoded===!0&&null!==this._file.data.buffer)return this._buffer=this._file.data.buffer,void(this._decoded=!0);var t=this;this.context.decodeAudioData(this._file.data.raw,function(e){t._buffer=e,t._decoded=!0})}},Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){this._game.audio.noAudio||this.ready===!1||(e=t.Utils.GameMath.clamp(e,1,0),this._volume=e,this._muted&&(this._muteVolume=this._volume),this._playable&&(this._usingWebAudio?this.gainNode.gain.value=this._volume*this._game.audio.volume:this._usingAudioTag&&(this._sound.volume=this._volume*this._game.audio.volume)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mute",{get:function(){return this._muted},set:function(t){this._game.audio.noAudio||void 0!==t&&this._muted!==t&&(t===!0?(this._muteVolume=this._volume,this.volume=0,this._muted=!0):(this._muted=!1,this.volume=this._muteVolume),this.onMute.dispatch(this._muted))},enumerable:!0,configurable:!0}),e.prototype.addMarker=function(t,e,i,n){"undefined"==typeof n&&(n=!1),this._markers[t]={start:e,stop:i,duration:i-e,loop:n}},e.prototype.removeMarker=function(t){"default"!==t&&(this.isPlaying&&this._currentMarker==t&&(this.stop(),this._currentMarker="default"),delete this._markers[t])},e.prototype.play=function(e,i){return"undefined"==typeof e&&(e=this._currentMarker),"undefined"==typeof i&&(i=!1),this.isPlaying&&0==i||this._game.audio.noAudio||(i===!0&&this._pending===!1&&this.stop(),"undefined"==typeof this._markers[e]||this._currentMarker===e&&this.isPlaying&&0==i)?void 0:(this.paused=!1,this._currentMarker=e,this.duration=1e3*this._markers[this._currentMarker].duration,this._loop=this._markers[this._currentMarker].loop,this._playable===!1?void(this._pending=!0):void(this._usingWebAudio?this._decoded===!0?(null==this._buffer&&(this._buffer=this._file.data.buffer),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.gainNode),this.totalDuration=this._sound.buffer.duration,0==this.duration&&(this.duration=1e3*this.totalDuration),this._loop&&(this._sound.loop=!0),void 0===this._sound.start?this._sound.noteGrainOn(0,this._markers[this._currentMarker].start,this.duration/1e3):this._sound.start(0,this._markers[this._currentMarker].start,this.duration/1e3),this.isPlaying=!0,this._startTime=this._game.time.now(),this._currentTime=0,this._stopTime=this._startTime+this.duration,this.onPlay.dispatch()):(this._pending=!0,this._decode()):this._usingAudioTag&&(this._sound&&4==this._sound.readyState||this._game.deviceTargetOption==t.TARGET_COCOON?((0==this.duration||isNaN(this.duration))&&(this.duration=1e3*this.totalDuration),this._sound.volume=this._muted?0:this._volume,this._sound.currentTime=this._markers[this._currentMarker].start,this._sound.play(),this.isPlaying=!0,this._startTime=this._game.time.now(),this._currentTime=0,this._stopTime=this._startTime+this.duration,this.paused||this.onPlay.dispatch()):this._pending=!0)))},e.prototype.stop=function(){this.isPlaying&&this._sound&&(this._usingWebAudio?void 0===this._sound.stop?this._sound.noteOff(0):this._sound.stop(0):this._usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0),this.isPlaying=!1,0==this.paused&&this.onStop.dispatch())},e.prototype.pause=function(){this.isPlaying&&(this.paused=!0,this.stop(),this.onPause.dispatch())},e.prototype.resume=function(){this.paused&&0==this.isPlaying&&(this._usingWebAudio?(null==this._buffer&&(this._buffer=this._file.data.buffer),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.gainNode),void 0===this._sound.start?this._sound.noteGrainOn(0,this._markers[this._currentMarker].start+this._currentTime/1e3,this.duration/1e3):this._sound.start(0,this._markers[this._currentMarker].start+this._currentTime/1e3,this.duration/1e3)):(this._sound.currentTime=this._markers[this._currentMarker].start+this._currentTime/1e3,this._sound.play()),this.paused=!1,this.isPlaying=!0,this.onResume.dispatch())},e.prototype.update=function(){this.ready&&(this._playable&&this._pending&&(this._decoded===!0||this._file.data&&this._file.data.decoded?(this._pending=!1,this.play()):(this._usingAudioTag&&!isNaN(this._sound.duration)||this._game.deviceTargetOption==t.TARGET_COCOON&&0!==this._sound.duration)&&(this.totalDuration=this._sound.duration,this._markers["default"].duration=this.totalDuration,this._pending=!1,this.isPlaying&&"default"==this._currentMarker&&(this.duration=this.totalDuration))),this.isPlaying&&(this._currentTime=this._game.time.now()-this._startTime,this._currentTime>=this.duration&&(this._usingWebAudio?this._loop?("default"==this._currentMarker?(this._currentTime=0,this._startTime=this._game.time.now()):this.play(this._currentMarker,!0),this.onLoop.dispatch()):this.stop():this._usingAudioTag&&(this._loop?(this.play(this._currentMarker,!0),this.onLoop.dispatch()):this.stop()))))},e.prototype.destroy=function(){this._game&&this._game.audio.remove(this),this.onLoop&&this.onLoop.dispose(),this.onStop&&this.onStop.dispose(),this.onPlay&&this.onPlay.dispose(),this.onMute&&this.onMute.dispose(),this.onPause&&this.onPause.dispose(),this.onResume&&this.onResume.dispose(),delete this.onLoop,delete this.onStop,delete this.onPause,delete this.onMute,delete this.onPlay,delete this.onResume,delete this._game,delete this._sound,delete this._currentTime,delete this._startTime,delete this._stopTime,delete this._pending,delete this.masterGainNode,delete this.gainNode,delete this.totalDuration,delete this.duration,delete this._file,delete this._buffer,delete this._decoded},e}();e.Audio=i}(t.Sound||(t.Sound={})),t.Sound}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t){this._game=t,this.audio={}}return e.prototype.objType=function(){return"AudioLibrary"},e.prototype.clear=function(){for(var t in this.audio)delete this.audio[t]},e.prototype.rebuild=function(t,e){this.clear(),this._game.debug&&console.log("Kiwi.AudioLibrary: Rebuilding Audio Library");for(var i=t.keys,n=0;n<i.length;n++){var o=this._game.fileStore.getFile(i[n]);o.isAudio&&(this._game.debug&&console.log("  Kiwi.AudioLibrary: Adding Audio: "+o.fileName),e.audioLibrary.add(o))}},e.prototype.add=function(e){switch(e.dataType){case t.Files.File.AUDIO:this.audio[e.key]=e}},e}();e.AudioLibrary=i}(t.Sound||(t.Sound={})),t.Sound}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function e(t,e,i,n){"undefined"==typeof n&&(n=1e3),this._timeFirstStarted=null,this._timeLastStarted=null,this._timeLastStopped=null,this._timeLastPaused=null,this._timeLastUnpaused=null,this._totalPaused=0,this._isRunning=!1,this._isStopped=!0,this._isPaused=!1,this._elapsedState=0,this.manager=null,this.master=null,this.name=null,this.units=0,this.manager=t,this.master=e,this.name=i,this.units=n,this.timers=[],this.units<1&&(this.units=1)}return e.prototype.objType=function(){return"Clock"},e.prototype.elapsedSinceFirstStarted=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeFirstStarted)/this.units:null},e.prototype.started=function(){return this._timeLastStarted},e.prototype.elapsed=function(){return 0===this._elapsedState?this._timeLastStarted?(this.master.elapsed()-this._timeLastStarted-this._totalPaused)/this.units:null:1===this._elapsedState?(this._timeLastPaused-this._timeLastStarted-this._totalPaused)/this.units:2===this._elapsedState?this._timeLastStarted?(this.master.elapsed()-this._timeLastStarted-this._totalPaused)/this.units:null:3===this._elapsedState?(this._timeLastStopped-this._timeLastStarted-this._totalPaused)/this.units:void 0},e.prototype.elapsedSinceLastStopped=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeLastStopped)/this.units:null},e.prototype.elapsedSinceLastPaused=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeLastPaused)/this.units:null},e.prototype.elapsedSinceLastUnpaused=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeLastUnpaused)/this.units:null},e.prototype.isRunning=function(){return this._isRunning},e.prototype.isStopped=function(){return this._isStopped},e.prototype.isPaused=function(){return this._isPaused},e.prototype.addTimer=function(t){return this.timers.push(t),this},e.prototype.createTimer=function(e,i,n,o){return"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=!0),this.timers.push(new t.Timer(e,this,i,n)),o===!0&&this.timers[this.timers.length-1].start(),this.timers[this.timers.length-1]},e.prototype.removeTimer=function(t,e){return"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=""),null!==t?this.timers[t.name]?(delete this.timers[t.name],!0):!1:""!==e&&this.timers[e]?(delete this.timers[e],!0):!1},e.prototype.checkExists=function(t){return this.timers[t]?!0:!1},e.prototype.stopAllTimers=function(){for(var t=0;t<this.timers.length;t++)this.timers[t].stop();return this},e.prototype.convertToMilliseconds=function(t){return t*this.units},e.prototype.update=function(){for(var t=0;t<this.timers.length;t++)this.timers[t].update()},e.prototype.start=function(){return this._timeLastStarted=this.master.elapsed(),this._totalPaused=0,this._timeFirstStarted||(this._timeFirstStarted=this._timeLastStarted),this._isRunning=!0,this._isPaused=!1,this._isStopped=!1,this._elapsedState=0,this},e.prototype.pause=function(){return this._isRunning===!0&&(this._timeLastPaused=this.master.elapsed(),this._isRunning=!1,this._isPaused=!0,this._isStopped=!1,this._elapsedState=1),this},e.prototype.resume=function(){return this._isPaused===!0&&(this._timeLastUnpaused=this.master.elapsed(),this._totalPaused+=this._timeLastUnpaused-this._timeLastPaused,this._isRunning=!0,this._isPaused=!1,this._isStopped=!1,this._elapsedState=2),this},e.prototype.stop=function(){return this._isStopped===!1&&(this._timeLastStopped=this.master.elapsed(),this._isPaused===!0&&(this._totalPaused+=this._timeLastStopped-this._timeLastPaused),this._isRunning=!1,this._isPaused=!1,this._isStopped=!0,this._elapsedState=3),this},e.prototype.toString=function(){return"[{Clock (name="+this.name+" units="+this.units+" running="+this._isRunning+")}]"},e}();t.Clock=e}(t.Time||(t.Time={})),t.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function i(t){this._clocks=[],this._game=t}return i.prototype.objType=function(){return"ClockManager"},i.prototype.boot=function(){this.master=new t.Time.MasterClock,this.clock=new e.Clock(this,this.master,"default",1e3),this.clock.start()},i.prototype.addClock=function(t,i){return"undefined"==typeof i&&(i=1e3),this._clocks.push(new e.Clock(this,this.master,t,i)),this._clocks[this._clocks.length-1]
},i.prototype.getClock=function(t){for(var e=0;e<this._clocks.length;e++)if(this._clocks[e].name===t)return this._clocks[e]},i.prototype.update=function(){this.master.update(),this.clock.update();for(var t=0;t<this._clocks.length;t++)this._clocks[t].update()},i.prototype.now=function(){return this.master.now},i.prototype.delta=function(){return this.master.delta},i}();e.ClockManager=i}(t.Time||(t.Time={})),t.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(){this.time=0,this.now=0,this.delta=0,this._started=Date.now(),this.time=this._started}return t.prototype.objType=function(){return"MasterClock"},t.prototype.elapsed=function(){return this.now-this._started},t.prototype.totalElapsedSeconds=function(){return.001*(this.now-this._started)},t.prototype.update=function(){this.now=Date.now(),this.delta=this.now-this.time,this.time=this.now,this.delta>.1&&(this.delta=.1)},t.prototype.elapsedSince=function(t){return this.now-t},t.prototype.elapsedSecondsSince=function(t){return.001*(this.now-t)},t.prototype.reset=function(){this._started=this.now},t}();t.MasterClock=e}(t.Time||(t.Time={})),t.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function e(t,e,i,n){"undefined"==typeof n&&(n=0),this._currentCount=0,this._startEvents=null,this._countEvents=null,this._stopEvents=null,this._clock=null,this._timeLastCount=null,this._isRunning=!1,this._isStopped=!0,this._isPaused=!1,this.name=null,this.delay=0,this.repeatCount=0,this._clock=e,this._startEvents=[],this._countEvents=[],this._stopEvents=[],this.name=t,this.delay=i,this.repeatCount=n}return e.prototype.objType=function(){return"Timer"},e.prototype.currentCount=function(){return this._currentCount},e.prototype.isRunning=function(){return this._isRunning},e.prototype.isStopped=function(){return this._isStopped},e.prototype.isPaused=function(){return this._isPaused},e.prototype.processEvents=function(e){if(e===t.TimerEvent.TIMER_START)for(var i=0;i<this._startEvents.length;i++)this._startEvents[i].run();else if(e===t.TimerEvent.TIMER_COUNT)for(var i=0;i<this._countEvents.length;i++)this._countEvents[i].run();else if(e===t.TimerEvent.TIMER_STOP)for(var i=0;i<this._stopEvents.length;i++)this._stopEvents[i].run()},e.prototype.update=function(){this._isRunning&&this._clock.elapsed()-this._timeLastCount>=this.delay&&this._isPaused===!1&&(this._currentCount++,this.processEvents(t.TimerEvent.TIMER_COUNT),this._timeLastCount=this._clock.elapsed()||0,-1!==this.repeatCount&&this._currentCount>=this.repeatCount&&this.stop())},e.prototype.start=function(){return this._isStopped===!0&&(this._isRunning=!0,this._isPaused=!1,this._isStopped=!1,this._currentCount=0,this._timeLastCount=this._clock.elapsed()||0,this.processEvents(t.TimerEvent.TIMER_START)),this},e.prototype.stop=function(){return(this._isRunning===!0||this._isPaused===!0)&&(this._isRunning=!1,this._isPaused=!1,this._isStopped=!0,this.processEvents(t.TimerEvent.TIMER_STOP)),this},e.prototype.pause=function(){return this._isRunning===!0&&(this._isRunning=!1,this._isPaused=!0),this},e.prototype.resume=function(){return this._isPaused===!0&&(this._isRunning=!0,this._isPaused=!1),this},e.prototype.addTimerEvent=function(e){return e.type===t.TimerEvent.TIMER_START?this._startEvents.push(e):e.type===t.TimerEvent.TIMER_COUNT?this._countEvents.push(e):e.type===t.TimerEvent.TIMER_STOP&&this._stopEvents.push(e),e},e.prototype.createTimerEvent=function(e,i,n){return e===t.TimerEvent.TIMER_START?(this._startEvents.push(new t.TimerEvent(e,i,n)),this._startEvents[this._startEvents.length-1]):e===t.TimerEvent.TIMER_COUNT?(this._countEvents.push(new t.TimerEvent(e,i,n)),this._countEvents[this._countEvents.length-1]):e===t.TimerEvent.TIMER_STOP?(this._stopEvents.push(new t.TimerEvent(e,i,n)),this._stopEvents[this._stopEvents.length-1]):null},e.prototype.removeTimerEvent=function(e){var i=[];return e.type===t.TimerEvent.TIMER_START?i=this._startEvents.splice(this._startEvents.indexOf(e),1):e.type===t.TimerEvent.TIMER_COUNT?i=this._countEvents.splice(this._countEvents.indexOf(e),1):e.type===t.TimerEvent.TIMER_STOP&&(i=this._stopEvents.splice(this._stopEvents.indexOf(e),1)),1===i.length?!0:!1},e.prototype.clear=function(e){"undefined"==typeof e&&(e=0),0===e?(this._startEvents.length=0,this._countEvents.length=0,this._stopEvents.length=0):e===t.TimerEvent.TIMER_START?this._startEvents.length=0:e===t.TimerEvent.TIMER_COUNT?this._countEvents.length=0:e===t.TimerEvent.TIMER_STOP&&(this._stopEvents.length=0)},e.prototype.toString=function(){return"[{Timer (name="+this.name+" delay="+this.delay+" repeatCount="+this.repeatCount+" running="+this._isRunning+")}]"},e}();t.Timer=e}(t.Time||(t.Time={})),t.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t,e,i){this._callback=null,this.type=0,this.type=t,this._callback=e,this._callbackContext=i}return t.prototype.objType=function(){return"TimerEvent"},t.prototype.run=function(){this._callback&&this._callback.apply(this._callbackContext)},t.TIMER_START=1,t.TIMER_COUNT=2,t.TIMER_STOP=3,t}();t.TimerEvent=e}(t.Time||(t.Time={})),t.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(t,e,i,n){"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=!1),this.domElement=null,this.context=null,this._visible=!0,this._offScreen=!1,this._clearMode=1,this.bgColor="rgb(0, 0, 0)",this.domElement=document.createElement("canvas"),this.domElement.width=t,this.domElement.height=e,this._width=t,this._height=e,this.context=this.domElement.getContext("2d"),this._offScreen=n,this._visible=i,i===!1&&(this.domElement.style.display="none")}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._updatedSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._updatedSize()},enumerable:!0,configurable:!0}),e.prototype.objType=function(){return"Canvas"},e.prototype._updatedSize=function(){this.domElement.width=this._width,this.domElement.height=this._height},e.prototype.destroy=function(){this._offScreen===!1&&(this.domElement.style.display="none")},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(t){null!==t&&t!==this._visible&&(this._visible=t,this.domElement.style.display=t===!0?"block":"none")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clearMode",{get:function(){return this._clearMode},set:function(e){null!==e&&e!==this._clearMode&&e>=t.Utils.Canvas.CLEARMODE_NONE&&e<=t.Utils.Canvas.CLEARMODE_FILLRECT_ALPHA&&(this._clearMode=e)},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._clearMode===e.CLEARMODE_NONE||(this._clearMode===e.CLEARMODE_CLEARRECT?this.context.clearRect(0,0,this.domElement.width,this.domElement.height):this._clearMode===e.CLEARMODE_FILLRECT?(this.context.fillStyle=this.bgColor,this.context.fillRect(0,0,this.domElement.width,this.domElement.height)):this._clearMode===e.CLEARMODE_FILLRECT_ALPHA&&(this.context.clearRect(0,0,this.domElement.width,this.domElement.height),this.context.fillStyle=this.bgColor,this.context.fillRect(0,0,this.domElement.width,this.domElement.height)))},e.prototype.saveAsPNG=function(){return this.domElement.toDataURL()},e.prototype.toString=function(){return"[{Canvas (width="+this.width+" height="+this.height+" visible="+this.visible+" offScreen="+this._offScreen+" clearMode="+this.clearMode+")}]"},e.CLEARMODE_NONE=0,e.CLEARMODE_CLEARRECT=1,e.CLEARMODE_FILLRECT=2,e.CLEARMODE_FILLRECT_ALPHA=3,e}();e.Canvas=i}(t.Utils||(t.Utils={})),t.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(){}return e.defaultCompare=function(t,e){return e>t?-1:t===e?0:1},e.prototype.objType=function(){return"Common"},e.defaultEquals=function(t,e){return t===e},e.defaultTostring=function(e){return null===e?"KIWI_NULL":t.Utils.Common.isUndefined(e)?"KIWI_UNDEFINED":t.Utils.Common.isString(e)?e:e.toString()},e.isFunction=function(t){return"function"==typeof t},e.isNumeric=function(t){return!isNaN(t)},e.isUndefined=function(t){return"undefined"==typeof t},e.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)},e.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},e.reverseCompareFunction=function(e){return t.Utils.Common.isFunction(e)?function(t,i){return-1*e(t,i)}:function(t,e){return e>t?1:t===e?0:-1}},e.compareToEquals=function(t){return function(e,i){return 0===t(e,i)}},e.shuffleArray=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t},e.convertToBase2=function(t){var e=t.width,i=t.height;if(-1==this.base2Sizes.indexOf(e)){for(var n=0;e>this.base2Sizes[n];)n++;e=this.base2Sizes[n]}if(-1==this.base2Sizes.indexOf(i)){for(var n=0;i>this.base2Sizes[n];)n++;i=this.base2Sizes[n]}if(t.width!==e||t.height!==i){var o=document.createElement("canvas");return o.width=e,o.height=i,o.getContext("2d").drawImage(t,0,0),o}return t},e.base2Sizes=[2,4,16,32,64,128,256,512,1024,2048,4096],e}();e.Common=i}(t.Utils||(t.Utils={})),t.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(e){var i=function(){function e(){}return e.prototype.objType=function(){return"GameMath"},e.computeMachineEpsilon=function(){var t=4/3,e=t-1,i=e+e+e;return Math.abs(1-i)},e.fuzzyEqual=function(t,e,i){return"undefined"==typeof i&&(i=1e-4),Math.abs(t-e)<i},e.fuzzyLessThan=function(t,e,i){return"undefined"==typeof i&&(i=1e-4),e+i>t},e.fuzzyGreaterThan=function(t,e,i){return"undefined"==typeof i&&(i=1e-4),t>e-i},e.fuzzyCeil=function(t,e){return"undefined"==typeof e&&(e=1e-4),Math.ceil(t-e)},e.fuzzyFloor=function(t,e){return"undefined"==typeof e&&(e=1e-4),Math.floor(t+e)},e.average=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];for(var i=0,n=0;n<t.length;n++)i+=t[n];return i/t.length},e.slam=function(t,e,i){return"undefined"==typeof i&&(i=1e-4),Math.abs(t-e)<i?e:t},e.percentageMinMax=function(t,e,i){return"undefined"==typeof i&&(i=0),t-=i,e-=i,e?t/e:0},e.sign=function(t){return t?t/Math.abs(t):0},e.truncate=function(t){return t>0?Math.floor(t):Math.ceil(t)},e.shear=function(t){return t%1},e.wrap=function(t,e,i){if("undefined"==typeof i&&(i=0),t-=i,e-=i,0==e)return i;for(t%=e,t+=i;i>t;)t+=e;return t},e.arithWrap=function(t,e,i){return"undefined"==typeof i&&(i=0),e-=i,0==e?i:t-e*Math.floor((t-i)/e)},e.clamp=function(t,e,i){return"undefined"==typeof i&&(i=0),Math.max(i,Math.min(e,t))},e.snapTo=function(t,e,i){return"undefined"==typeof i&&(i=0),0==e?t:(t-=i,t=e*Math.round(t/e),i+t)},e.snapToFloor=function(t,e,i){return"undefined"==typeof i&&(i=0),0==e?t:(t-=i,t=e*Math.floor(t/e),i+t)},e.snapToCeil=function(t,e,i){return"undefined"==typeof i&&(i=0),0==e?t:(t-=i,t=e*Math.ceil(t/e),i+t)},e.snapToInArray=function(t,e,i){if("undefined"==typeof i&&(i=!0),i&&e.sort(),t<e[0])return e[0];for(var n=1;e[n]<t;)n++;var o=e[n-1],r=n<e.length?e[n]:Number.POSITIVE_INFINITY;return t-o>=r-t?r:o},e.roundTo=function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=10);var n=Math.pow(i,-e);return Math.round(t*n)/n},e.floorTo=function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=10);var n=Math.pow(i,-e);return Math.floor(t*n)/n},e.ceilTo=function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=10);var n=Math.pow(i,-e);return Math.ceil(t*n)/n},e.interpolateFloat=function(t,e,i){return(e-t)*i+t},e.radiansToDegrees=function(t){return t*e.RAD_TO_DEG},e.degreesToRadians=function(t){return t*e.DEG_TO_RAD},e.angleBetween=function(t,e,i,n){return Math.atan2(n-e,i-t)},e.normalizeAngle=function(t,i){"undefined"==typeof i&&(i=!0);var n=i?e.PI:180;return e.wrap(t,n,-n)},e.nearestAngleBetween=function(t,i,n){"undefined"==typeof n&&(n=!0);var o=n?e.PI:180;return t=e.normalizeAngle(t,n),i=e.normalizeAngle(i,n),-o/2>t&&i>o/2&&(t+=2*o),-o/2>i&&t>o/2&&(i+=2*o),i-t},e.normalizeAngleToAnother=function(e,i,n){return"undefined"==typeof n&&(n=!0),i+t.Utils.GameMath.nearestAngleBetween(i,e,n)},e.normalizeAngleAfterAnother=function(e,i,n){return"undefined"==typeof n&&(n=!0),e=t.Utils.GameMath.normalizeAngle(e-i,n),i+e},e.normalizeAngleBeforeAnother=function(e,i,n){return"undefined"==typeof n&&(n=!0),e=t.Utils.GameMath.normalizeAngle(i-e,n),i-e},e.interpolateAngles=function(e,i,n,o,r){return"undefined"==typeof o&&(o=!0),"undefined"==typeof r&&(r=null),e=t.Utils.GameMath.normalizeAngle(e,o),i=t.Utils.GameMath.normalizeAngleToAnother(i,e,o),"function"==typeof r?r(n,e,i-e,1):t.Utils.GameMath.interpolateFloat(e,i,n)},e.logBaseOf=function(t,e){return Math.log(t)/Math.log(e)},e.GCD=function(t,e){var i;for(t=Math.abs(t),e=Math.abs(e),e>t&&(i=t,t=e,e=i);;){if(i=t%e,!i)return e;t=e,e=i}return 1},e.LCM=function(e,i){return e*i/t.Utils.GameMath.GCD(e,i)},e.factorial=function(t){if(0==t)return 1;for(var e=t;--t;)e*=t;return e},e.gammaFunction=function(e){return t.Utils.GameMath.factorial(e-1)},e.fallingFactorial=function(e,i){return t.Utils.GameMath.factorial(e)/t.Utils.GameMath.factorial(e-i)},e.risingFactorial=function(e,i){return t.Utils.GameMath.factorial(e+i-1)/t.Utils.GameMath.factorial(e-1)},e.binCoef=function(e,i){return t.Utils.GameMath.fallingFactorial(e,i)/t.Utils.GameMath.factorial(i)},e.risingBinCoef=function(e,i){return t.Utils.GameMath.risingFactorial(e,i)/t.Utils.GameMath.factorial(i)},e.chanceRoll=function(t){return"undefined"==typeof t&&(t=50),0>=t?!1:t>=100?!0:100*Math.random()>=t?!1:!0},e.maxAdd=function(t,e,i){return t+=e,t>i&&(t=i),t},e.minSub=function(t,e,i){return t-=e,i>t&&(t=i),t},e.wrapValue=function(t,e,i){var n;return t=Math.abs(t),e=Math.abs(e),i=Math.abs(i),n=(t+e)%i},e.randomSign=function(){return Math.random()>.5?1:-1},e.isOdd=function(t){return 1&t?!0:!1},e.isEven=function(t){return 1&t?!1:!0},e.wrapAngle=function(t){var e=t;return t>=-180&&180>=t?t:(e=(t+180)%360,0>e&&(e+=360),e-180)},e.angleLimit=function(t,e,i){var n=t;return t>i?n=i:e>t&&(n=e),n},e.linearInterpolation=function(e,i){var n=e.length-1,o=n*i,r=Math.floor(o);return 0>i?t.Utils.GameMath.linear(e[0],e[1],o):i>1?t.Utils.GameMath.linear(e[n],e[n-1],n-o):t.Utils.GameMath.linear(e[r],e[r+1>n?n:r+1],o-r)},e.bezierInterpolation=function(e,i){for(var n=0,o=e.length-1,r=0;o>=r;r++)n+=Math.pow(1-i,o-r)*Math.pow(i,r)*e[r]*t.Utils.GameMath.bernstein(o,r);return n},e.catmullRomInterpolation=function(e,i){var n=e.length-1,o=n*i,r=Math.floor(o);return e[0]===e[n]?(0>i&&(r=Math.floor(o=n*(1+i))),t.Utils.GameMath.catmullRom(e[(r-1+n)%n],e[r],e[(r+1)%n],e[(r+2)%n],o-r)):0>i?e[0]-(t.Utils.GameMath.catmullRom(e[0],e[0],e[1],e[1],-o)-e[0]):i>1?e[n]-(t.Utils.GameMath.catmullRom(e[n],e[n],e[n-1],e[n-1],o-n)-e[n]):t.Utils.GameMath.catmullRom(e[r?r-1:0],e[r],e[r+1>n?n:r+1],e[r+2>n?n:r+2],o-r)},e.linear=function(t,e,i){return(e-t)*i+t},e.bernstein=function(e,i){return t.Utils.GameMath.factorial(e)/t.Utils.GameMath.factorial(i)/t.Utils.GameMath.factorial(e-i)},e.catmullRom=function(t,e,i,n,o){var r=.5*(i-t),s=.5*(n-e),a=o*o,h=o*a;return(2*e-2*i+r+s)*h+(-3*e+3*i-2*r-s)*a+r*o+e},e.difference=function(t,e){return Math.abs(t-e)},e.PI=3.141592653589793,e.PI_2=1.5707963267948966,e.PI_4=.7853981633974483,e.PI_8=.39269908169872414,e.PI_16=.19634954084936207,e.TWO_PI=6.283185307179586,e.THREE_PI_2=4.71238898038469,e.E=2.71828182845905,e.LN10=2.302585092994046,e.LN2=.6931471805599453,e.LOG10E=.4342944819032518,e.LOG2E=1.4426950408889634,e.SQRT1_2=.7071067811865476,e.SQRT2=1.4142135623730951,e.DEG_TO_RAD=.017453292519943295,e.RAD_TO_DEG=57.29577951308232,e.B_16=65536,e.B_31=2147483648,e.B_32=4294967296,e.B_48=281474976710656,e.B_53=9007199254740992,e.B_64=0x10000000000000000,e.ONE_THIRD=.3333333333333333,e.TWO_THIRDS=.6666666666666666,e.ONE_SIXTH=.16666666666666666,e.COS_PI_3=.8660254037844386,e.SIN_2PI_3=.03654595,e.CIRCLE_ALPHA=.5522847498307935,e.ON=!0,e.OFF=!1,e.SHORT_EPSILON=.1,e.PERC_EPSILON=.001,e.EPSILON=1e-4,e.LONG_EPSILON=1e-8,e}();e.GameMath=i}(t.Utils||(t.Utils={})),t.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t){"undefined"==typeof t&&(t=[]),this.c=1,this._data={lipsum:["lorem","ipsum","dolor","sit","amet","consectetur","adipiscing","elit","nunc","sagittis","tortor","ac","mi","pretium","sed","convallis","massa","pulvinar","curabitur","non","turpis","velit","vitae","rutrum","odio","aliquam","sapien","orci","tempor","sed","elementum","sit","amet","tincidunt","sed","risus","etiam","nec","lacus","id","ante","hendrerit","malesuada","donec","porttitor","magna","eget","libero","pharetra","sollicitudin","aliquam","mattis","mattis","massa","et","porta","morbi","vitae","magna","augue","vestibulum","at","lectus","sed","tellus","facilisis","tincidunt","suspendisse","eros","magna","consequat","at","sollicitudin","ac","vestibulum","vel","dolor","in","egestas","lacus","quis","lacus","placerat","et","molestie","ipsum","scelerisque","nullam","sit","amet","tortor","dui","aenean","pulvinar","odio","nec","placerat","fringilla","neque","dolor"]},this.sow(t)}return t.prototype.objType=function(){return"RandomDataGenerator"},t.prototype.uint32=function(){return 4294967296*this.rnd.apply(this)},t.prototype.fract32=function(){return this.rnd.apply(this)+1.1102230246251565e-16*(2097152*this.rnd.apply(this)|0)},t.prototype.rnd=function(){var t=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|t,this.s0=this.s1,this.s1=this.s2,this.s2=t-this.c,this.s2},t.prototype.hash=function(t){var e,i,n;for(n=4022871197,t=t.toString(),i=0;i<t.length;i++)n+=t.charCodeAt(i),e=.02519603282416938*n,n=e>>>0,e-=n,e*=n,n=e>>>0,e-=n,n+=4294967296*e;return 2.3283064365386963e-10*(n>>>0)},t.prototype.sow=function(t){"undefined"==typeof t&&(t=[]),this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1);for(var e,i=0;e=t[i++];)this.s0-=this.hash(e),this.s0+=~~(this.s0<0),this.s1-=this.hash(e),this.s1+=~~(this.s1<0),this.s2-=this.hash(e),this.s2+=~~(this.s2<0)},t.prototype.integer=function(){return this.uint32()},t.prototype.frac=function(){return this.fract32()},t.prototype.real=function(){return this.uint32()+this.fract32()},t.prototype.integerInRange=function(t,e){return Math.floor(this.realInRange(t,e))},t.prototype.realInRange=function(t,e){return t=t||0,e=e||0,this.frac()*(e-t)+t},t.prototype.normal=function(){return 1-2*this.frac()},t.prototype.uuid=function(){var t,e;for(e=t="";t++<36;e+=~t%5|3*t&4?(15^t?8^this.frac()*(20^t?16:4):4).toString(16):"-");return e},t.prototype.pick=function(t){return t[this.integerInRange(0,t.length)]},t.prototype.weightedPick=function(t){return t[~~(Math.pow(this.frac(),2)*t.length)]},t.prototype.word=function(){return this.pick(this._data.lipsum)},t.prototype.words=function(t){"undefined"==typeof t&&(t=3);for(var e=[],i=0;t>i;i++)e.push(this.pick(this._data.lipsum));return e.join(" ")},t.prototype.sentence=function(){var t;return t=this.words(this.integerInRange(2,16)).replace(/[a-z]/,function(t){return t.toUpperCase()}),t+"."},t.prototype.sentences=function(t){"undefined"==typeof t&&(t=3);for(var e=[],i=0;t>i;i++)e.push(this.sentence());return e.join(" ")},t.prototype.timestamp=function(t,e){return"undefined"==typeof t&&(t=9466848e5),"undefined"==typeof e&&(e=1577862e6),this.realInRange(t,e)},t.prototype.angle=function(){return this.integerInRange(-180,180)},t}();t.RandomDataGenerator=e}(t.Utils||(t.Utils={})),t.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(t){this._isSetTimeOut=!1,this.lastTime=0,this.currentTime=0,this.isRunning=!1,this._callback=t;for(var e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;i++)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]}return t.prototype.objType=function(){return"RequestAnimationFrame"},t.prototype.setCallback=function(t){this._callback=t},t.prototype.isUsingSetTimeOut=function(){return this._isSetTimeOut},t.prototype.isUsingRAF=function(){return this._isSetTimeOut===!0?!1:!0},t.prototype.start=function(t){var e=this;"undefined"==typeof t&&(t=null),t&&(this._callback=t),window.requestAnimationFrame?(this._isSetTimeOut=!1,window.requestAnimationFrame(function(){return e.RAFUpdate()})):(this._isSetTimeOut=!0,this._timeOutID=window.setTimeout(function(){return e.SetTimeoutUpdate()},0)),this.isRunning=!0},t.prototype.stop=function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame,this.isRunning=!1},t.prototype.RAFUpdate=function(){var t=this;this.currentTime=Date.now(),this._callback&&this._callback();var e=Math.max(0,16-(this.currentTime-this.lastTime));window.requestAnimationFrame(function(){return t.RAFUpdate()}),this.lastTime=this.currentTime+e},t.prototype.SetTimeoutUpdate=function(){var t=this;this.currentTime=Date.now(),this._callback&&this._callback();var e=Math.max(0,16-(this.currentTime-this.lastTime));this._timeOutID=window.setTimeout(function(){return t.SetTimeoutUpdate()},e),this.lastTime=this.currentTime+e},t}();t.RequestAnimationFrame=e}(t.Utils||(t.Utils={})),t.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(t){!function(t){var e=function(){function t(){}return t.parseVersion=function(t){var e=t.split(".");return{majorVersion:parseInt(e[0]),minorVersion:parseInt(e[1]),patchVersion:parseInt(e[2])}},t.compareVersions=function(e,i){var n=t.parseVersion(e),o=t.parseVersion(i);return n.majorVersion>o.majorVersion?"greater":n.majorVersion<o.majorVersion?"less":n.minorVersion>o.minorVersion?"greater":n.minorVersion<o.minorVersion?"less":n.patchVersion>o.patchVersion?"greater":n.patchVersion<o.patchVersion?"less":"equal"},t.greaterOrEqual=function(e,i){var n=t.compareVersions(e,i);return"greater"==n||"equal"==n},t}();t.Version=e}(t.Utils||(t.Utils={})),t.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(t){t.VERSION="1.0.1",t.RENDERER_CANVAS=0,t.RENDERER_WEBGL=1,t.TARGET_BROWSER=0,t.TARGET_COCOON=1,t.DEBUG_ON=0,t.DEBUG_OFF=1,t.DEVICE=null,t.STATE=0,t.GROUP=2,t.ENTITY=3,t.CAMERA=4,t.HUD_WIDGET=5,t.TILE_LAYER=6;var e=function(){function e(){}return e.prototype.objType=function(){return"GameManager"},e.register=function(e){return t.GameManager._games.push(e)},e.total=function(){return t.GameManager._games.length},e._games=[],e}();t.GameManager=e,t.Plugins={},t.extend=function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i}}(Kiwi||(Kiwi={})),function(t){"use strict";var e={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(e.exports={},define(function(){return e.exports})):e.exports="undefined"!=typeof window?window:t:e.exports=exports,function(t){if(!e)var e=1e-6;if(!i)var i="undefined"!=typeof Float32Array?Float32Array:Array;if(!n)var n=Math.random;var o={};o.setMatrixArrayType=function(t){i=t},"undefined"!=typeof t&&(t.glMatrix=o);var r={};r.create=function(){var t=new i(2);return t[0]=0,t[1]=0,t},r.clone=function(t){var e=new i(2);return e[0]=t[0],e[1]=t[1],e},r.fromValues=function(t,e){var n=new i(2);return n[0]=t,n[1]=e,n},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},r.set=function(t,e,i){return t[0]=e,t[1]=i,t},r.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},r.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},r.sub=r.subtract,r.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},r.mul=r.multiply,r.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},r.div=r.divide,r.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},r.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},r.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},r.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},r.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},r.dist=r.distance,r.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},r.len=r.length,r.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},r.normalize=function(t,e){var i=e[0],n=e[1],o=i*i+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},r.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},r.lerp=function(t,e,i,n){var o=e[0],r=e[1];return t[0]=o+n*(i[0]-o),t[1]=r+n*(i[1]-r),t},r.random=function(t,e){e=e||1;var i=2*n()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},r.transformMat2=function(t,e,i){var n=e[0],o=e[1];return t[0]=i[0]*n+i[2]*o,t[1]=i[1]*n+i[3]*o,t},r.transformMat2d=function(t,e,i){var n=e[0],o=e[1];return t[0]=i[0]*n+i[2]*o+i[4],t[1]=i[1]*n+i[3]*o+i[5],t},r.transformMat3=function(t,e,i){var n=e[0],o=e[1];return t[0]=i[0]*n+i[3]*o+i[6],t[1]=i[1]*n+i[4]*o+i[7],t},r.transformMat4=function(t,e,i){var n=e[0],o=e[1];return t[0]=i[0]*n+i[4]*o+i[12],t[1]=i[1]*n+i[5]*o+i[13],t},r.forEach=function(){var t=r.create();return function(e,i,n,o,r,s){var a,h;for(i||(i=2),n||(n=0),h=o?Math.min(o*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],r(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}(),r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=r);var s={};s.create=function(){var t=new i(3);return t[0]=0,t[1]=0,t[2]=0,t},s.clone=function(t){var e=new i(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},s.fromValues=function(t,e,n){var o=new i(3);return o[0]=t,o[1]=e,o[2]=n,o},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},s.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},s.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},s.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},s.sub=s.subtract,s.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},s.mul=s.multiply,s.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},s.div=s.divide,s.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},s.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},s.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},s.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},s.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(i*i+n*n+o*o)},s.dist=s.distance,s.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return i*i+n*n+o*o},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},s.len=s.length,s.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},s.normalize=function(t,e){var i=e[0],n=e[1],o=e[2],r=i*i+n*n+o*o;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},s.cross=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=i[0],a=i[1],h=i[2];return t[0]=o*h-r*a,t[1]=r*s-n*h,t[2]=n*a-o*s,t},s.lerp=function(t,e,i,n){var o=e[0],r=e[1],s=e[2];return t[0]=o+n*(i[0]-o),t[1]=r+n*(i[1]-r),t[2]=s+n*(i[2]-s),t},s.random=function(t,e){e=e||1;var i=2*n()*Math.PI,o=2*n()-1,r=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(i)*r,t[1]=Math.sin(i)*r,t[2]=o*e,t},s.transformMat4=function(t,e,i){var n=e[0],o=e[1],r=e[2];return t[0]=i[0]*n+i[4]*o+i[8]*r+i[12],t[1]=i[1]*n+i[5]*o+i[9]*r+i[13],t[2]=i[2]*n+i[6]*o+i[10]*r+i[14],t},s.transformMat3=function(t,e,i){var n=e[0],o=e[1],r=e[2];return t[0]=n*i[0]+o*i[3]+r*i[6],t[1]=n*i[1]+o*i[4]+r*i[7],t[2]=n*i[2]+o*i[5]+r*i[8],t},s.transformQuat=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=i[0],a=i[1],h=i[2],u=i[3],c=u*n+a*r-h*o,l=u*o+h*n-s*r,p=u*r+s*o-a*n,d=-s*n-a*o-h*r;return t[0]=c*u+d*-s+l*-h-p*-a,t[1]=l*u+d*-a+p*-s-c*-h,t[2]=p*u+d*-h+c*-a-l*-s,t},s.forEach=function(){var t=s.create();return function(e,i,n,o,r,s){var a,h;for(i||(i=3),n||(n=0),h=o?Math.min(o*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],r(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}(),s.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=s);var a={};a.create=function(){var t=new i(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},a.clone=function(t){var e=new i(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.fromValues=function(t,e,n,o){var r=new i(4);return r[0]=t,r[1]=e,r[2]=n,r[3]=o,r},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.set=function(t,e,i,n,o){return t[0]=e,t[1]=i,t[2]=n,t[3]=o,t},a.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},a.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},a.sub=a.subtract,a.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},a.mul=a.multiply,a.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},a.div=a.divide,a.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},a.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},a.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},a.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},a.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2],r=e[3]-t[3];return Math.sqrt(i*i+n*n+o*o+r*r)},a.dist=a.distance,a.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2],r=e[3]-t[3];return i*i+n*n+o*o+r*r},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],i=t[1],n=t[2],o=t[3];return Math.sqrt(e*e+i*i+n*n+o*o)},a.len=a.length,a.squaredLength=function(t){var e=t[0],i=t[1],n=t[2],o=t[3];return e*e+i*i+n*n+o*o},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},a.normalize=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i*i+n*n+o*o+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},a.lerp=function(t,e,i,n){var o=e[0],r=e[1],s=e[2],a=e[3];return t[0]=o+n*(i[0]-o),t[1]=r+n*(i[1]-r),t[2]=s+n*(i[2]-s),t[3]=a+n*(i[3]-a),t},a.random=function(t,e){return e=e||1,t[0]=n(),t[1]=n(),t[2]=n(),t[3]=n(),a.normalize(t,t),a.scale(t,t,e),t},a.transformMat4=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3];return t[0]=i[0]*n+i[4]*o+i[8]*r+i[12]*s,t[1]=i[1]*n+i[5]*o+i[9]*r+i[13]*s,t[2]=i[2]*n+i[6]*o+i[10]*r+i[14]*s,t[3]=i[3]*n+i[7]*o+i[11]*r+i[15]*s,t},a.transformQuat=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=i[0],a=i[1],h=i[2],u=i[3],c=u*n+a*r-h*o,l=u*o+h*n-s*r,p=u*r+s*o-a*n,d=-s*n-a*o-h*r;return t[0]=c*u+d*-s+l*-h-p*-a,t[1]=l*u+d*-a+p*-s-c*-h,t[2]=p*u+d*-h+c*-a-l*-s,t},a.forEach=function(){var t=a.create();return function(e,i,n,o,r,s){var a,h;for(i||(i=4),n||(n=0),h=o?Math.min(o*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],r(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),a.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=a);var h={};h.create=function(){var t=new i(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},h.clone=function(t){var e=new i(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},h.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},h.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},h.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i*r-o*n;
return s?(s=1/s,t[0]=r*s,t[1]=-n*s,t[2]=-o*s,t[3]=i*s,t):null},h.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},h.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},h.multiply=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=i[0],h=i[1],u=i[2],c=i[3];return t[0]=n*a+o*u,t[1]=n*h+o*c,t[2]=r*a+s*u,t[3]=r*h+s*c,t},h.mul=h.multiply,h.rotate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+o*a,t[1]=n*-a+o*h,t[2]=r*h+s*a,t[3]=r*-a+s*h,t},h.scale=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=i[0],h=i[1];return t[0]=n*a,t[1]=o*h,t[2]=r*a,t[3]=s*h,t},h.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.mat2=h);var u={};u.create=function(){var t=new i(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},u.clone=function(t){var e=new i(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},u.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},u.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],h=i*r-n*o;return h?(h=1/h,t[0]=r*h,t[1]=-n*h,t[2]=-o*h,t[3]=i*h,t[4]=(o*a-r*s)*h,t[5]=(n*s-i*a)*h,t):null},u.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},u.multiply=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],h=e[5],u=i[0],c=i[1],l=i[2],p=i[3],d=i[4],f=i[5];return t[0]=n*u+o*l,t[1]=n*c+o*p,t[2]=r*u+s*l,t[3]=r*c+s*p,t[4]=u*a+l*h+d,t[5]=c*a+p*h+f,t},u.mul=u.multiply,u.rotate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],h=e[5],u=Math.sin(i),c=Math.cos(i);return t[0]=n*c+o*u,t[1]=-n*u+o*c,t[2]=r*c+s*u,t[3]=-r*u+c*s,t[4]=c*a+u*h,t[5]=c*h-u*a,t},u.scale=function(t,e,i){var n=i[0],o=i[1];return t[0]=e[0]*n,t[1]=e[1]*o,t[2]=e[2]*n,t[3]=e[3]*o,t[4]=e[4]*n,t[5]=e[5]*o,t},u.translate=function(t,e,i){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+i[0],t[5]=e[5]+i[1],t},u.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},"undefined"!=typeof t&&(t.mat2d=u);var c={};c.create=function(){var t=new i(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},c.clone=function(t){var e=new i(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},c.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},c.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=c*s-a*u,p=-c*r+a*h,d=u*r-s*h,f=i*l+n*p+o*d;return f?(f=1/f,t[0]=l*f,t[1]=(-c*n+o*u)*f,t[2]=(a*n-o*s)*f,t[3]=p*f,t[4]=(c*i-o*h)*f,t[5]=(-a*i+o*r)*f,t[6]=d*f,t[7]=(-u*i+n*h)*f,t[8]=(s*i-n*r)*f,t):null},c.adjoint=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8];return t[0]=s*c-a*u,t[1]=o*u-n*c,t[2]=n*a-o*s,t[3]=a*h-r*c,t[4]=i*c-o*h,t[5]=o*r-i*a,t[6]=r*u-s*h,t[7]=n*h-i*u,t[8]=i*s-n*r,t},c.determinant=function(t){var e=t[0],i=t[1],n=t[2],o=t[3],r=t[4],s=t[5],a=t[6],h=t[7],u=t[8];return e*(u*r-s*h)+i*(-u*o+s*a)+n*(h*o-r*a)},c.multiply=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],p=i[0],d=i[1],f=i[2],m=i[3],y=i[4],g=i[5],_=i[6],b=i[7],v=i[8];return t[0]=p*n+d*s+f*u,t[1]=p*o+d*a+f*c,t[2]=p*r+d*h+f*l,t[3]=m*n+y*s+g*u,t[4]=m*o+y*a+g*c,t[5]=m*r+y*h+g*l,t[6]=_*n+b*s+v*u,t[7]=_*o+b*a+v*c,t[8]=_*r+b*h+v*l,t},c.mul=c.multiply,c.translate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],p=i[0],d=i[1];return t[0]=n,t[1]=o,t[2]=r,t[3]=s,t[4]=a,t[5]=h,t[6]=p*n+d*s+u,t[7]=p*o+d*a+c,t[8]=p*r+d*h+l,t},c.rotate=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],p=Math.sin(i),d=Math.cos(i);return t[0]=d*n+p*s,t[1]=d*o+p*a,t[2]=d*r+p*h,t[3]=d*s-p*n,t[4]=d*a-p*o,t[5]=d*h-p*r,t[6]=u,t[7]=c,t[8]=l,t},c.scale=function(t,e,i){var n=i[0],o=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=o*e[3],t[4]=o*e[4],t[5]=o*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},c.fromQuat=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i+i,a=n+n,h=o+o,u=i*s,c=i*a,l=i*h,p=n*a,d=n*h,f=o*h,m=r*s,y=r*a,g=r*h;return t[0]=1-(p+f),t[3]=c+g,t[6]=l-y,t[1]=c-g,t[4]=1-(u+f),t[7]=d+m,t[2]=l+y,t[5]=d-m,t[8]=1-(u+p),t},c.normalFromMat4=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=e[9],p=e[10],d=e[11],f=e[12],m=e[13],y=e[14],g=e[15],_=i*a-n*s,b=i*h-o*s,v=i*u-r*s,w=n*h-o*a,x=n*u-r*a,T=o*u-r*h,E=c*m-l*f,P=c*y-p*f,S=c*g-d*f,C=l*y-p*m,R=l*g-d*m,O=p*g-d*y,A=_*O-b*R+v*C+w*S-x*P+T*E;return A?(A=1/A,t[0]=(a*O-h*R+u*C)*A,t[1]=(h*S-s*O-u*P)*A,t[2]=(s*R-a*S+u*E)*A,t[3]=(o*R-n*O-r*C)*A,t[4]=(i*O-o*S+r*P)*A,t[5]=(n*S-i*R-r*E)*A,t[6]=(m*T-y*x+g*w)*A,t[7]=(y*v-f*T-g*b)*A,t[8]=(f*x-m*v+g*_)*A,t):null},c.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},"undefined"!=typeof t&&(t.mat3=c);var l={};l.create=function(){var t=new i(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.clone=function(t){var e=new i(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},l.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],o=e[3],r=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=r,t[11]=e[14],t[12]=o,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},l.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=e[9],p=e[10],d=e[11],f=e[12],m=e[13],y=e[14],g=e[15],_=i*a-n*s,b=i*h-o*s,v=i*u-r*s,w=n*h-o*a,x=n*u-r*a,T=o*u-r*h,E=c*m-l*f,P=c*y-p*f,S=c*g-d*f,C=l*y-p*m,R=l*g-d*m,O=p*g-d*y,A=_*O-b*R+v*C+w*S-x*P+T*E;return A?(A=1/A,t[0]=(a*O-h*R+u*C)*A,t[1]=(o*R-n*O-r*C)*A,t[2]=(m*T-y*x+g*w)*A,t[3]=(p*x-l*T-d*w)*A,t[4]=(h*S-s*O-u*P)*A,t[5]=(i*O-o*S+r*P)*A,t[6]=(y*v-f*T-g*b)*A,t[7]=(c*T-p*v+d*b)*A,t[8]=(s*R-a*S+u*E)*A,t[9]=(n*S-i*R-r*E)*A,t[10]=(f*x-m*v+g*_)*A,t[11]=(l*v-c*x-d*_)*A,t[12]=(a*P-s*C-h*E)*A,t[13]=(i*C-n*P+o*E)*A,t[14]=(m*b-f*w-y*_)*A,t[15]=(c*w-l*b+p*_)*A,t):null},l.adjoint=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=e[9],p=e[10],d=e[11],f=e[12],m=e[13],y=e[14],g=e[15];return t[0]=a*(p*g-d*y)-l*(h*g-u*y)+m*(h*d-u*p),t[1]=-(n*(p*g-d*y)-l*(o*g-r*y)+m*(o*d-r*p)),t[2]=n*(h*g-u*y)-a*(o*g-r*y)+m*(o*u-r*h),t[3]=-(n*(h*d-u*p)-a*(o*d-r*p)+l*(o*u-r*h)),t[4]=-(s*(p*g-d*y)-c*(h*g-u*y)+f*(h*d-u*p)),t[5]=i*(p*g-d*y)-c*(o*g-r*y)+f*(o*d-r*p),t[6]=-(i*(h*g-u*y)-s*(o*g-r*y)+f*(o*u-r*h)),t[7]=i*(h*d-u*p)-s*(o*d-r*p)+c*(o*u-r*h),t[8]=s*(l*g-d*m)-c*(a*g-u*m)+f*(a*d-u*l),t[9]=-(i*(l*g-d*m)-c*(n*g-r*m)+f*(n*d-r*l)),t[10]=i*(a*g-u*m)-s*(n*g-r*m)+f*(n*u-r*a),t[11]=-(i*(a*d-u*l)-s*(n*d-r*l)+c*(n*u-r*a)),t[12]=-(s*(l*y-p*m)-c*(a*y-h*m)+f*(a*p-h*l)),t[13]=i*(l*y-p*m)-c*(n*y-o*m)+f*(n*p-o*l),t[14]=-(i*(a*y-h*m)-s*(n*y-o*m)+f*(n*h-o*a)),t[15]=i*(a*p-h*l)-s*(n*p-o*l)+c*(n*h-o*a),t},l.determinant=function(t){var e=t[0],i=t[1],n=t[2],o=t[3],r=t[4],s=t[5],a=t[6],h=t[7],u=t[8],c=t[9],l=t[10],p=t[11],d=t[12],f=t[13],m=t[14],y=t[15],g=e*s-i*r,_=e*a-n*r,b=e*h-o*r,v=i*a-n*s,w=i*h-o*s,x=n*h-o*a,T=u*f-c*d,E=u*m-l*d,P=u*y-p*d,S=c*m-l*f,C=c*y-p*f,R=l*y-p*m;return g*R-_*C+b*S+v*P-w*E+x*T},l.multiply=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],p=e[9],d=e[10],f=e[11],m=e[12],y=e[13],g=e[14],_=e[15],b=i[0],v=i[1],w=i[2],x=i[3];return t[0]=b*n+v*a+w*l+x*m,t[1]=b*o+v*h+w*p+x*y,t[2]=b*r+v*u+w*d+x*g,t[3]=b*s+v*c+w*f+x*_,b=i[4],v=i[5],w=i[6],x=i[7],t[4]=b*n+v*a+w*l+x*m,t[5]=b*o+v*h+w*p+x*y,t[6]=b*r+v*u+w*d+x*g,t[7]=b*s+v*c+w*f+x*_,b=i[8],v=i[9],w=i[10],x=i[11],t[8]=b*n+v*a+w*l+x*m,t[9]=b*o+v*h+w*p+x*y,t[10]=b*r+v*u+w*d+x*g,t[11]=b*s+v*c+w*f+x*_,b=i[12],v=i[13],w=i[14],x=i[15],t[12]=b*n+v*a+w*l+x*m,t[13]=b*o+v*h+w*p+x*y,t[14]=b*r+v*u+w*d+x*g,t[15]=b*s+v*c+w*f+x*_,t},l.mul=l.multiply,l.translate=function(t,e,i){var n,o,r,s,a,h,u,c,l,p,d,f,m=i[0],y=i[1],g=i[2];return e===t?(t[12]=e[0]*m+e[4]*y+e[8]*g+e[12],t[13]=e[1]*m+e[5]*y+e[9]*g+e[13],t[14]=e[2]*m+e[6]*y+e[10]*g+e[14],t[15]=e[3]*m+e[7]*y+e[11]*g+e[15]):(n=e[0],o=e[1],r=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],p=e[9],d=e[10],f=e[11],t[0]=n,t[1]=o,t[2]=r,t[3]=s,t[4]=a,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+a*y+l*g+e[12],t[13]=o*m+h*y+p*g+e[13],t[14]=r*m+u*y+d*g+e[14],t[15]=s*m+c*y+f*g+e[15]),t},l.scale=function(t,e,i){var n=i[0],o=i[1],r=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.rotate=function(t,i,n,o){var r,s,a,h,u,c,l,p,d,f,m,y,g,_,b,v,w,x,T,E,P,S,C,R,O=o[0],A=o[1],M=o[2],D=Math.sqrt(O*O+A*A+M*M);return Math.abs(D)<e?null:(D=1/D,O*=D,A*=D,M*=D,r=Math.sin(n),s=Math.cos(n),a=1-s,h=i[0],u=i[1],c=i[2],l=i[3],p=i[4],d=i[5],f=i[6],m=i[7],y=i[8],g=i[9],_=i[10],b=i[11],v=O*O*a+s,w=A*O*a+M*r,x=M*O*a-A*r,T=O*A*a-M*r,E=A*A*a+s,P=M*A*a+O*r,S=O*M*a+A*r,C=A*M*a-O*r,R=M*M*a+s,t[0]=h*v+p*w+y*x,t[1]=u*v+d*w+g*x,t[2]=c*v+f*w+_*x,t[3]=l*v+m*w+b*x,t[4]=h*T+p*E+y*P,t[5]=u*T+d*E+g*P,t[6]=c*T+f*E+_*P,t[7]=l*T+m*E+b*P,t[8]=h*S+p*C+y*R,t[9]=u*S+d*C+g*R,t[10]=c*S+f*C+_*R,t[11]=l*S+m*C+b*R,i!==t&&(t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t)},l.rotateX=function(t,e,i){var n=Math.sin(i),o=Math.cos(i),r=e[4],s=e[5],a=e[6],h=e[7],u=e[8],c=e[9],l=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*o+u*n,t[5]=s*o+c*n,t[6]=a*o+l*n,t[7]=h*o+p*n,t[8]=u*o-r*n,t[9]=c*o-s*n,t[10]=l*o-a*n,t[11]=p*o-h*n,t},l.rotateY=function(t,e,i){var n=Math.sin(i),o=Math.cos(i),r=e[0],s=e[1],a=e[2],h=e[3],u=e[8],c=e[9],l=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*o-u*n,t[1]=s*o-c*n,t[2]=a*o-l*n,t[3]=h*o-p*n,t[8]=r*n+u*o,t[9]=s*n+c*o,t[10]=a*n+l*o,t[11]=h*n+p*o,t},l.rotateZ=function(t,e,i){var n=Math.sin(i),o=Math.cos(i),r=e[0],s=e[1],a=e[2],h=e[3],u=e[4],c=e[5],l=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*o+u*n,t[1]=s*o+c*n,t[2]=a*o+l*n,t[3]=h*o+p*n,t[4]=u*o-r*n,t[5]=c*o-s*n,t[6]=l*o-a*n,t[7]=p*o-h*n,t},l.fromRotationTranslation=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=n+n,h=o+o,u=r+r,c=n*a,l=n*h,p=n*u,d=o*h,f=o*u,m=r*u,y=s*a,g=s*h,_=s*u;return t[0]=1-(d+m),t[1]=l+_,t[2]=p-g,t[3]=0,t[4]=l-_,t[5]=1-(c+m),t[6]=f+y,t[7]=0,t[8]=p+g,t[9]=f-y,t[10]=1-(c+d),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},l.fromQuat=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i+i,a=n+n,h=o+o,u=i*s,c=i*a,l=i*h,p=n*a,d=n*h,f=o*h,m=r*s,y=r*a,g=r*h;return t[0]=1-(p+f),t[1]=c+g,t[2]=l-y,t[3]=0,t[4]=c-g,t[5]=1-(u+f),t[6]=d+m,t[7]=0,t[8]=l+y,t[9]=d-m,t[10]=1-(u+p),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.frustum=function(t,e,i,n,o,r,s){var a=1/(i-e),h=1/(o-n),u=1/(r-s);return t[0]=2*r*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*r*h,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(o+n)*h,t[10]=(s+r)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*r*2*u,t[15]=0,t},l.perspective=function(t,e,i,n,o){var r=1/Math.tan(e/2),s=1/(n-o);return t[0]=r/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+n)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*n*s,t[15]=0,t},l.ortho=function(t,e,i,n,o,r,s){var a=1/(e-i),h=1/(n-o),u=1/(r-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*a,t[13]=(o+n)*h,t[14]=(s+r)*u,t[15]=1,t},l.lookAt=function(t,i,n,o){var r,s,a,h,u,c,p,d,f,m,y=i[0],g=i[1],_=i[2],b=o[0],v=o[1],w=o[2],x=n[0],T=n[1],E=n[2];return Math.abs(y-x)<e&&Math.abs(g-T)<e&&Math.abs(_-E)<e?l.identity(t):(p=y-x,d=g-T,f=_-E,m=1/Math.sqrt(p*p+d*d+f*f),p*=m,d*=m,f*=m,r=v*f-w*d,s=w*p-b*f,a=b*d-v*p,m=Math.sqrt(r*r+s*s+a*a),m?(m=1/m,r*=m,s*=m,a*=m):(r=0,s=0,a=0),h=d*a-f*s,u=f*r-p*a,c=p*s-d*r,m=Math.sqrt(h*h+u*u+c*c),m?(m=1/m,h*=m,u*=m,c*=m):(h=0,u=0,c=0),t[0]=r,t[1]=h,t[2]=p,t[3]=0,t[4]=s,t[5]=u,t[6]=d,t[7]=0,t[8]=a,t[9]=c,t[10]=f,t[11]=0,t[12]=-(r*y+s*g+a*_),t[13]=-(h*y+u*g+c*_),t[14]=-(p*y+d*g+f*_),t[15]=1,t)},l.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},"undefined"!=typeof t&&(t.mat4=l);var p={};p.create=function(){var t=new i(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},p.rotationTo=function(){var t=s.create(),e=s.fromValues(1,0,0),i=s.fromValues(0,1,0);return function(n,o,r){var a=s.dot(o,r);return-.999999>a?(s.cross(t,e,o),s.length(t)<1e-6&&s.cross(t,i,o),s.normalize(t,t),p.setAxisAngle(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(s.cross(t,o,r),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,p.normalize(n,n))}}(),p.setAxes=function(){var t=c.create();return function(e,i,n,o){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=o[0],t[4]=o[1],t[7]=o[2],t[2]=i[0],t[5]=i[1],t[8]=i[2],p.normalize(e,p.fromMat3(e,t))}}(),p.clone=a.clone,p.fromValues=a.fromValues,p.copy=a.copy,p.set=a.set,p.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},p.setAxisAngle=function(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t},p.add=a.add,p.multiply=function(t,e,i){var n=e[0],o=e[1],r=e[2],s=e[3],a=i[0],h=i[1],u=i[2],c=i[3];return t[0]=n*c+s*a+o*u-r*h,t[1]=o*c+s*h+r*a-n*u,t[2]=r*c+s*u+n*h-o*a,t[3]=s*c-n*a-o*h-r*u,t},p.mul=p.multiply,p.scale=a.scale,p.rotateX=function(t,e,i){i*=.5;var n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+s*a,t[1]=o*h+r*a,t[2]=r*h-o*a,t[3]=s*h-n*a,t},p.rotateY=function(t,e,i){i*=.5;var n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h-r*a,t[1]=o*h+s*a,t[2]=r*h+n*a,t[3]=s*h-o*a,t},p.rotateZ=function(t,e,i){i*=.5;var n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+o*a,t[1]=o*h-n*a,t[2]=r*h+s*a,t[3]=s*h-r*a,t},p.calculateW=function(t,e){var i=e[0],n=e[1],o=e[2];return t[0]=i,t[1]=n,t[2]=o,t[3]=-Math.sqrt(Math.abs(1-i*i-n*n-o*o)),t},p.dot=a.dot,p.lerp=a.lerp,p.slerp=function(t,e,i,n){var o,r,s,a,h,u=e[0],c=e[1],l=e[2],p=e[3],d=i[0],f=i[1],m=i[2],y=i[3];return r=u*d+c*f+l*m+p*y,0>r&&(r=-r,d=-d,f=-f,m=-m,y=-y),1-r>1e-6?(o=Math.acos(r),s=Math.sin(o),a=Math.sin((1-n)*o)/s,h=Math.sin(n*o)/s):(a=1-n,h=n),t[0]=a*u+h*d,t[1]=a*c+h*f,t[2]=a*l+h*m,t[3]=a*p+h*y,t},p.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],s=i*i+n*n+o*o+r*r,a=s?1/s:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-o*a,t[3]=r*a,t},p.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},p.length=a.length,p.len=p.length,p.squaredLength=a.squaredLength,p.sqrLen=p.squaredLength,p.normalize=a.normalize,p.fromMat3=function(){var t="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(e,i){var n,o=i[0]+i[4]+i[8];if(o>0)n=Math.sqrt(o+1),e[3]=.5*n,n=.5/n,e[0]=(i[7]-i[5])*n,e[1]=(i[2]-i[6])*n,e[2]=(i[3]-i[1])*n;else{var r=0;i[4]>i[0]&&(r=1),i[8]>i[3*r+r]&&(r=2);var s=t[r],a=t[s];n=Math.sqrt(i[3*r+r]-i[3*s+s]-i[3*a+a]+1),e[r]=.5*n,n=.5/n,e[3]=(i[3*a+s]-i[3*s+a])*n,e[s]=(i[3*s+r]+i[3*r+s])*n,e[a]=(i[3*a+r]+i[3*r+a])*n}return e}}(),p.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=p)}(e.exports)}(this);