define("common/Common",[],function(){var e=window.Common={};return e.eachB2Body=function(e){var t=world.GetBodyList();while(t){var n=t,t=t.GetNext();n.GetUserData()&&n.extType!="wall"&&e(n)}},e.setCenterPositionToSprite=function(e,t){e.x=t.x-e.width/2,e.y=t.y-e.height/2},e.hasMoonCake=function(){var t=!1;return e.eachB2Body(function(e){e.gameCfg&&e.gameCfg.extType=="mooncake"&&(t=!0)}),t},e.removeBody=function(e){var t=world.GetBodyList();while(t){var n=t,t=t.GetNext();if(n.GetUserData()&&n==e){world.DestroyBody(e);break}}},e.setJoyDamping=function(){var e=0;window.joyDampingInterval=window.setInterval(function(){e+=.1,window.B2Joy.SetLinearDamping(e);var t=B2Joy.GetLinearVelocity();t=Math.sqrt(t.x*t.x+t.y*t.y),t<.02&&window.B2Joy.SetAwake(0)},100)},e.unSetJoyDamping=function(){window.clearInterval(window.joyDampingInterval),window.B2Joy.SetLinearDamping(0)},e.setMoonRotationNoneFix=function(){e.eachB2Body(function(e){e.gameCfg&&e.gameCfg.extType=="mooncake"&&e.SetFixedRotation(0)})},e.calculateDamage=function(e){var t=e.GetLinearVelocity();return t=Math.sqrt(t.x*t.x+t.y*t.y),t*e.GetMass()},e.isAllSleep=function(){var t=!0;return e.eachB2Body(function(e){e.IsAwake()&&(t=!1)}),t},e.triangleDistance=function(e,t){t||(t=window.GLOBAL.joyPosition);var n=0;return n=Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)),n},e.triangleAngle=function(e,t){return t||(t=window.GLOBAL.joyPosition),Math.atan2(t.y-e.y,t.x-e.x)},e.triangleAngleDeg=function(e,t){var n=Comment.triangleAngle(e,t);return n*180/Math.PI},e.calculatePosition=function(t){if(e.triangleDistance(t)<=window.GLOBAL.maxDistance)return t;var n=e.triangleAngle(t);return{x:window.GLOBAL.joyPosition.x-window.GLOBAL.maxDistance*Math.cos(n),y:window.GLOBAL.joyPosition.y-window.GLOBAL.maxDistance*Math.sin(n)}},e.getPower=function(t){var n=e.triangleDistance(t);n=n>window.GLOBAL.maxDistance?window.GLOBAL.maxDistance:n,n=n*window.GLOBAL.maxPower/window.GLOBAL.maxDistance;var r=e.triangleAngle(t),i=n*Math.cos(r),s=n*Math.sin(r);return{x:i,y:s}},e.onFinish=function(t){var n=0;window.clearInterval(window.finsishInterval),window.finsishInterval=window.setInterval(function(){e.hasMoonCake()||(t(),window.clearInterval(window.finsishInterval));if(window.GLOBAL.joyCount==0){n++;if(e.isAllSleep()){window.clearInterval(window.finsishInterval),t();return}if(n>120){window.clearInterval(window.finsishInterval),t();return}}},100)},e.putToCenter=function(e){e.transform.x=(window.GLOBAL.canvasSize.width-e.width)/2,e.transform.y=(window.GLOBAL.canvasSize.height-e.height)/2},e.kilakila=function(e){if(!window.s_gl)return;var t=new Kiwi.GameObjects.StatelessParticles(e,e.textures.particle3,window.GLOBAL.canvasSize.width/2,0,window.GLOBAL.particleCfg3);t.startEmitting(!0),e.addChild(t)},e.fireExplode=function(e,t,n){if(!window.s_gl)return;var r=new Kiwi.GameObjects.StatelessParticles(e,e.textures.particle1,t,n,window.GLOBAL.particleCfg1);r.startEmitting(!1),e.addChild(r)},e.garbageArray=[],e.garbageArray1=[],e.releaseGarbage=function(){for(var t=0;t<e.garbageArray.length;t++)window.clearTimeout(e.garbageArray.pop());for(var t=0;t<e.garbageArray1.length;t++)e.garbageArray1[t].stop()},e.getSeedLottery=function(){return 1},e.showFireWorks=function(t,n,r,i,s){if(!window.s_gl)return;var o=new Kiwi.GameObjects.StatelessParticles(t,t.textures.particle2,n,window.GLOBAL.canvasSize.height+100,window.GLOBAL.particleCfg2);o.startEmitting(!0);var u=window.setTimeout(function(){s?t.addChild(o):t.addChildBefore(o,t.mainbg);var i=gameState.game.tweens.create(o);i.to({x:n,y:r},700,Kiwi.Animations.Tweens.Easing.Linear.None,!1),i.onComplete(function(){var e=new Kiwi.GameObjects.StatelessParticles(t,t.textures.particle1,n+70,r+50,window.GLOBAL.particleCfg1);e.startEmitting(!1),s?t.addChild(e):t.addChildBefore(e,t.mainbg),o.stopEmitting(!1,!1)}),i.start(),e.garbageArray1.push(i)},i);e.garbageArray.push(u)},e.showStageClearFireWorks=function(t){if(!window.s_gl)return;e.showFireWorks(gameState,170,80,1e3,t),e.showFireWorks(gameState,850,140,1400,t),e.showFireWorks(gameState,440,100,1800,t),e.showFireWorks(gameState,1028,160,2e3,t)},e}),define("view/b2conponent/WallCreate",[],function(){function e(){var e=new b2BodyDef;e.type=b2Body.b2_staticBody;var t=new b2FixtureDef;t.density=0,t.friction=.9,t.restitution=.2,t.shape=new b2PolygonShape,t.shape.SetAsBox(window.GLOBAL.canvasSize.width*999/2/30,.5/30),e.position.Set(window.GLOBAL.canvasSize.width/2/30,(window.GLOBAL.canvasSize.height-75)/30);var n=world.CreateBody(e);return n.extType="wall",n.CreateFixture(t),n.SetUserData(1),n}return e}),define("view/b2conponent/BodyCreate",[],function(){var e=function(e){var t=new b2BodyDef;t.type=b2Body.b2_dynamicBody;var n=new b2FixtureDef;n.density=e.density,n.friction=e.friction,n.restitution=e.restitution,n.shape=new b2PolygonShape,n.shape.SetAsBox(e.width/2/window.GLOBAL.PTM_RATIO,e.height/2/window.GLOBAL.PTM_RATIO),t.position.Set(e.x/window.GLOBAL.PTM_RATIO,e.y/window.GLOBAL.PTM_RATIO);var r=world.CreateBody(t);return r.CreateFixture(n),r.SetAngle(e.rotation*Math.PI/180),r.gameCfg=e,r.SetUserData(1),window.B=r,r};return window.BoardCreate=e,e}),define("view/conponent/Smoke",[],function(){var e={};return window.Smoke=e,e.showAt=function(e){var t=new Kiwi.GameObjects.Sprite(gameState,gameState.textures.smoke_moon_cake_expload,e.x,e.y,!0);t.counter=0,t.animation.add("expload",[0,1,2],.1,!0),t.animation.play("expload"),gameState.addChild(t),t.animation.getAnimation("expload").onUpdate.add(function(){t.counter++,t.counter>=3&&(t.animation.stop(),window.setTimeout(function(){t.parent.removeChild(t)},1))},gameState)},e.showBy=function(t){var n=t.box.bounds.width,r=t.box.bounds.height,i=t.x,s=t.y;e.showAt({x:i+n/2,y:s+r/2})},e}),define("view/b2conponent/MoonCakeCreate",["../conponent/Smoke"],function(e){var t=function(t){var n=new b2BodyDef;n.type=b2Body.b2_dynamicBody;var r=new b2FixtureDef;r.density=t.density,r.friction=t.friction,r.restitution=t.restitution,r.shape=new b2CircleShape,r.shape.SetRadius(t.radius/window.GLOBAL.PTM_RATIO),n.fixedRotation=!0,n.position.Set(t.x/window.GLOBAL.PTM_RATIO,t.y/window.GLOBAL.PTM_RATIO);var i=world.CreateBody(n);return i.CreateFixture(r),i.SetAngle(t.rotation*Math.PI/180),i.gameCfg=t,i.SetUserData(1),i.explod=function(){window.setTimeout(function(){world.DestroyBody(i);var t=i.GetUserData();e.showBy(t),t.parent.removeChild(t)},0)},window.MoonCake=i,n};return t}),define("view/b2conponent/JoyCreate",[],function(){var e=function(e){var t=new b2BodyDef;t.type=b2Body.b2_dynamicBody;var n=new b2FixtureDef;n.density=e.density,n.friction=e.friction,n.restitution=e.restitution,n.shape=new b2CircleShape,n.shape.SetRadius(e.radius/window.GLOBAL.PTM_RATIO),t.position.Set(e.x/window.GLOBAL.PTM_RATIO,e.y/window.GLOBAL.PTM_RATIO);var r=world.CreateBody(t);return r.CreateFixture(n),r.SetAngle(e.rotation*Math.PI/180),r.gameCfg=e,window.B2Joy=r,r.extType="joy",t};return e}),define("view/b2conponent/SlingshotCreate",[],function(){function e(){var e=new b2BodyDef;e.type=b2Body.b2_staticBody;var t=new b2FixtureDef;t.density=0,t.friction=.9,t.restitution=.2,t.shape=new b2PolygonShape,t.shape.SetAsBox(25/30,.5/30),e.position.Set(7.5,340/30);var n=world.CreateBody(e);return n.extType="slingshot",n.CreateFixture(t),n.SetUserData(1),window.SS=n,n}return e}),define("view/conponent/PBar",[],function(){var e={};return e.show=function(e){var t=new Kiwi.GameObjects.StaticImage(e,e.textures.pbarbg,200,60);e.addChild(t);var n=new Kiwi.GameObjects.Sprite(e,e.textures.pbarjoy,t.x+50*window.GLOBAL.CurrentStage,t.y);e.addChild(n);for(var r=0;r<window.GLOBAL.CurrentStage;r++){var i=new Kiwi.GameObjects.Sprite(e,e.textures.pbarover,t.x+50*r,t.y);e.addChild(i)}},window.PBar=e,e}),define("view/conponent/base/sharePanel",[],function(){var e={};return e.showAtPosition=function(t,n){e.remove();var r=[' <div id="share_a" >         ','     <a class="sina"></a>    ','     <a class="douban"></a>  ','     <a class="tx"></a>      ','     <a class="renren"></a>  '," </div>                      "].join("");$("body").prepend(r),$("#share_a").css({left:t.x+n.x+"px",top:t.y+n.y+"px"}),$("#share_a a").click(function(e){switch($(this).attr("class")){case"sina":Share.openSina(),dc.log(null,5,1);break;case"douban":Share.openDouBan(),dc.log(null,5,2);break;case"tx":Share.openTqq(),dc.log(null,5,3);break;case"renren":Share.openRenRen(),dc.log(null,5,4)}})},e.remove=function(){$("#share_a").remove()},e.onOver=function(e){e.transform.scale=1.15},e.onOut=function(e){e.transform.scale=1},e}),define("view/conponent/NextStagePanel",["./base/sharePanel"],function(e){var t={};return t.show=function(t){var n=new Kiwi.GameObjects.StaticImage(t,t.textures.againPanel0,0,0);Common.putToCenter(n),n.transform.scale=0,t.addChild(n);var r=t.game.tweens.create(n);r.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),r.onComplete(function(){e.showAtPosition(n,{x:47,y:250}),window.setTimeout(function(){var e=new Kiwi.GameObjects.Sprite(t,t.textures.nextBtn,n.x+120,n.y+150);e.transform.scale=0,t.addChild(e);var r=t.game.tweens.create(e);r.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),r.onComplete(function(){}),r.start(),e.input.onRelease.add(function(){window.setTimeout(function(){window.GLOBAL.CurrentStage++,Common.releaseGarbage(),initWorld(),t.clear(),t.create()},1)},t),t.addChild(e)},500)}),r.start()},window.NextStagePanel=t,t}),define("view/conponent/AgainStagePanel",["./base/sharePanel"],function(e){var t={};return t.show=function(t){var n=new Kiwi.GameObjects.StaticImage(t,t.textures.againPanel1,0,0);Common.putToCenter(n),n.transform.scale=0,t.addChild(n);var r=t.game.tweens.create(n);r.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),r.onComplete(function(){e.showAtPosition(n,{x:47,y:250});var r=new Kiwi.GameObjects.Sprite(t,t.textures.againBtn,n.x+120,n.y+150);r.transform.scale=0,t.addChild(r);var i=t.game.tweens.create(r);i.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),i.onComplete(function(){}),i.start(),r.input.onRelease.add(function(){window.setTimeout(function(){initWorld(),t.clear(),t.create(window.GLOBAL.STAGE_CFG.idx)},1)},t),t.addChild(r)}),r.start()},window.AgainStagePanel=t,t}),define("view/conponent/GoGetRewardPanel",["../conponent/LotteryPanel","./base/sharePanel"],function(e,t){var n={};return n.show=function(e){var n=new Kiwi.GameObjects.StaticImage(e,e.textures.success_panel,0,0);Common.putToCenter(n),n.transform.scale=0,e.addChild(n);var r=e.game.tweens.create(n);r.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),r.onComplete(function(){t.showAtPosition(n,{x:47,y:275}),window.setTimeout(function(){var t=new Kiwi.GameObjects.Sprite(e,e.textures.success_get_cupon_btn,n.x+100,n.y+175);t.transform.scale=0,e.addChild(t);var r=e.game.tweens.create(t);r.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),r.onComplete(function(){}),r.start(),t.input.onRelease.add(function(){var e='<iframe  id="ifr_inner" width="100%" height="450" src="http://sale.jd.com/act/SXNkh0rO3YgT.html" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="yes" allowtransparency="yes"></iframe>';$("body").html(e)},e),e.addChild(t)},500)}),r.start()},window.GoGetRewardPanel=n,n}),define("view/conponent/SorryPanel",["../conponent/LotteryPanel"],function(e){var t={};return t.show=function(e){var t=new Kiwi.GameObjects.StaticImage(e,e.textures.fail_panel,0,0);Common.putToCenter(t),t.transform.scale=0,e.addChild(t);var n=e.game.tweens.create(t);n.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),n.onComplete(function(){window.setTimeout(function(){var n=new Kiwi.GameObjects.Sprite(e,e.textures.battle_again_btn,t.x+100,t.y+160);n.transform.scale=0,e.addChild(n);var r=e.game.tweens.create(n);r.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),r.onComplete(function(){}),r.start(),n.input.onRelease.add(function(){location.reload()},e),e.addChild(n)},500)}),n.start()},window.SorryPanel=t,t}),define("view/conponent/LotteryPanel",["../conponent/GoGetRewardPanel","../conponent/SorryPanel"],function(){var e={};return e.show=function(e){window.lpanel=new Kiwi.GameObjects.StaticImage(e,e.textures.lottery_panel,0,0),lpanel.transform.scale=.1,e.addChild(lpanel);var t=new Kiwi.GameObjects.StaticImage(e,e.textures.lottery_title,450,50);e.addChild(t);var n=e.game.tweens.create(lpanel);n.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),n.onComplete(function(){}),n.start();var r=[];for(var i=0;i<3;i++){var s=this;window.setTimeout(function(t){return function(){var n=new Kiwi.GameObjects.Sprite(e,e.textures.deng,300+290*t+1,200);n.transform.scale=.5;var i=e.game.tweens.create(n);i.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),i.onComplete(function(){}),i.start(),e.addChild(n),r.push(n),n.input.onUp.add(function(t){n.input.onUp.removeAll();var i=Common.getSeedLottery(),s=e.game.tweens.create(t);s.to({x:600,y:205},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),s.onComplete(function(n){var r=new Kiwi.GameObjects.Sprite(e,e.textures["deng"+i],t.x,200);r.alpha=0,e.addChild(r);var s=e.game.tweens.create(r);s.to({alpha:1},500,Kiwi.Animations.Tweens.Easing.Linear.None,!1),s.onComplete(function(e){}),s.start();var o=e.game.tweens.create(t);o.to({alpha:0},500,Kiwi.Animations.Tweens.Easing.Linear.None,!1),o.onComplete(function(e){}),o.start(),window.setTimeout(function(){i?(GoGetRewardPanel.show(e),dc.log(null,6,1)):(SorryPanel.show(e),dc.log(null,6,0))},1500)}),s.start();for(var o=0;o<r.length;o++){var u=r[o];if(u!=t){var a=e.game.tweens.create(u);a.to({alpha:0,scaleX:0,scaleY:0},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),a.onComplete(function(e){}),a.start()}}},s)}}(i),(i+1)*200)}},window.LotteryPanel=e,e}),define("view/conponent/StageOverPanel",["../conponent/LotteryPanel","./base/sharePanel"],function(e,t){var n={};return n.show=function(n){var r=new Kiwi.GameObjects.StaticImage(n,n.textures.againPanel2,0,0);Common.putToCenter(r),r.transform.scale=0,n.addChild(r);var i=n.game.tweens.create(r);i.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),i.onComplete(function(){t.showAtPosition(r,{x:47,y:250}),window.setTimeout(function(){var i=new Kiwi.GameObjects.Sprite(n,n.textures.getRewardBtn,r.x+120,r.y+150);i.transform.scale=0,n.addChild(i);var s=n.game.tweens.create(i);s.to({scaleX:1,scaleY:1},300,Kiwi.Animations.Tweens.Easing.Linear.None,!1),s.onComplete(function(){}),s.start(),i.input.onRelease.add(function(){window.setTimeout(function(){e.show(n),i.parent.removeChild(i),t.remove()},1)},n),n.addChild(i)},500)}),i.start()},window.StageOverPanel=n,n}),define("view/states/gameState",["../../common/Common","../b2conponent/WallCreate","../b2conponent/BodyCreate","../b2conponent/MoonCakeCreate","../b2conponent/JoyCreate","../b2conponent/SlingshotCreate","../conponent/PBar","../conponent/NextStagePanel","../conponent/AgainStagePanel","../conponent/StageOverPanel","../conponent/LotteryPanel","../conponent/Smoke"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=window.gameState=new Kiwi.State("gameState");return h.preload=function(){Kiwi.State.prototype.preload.call(this);var e=this;this.addImage("s_sina","img/s_sina.png"),this.addImage("s_douban","img/s_douban.png"),this.addImage("s_tx","img/s_tx.png"),this.addImage("s_renren","img/s_renren.png"),this.addImage("particle1","img/particle_01.png"),this.addImage("particle2","img/particle_02.png"),this.addImage("particle3","img/particle_03.png"),this.addImage("mainbg","img/mainbg.jpg"),this.addImage("sling1","img/sling1.png"),this.addImage("sling2","img/sling2.png"),this.addImage("againPanel0","img/again/againPanel0.png"),this.addImage("againPanel1","img/again/againPanel1.png"),this.addImage("againPanel2","img/again/againPanel2.png"),this.addImage("againPanel1","img/again/againPanel1.png"),this.addImage("againBtn","img/again/againBtn.png"),this.addImage("getRewardBtn","img/again/getRewardBtn.png"),this.addImage("nextBtn","img/again/nextBtn.png"),this.addImage("lottery_panel","img/lottery_panel.jpg"),this.addImage("pbarover","img/pbar/pbarover.png"),this.addImage("pbarbg","img/pbar/pbarbg.png"),this.addImage("pbarjoy","img/pbar/pbarjoy.png"),this.addImage("deng","img/deng/deng.png"),this.addImage("deng0","img/deng/deng0.png"),this.addImage("deng1","img/deng/deng1.png"),this.addImage("success_get_cupon_btn","img/deng/success_get_cupon_btn.png"),this.addImage("lottery_title","img/deng/lottery_title.png"),this.addImage("success_panel","img/deng/success_panel.png"),this.addImage("fail_panel","img/deng/fail_panel.png"),this.addImage("battle_again_btn","img/deng/battle_again_btn.png"),this.addImage("sling_mid","img/sling_mid.png"),this.addImage("slingTuo","img/slingTuo.png"),this.addImage("particle1","img/particle_01.png"),this.addImage("white_dot","img/white_dot.png"),this.addSpriteSheet("joy","img/joy.png",65,65),this.addSpriteSheet("smoke_moon_cake_expload","img/smoke_moon_cake_expload.png",42,42),this.addSpriteSheet("moon_cake_g","img/moon_cake_g.png",40,40),this.addSpriteSheet("moon_cake_p","img/moon_cake_p.png",50,50),this.addSpriteSheet("moon_cake_y","img/moon_cake_y.png",40,40);for(var t=1;t<=window.GLOBAL.StageCount;t++)_.each(window.Stages["stage"+t].bodys,function(t){t.extType!="mooncake"&&e.addImage(t.asset,"img/stage/"+t.asset+".png")})},h.create=function(i){$("#share_a").remove(),window.___joyRemoveTimeOut=0,window.Stage_Start_DateTime=new Date;var s=$.cookie("storyScenceOpened");$(document).ready(function(){s}),Kiwi.State.prototype.create.call(this),e.garbageArray=[],e.garbageArray1=[],window.JOY_RELOAD_INTERVAL&&window.clearTimeout(window.JOY_RELOAD_INTERVAL);var l=window.parent.$("#loadingBg");l.size()&&(l.find("#startBtn").attr("src","img/loading/startBtn.png").click(function(e){l.fadeOut(400,function(){l.remove(),$.cookie("storyScenceOpened","1",{expires:30,path:"/"})})}),window.setTimeout(function(){window.parent.$("#loadingBg").fadeOut(300,function(){window.parent.$("#loadingBg").remove()})},1e4));var c=this,p=window.GLOBAL.getStageConfigObject(i);window.GLOBAL.joyCount=p.joyCount,window.GLOBAL.STAGE_CFG=p,window.GLOBAL.UserPlayedStages.push(p.idx),_.each(p.bodys,function(e){switch(e.extType){case"body":n(e);break;case"mooncake":r(e)}}),t(),e.showStageClearFireWorks(0),e.onFinish(function(){var t=new Date,n=t-window.Stage_Start_DateTime;e.hasMoonCake()?(a.show(h),dc.log(null,4,window.GLOBAL.STAGE_CFG.idx+"_0_"+n)):(dc.log(null,4,window.GLOBAL.STAGE_CFG.idx+"_1_"+n),window.GLOBAL.CurrentStage==2?(window.setTimeout(function(){e.showStageClearFireWorks(1)},1e3),window.setTimeout(function(){f.show(h)},2e3)):(window.setTimeout(function(){e.showStageClearFireWorks(1)},1e3),window.setTimeout(function(){u.show(h)},2e3)))}),this.mainbg=new Kiwi.GameObjects.StaticImage(this,this.textures.mainbg,0,0),this.addChild(this.mainbg),this.initSling(),this.initJoys(),this.joyOnSling(),e.eachB2Body(function(t){if(t.extType!="joy"){var n=new Kiwi.GameObjects.Sprite(c,c.textures[t.gameCfg.asset],0,0);e.setCenterPositionToSprite(n,{x:t.gameCfg.x,y:t.gameCfg.y}),c.addChild(n),t.SetUserData(n)}}),e.kilakila(this),o.show(this)},h.addSlingMid=function(){this.slingMid1=new Kiwi.GameObjects.Sprite(this,this.textures.sling_mid,window.GLOBAL.joyPosition.x-15,window.GLOBAL.joyPosition.y),this.slingMid1.origonalPosition={x:window.GLOBAL.joyPosition.x-15,y:window.GLOBAL.joyPosition.y},this.slingMid2=new Kiwi.GameObjects.Sprite(this,this.textures.sling_mid,window.GLOBAL.joyPosition.x+20,window.GLOBAL.joyPosition.y),this.slingMid2.origonalPosition={x:window.GLOBAL.joyPosition.x+20,y:window.GLOBAL.joyPosition.y},this.slingMidTuo=new Kiwi.GameObjects.Sprite(this,this.textures.slingTuo,window.GLOBAL.joyPosition.x,window.GLOBAL.joyPosition.y),this.addChild(this.slingMid1),this.addChild(this.slingMid2),this.addChild(this.slingMidTuo)},h.removeSlingMid=function(){this.slingMid1&&(this.slingMid1.parent.removeChild(this.slingMid1),this.slingMid2.parent.removeChild(this.slingMid2),this.slingMidTuo.parent.removeChild(this.slingMidTuo))},h.adjustSlingMid=function(){function t(t){var n={x:window.joy.x+32.5,y:window.joy.y+32.5},r=e.triangleAngle(n),i=e.triangleDistance(n)+32.5,s=window.GLOBAL.joyPosition.x-i*Math.cos(r),o=window.GLOBAL.joyPosition.y-i*Math.sin(r),u={x:s,y:o};h.slingMidTuo.transform.x=s-5,h.slingMidTuo.transform.y=o-10,h.slingMidTuo.rotation=r;var a=e.triangleDistance(u,t.origonalPosition),f=a/20,l=20/a;t.transform.scaleY=l;var c=e.triangleAngle(u,t.origonalPosition);t.transform.x=t.origonalPosition.x-Math.cos(c)*a/2-10,t.transform.y=t.origonalPosition.y-Math.sin(c)*a/2-10,t.transform.scaleX=f,t.transform.rotation=c}if(this.slingMid1==null)return;t(this.slingMid1),t(this.slingMid2)},h.joyOnSling=function(){window.joy=window.joyArray.shift();var e=this.game.tweens.create(joy);e.to({x:window.GLOBAL.joyPosition.x-32.5,y:window.GLOBAL.joyPosition.y-32.5},400,Kiwi.Animations.Tweens.Easing.Linear.None,!1),e.onComplete(function(){}),e.start(),joy.input.onUp.add(this.joyOnUp,this),joy.input.onDown.add(this.joyOnDown,this)},h.joyOnDown=function(t){Game.input.mouse.onMouseMove=function(t){var n=t.clientX,r=t.clientY,i=e.calculatePosition({x:n,y:r});window.joy.x=i.x-32.5,window.joy.y=i.y-32.5},this.addSlingMid()},h.joyOnUp=function(e){this.removeSlingMid(),this.joyRelease({x:window.joy.x+32.5,y:window.joy.y+32.5}),Game.input.mouse.onMouseMove=function(e){this._cursor.move(e)}},h.initJoys=function(){window.joyArray=[];var e=0;for(;e<window.GLOBAL.joyCount;e++){var t=new Kiwi.GameObjects.Sprite(this,this.textures.joy,150+80*e,310);this.addChildBefore(t,this.sling1),t.animation.add("normal",[0],1,!0),t.animation.add("fly",[1],1,!0),joyArray.push(t)}},h.initSling=function(){this.sling1=new Kiwi.GameObjects.StaticImage(this,this.textures.sling1,160,245),this.sling2=new Kiwi.GameObjects.StaticImage(this,this.textures.sling2,204,250),this.addChildAfter(this.sling2,this.mainbg),this.addChild(this.sling1)},h.bindContact=function(){function t(t){var n=t.GetFixtureA().GetBody(),r=t.GetFixtureB().GetBody();n.gameCfg&&n.gameCfg.extType=="mooncake";if(r.gameCfg){if(r.gameCfg.extType=="mooncake"){var i=e.calculateDamage(n),s=e.calculateDamage(r);i=i>s?i:s,r.gameCfg.hp-=i,r.gameCfg.hp<0&&r.explod()}if(r.gameCfg.extType=="joy"){if(window.___joyRemoveTimeOut)return;window.___joyRemoveTimeOut=1,window.JOY_RELOAD_INTERVAL=window.setTimeout(function(){world.DestroyBody(window.B2Joy1),c.showBy(joy1),joy1.parent.removeChild(joy1),window.___joyRemoveTimeOut=0,window.joyArray.length&&h.joyOnSling()},5e3)}}}var n=new b2ContactListener;n.BeginContact=t,world.SetContactListener(n)},h.joyRelease=function(t){e.setMoonRotationNoneFix(),i(window.JoyConfig),window.B2Joy.SetUserData(joy),world.ClearForces();var n=e.getPower(t);B2Joy.ApplyImpulse(new b2Vec2(n.x,n.y),B2Joy.GetWorldCenter()),window.GLOBAL.joyCount--,this.bindContact(),window.joy.animation.play("fly"),window.B2Joy1=window.B2Joy,window.joy1=window.joy,e.eachB2Body(function(e){if(e.gameCfg.extType=="mooncake"){var t=e.GetUserData();t.animation.add("fear",[1],1,!0),t.animation.play("fear")}})},h.update=function(){var t=this;Kiwi.State.prototype.update.call(this),e.eachB2Body(function(t){var n=t.GetUserData();e.setCenterPositionToSprite(n,{x:t.GetPosition().x*window.GLOBAL.PTM_RATIO,y:t.GetPosition().y*window.GLOBAL.PTM_RATIO}),n.rotation=t.GetAngle()}),this.adjustSlingMid()},h});